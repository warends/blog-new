angular.module('willsBlog', ['ngResource', 'ngAnimate', 'ngSanitize', 'ui.router', 'duScroll']);

angular.module('willsBlog').config(['$locationProvider', '$stateProvider', '$urlRouterProvider', function($locationProvider, $stateProvider, $urlRouterProvider){

    var routeRoleChecks = {
      admin: function(mvAuth){
          return mvAuth.authorizeCurrentUserForRoute('admin');
      },
      user: function(mvAuth){
          return mvAuth.authorizeAutheticatedUserForRoute();
      }
    }

    $urlRouterProvider.otherwise('/');
    $locationProvider.html5Mode(true);

    $stateProvider
    .state('home', {
      url: '/',
      templateUrl: '/partials/main/main',
      controller: 'mainCtrl'
    })
    .state('account', {
      url: '/account',
      templateUrl: '/partials/login/login',
      controller: 'loginCtrl'
    })
    .state('signup', {
      url: '/signup',
      templateUrl: '/partials/login/signup',
      controller: 'signupCtrl'
    })
    .state('posts', {
      url: '/posts',
      templateUrl: '/partials/blog/blog-list',
      controller: 'blogListCtrl'
    })
    .state('profile', {
      url: '/profile',
      templateUrl: '/partials/admin/profile',
      controller: 'profileCtrl',
      resolve: {
        routeRoleCheck: ['mvAuth', function(mvAuth){
            return mvAuth.authorizeAutheticatedUserForRoute();
        }
      ]}
    })
    .state('postDetail', { //view single post
      url: '/posts/:slug',
      templateUrl: '/partials/blog/post-detail',
      controller: 'postDetailCtrl'
    })
    .state('newPost', {  //adding a new post
      url: '/admin/new-post',
      templateUrl: '/partials/blog/new-post',
      controller: 'newPostCtrl',
      resolve: {
        routeRoleCheck: ['mvAuth', function(mvAuth){
            return mvAuth.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('editPost', {  //edit post
      url: '/admin/:slug/edit',
      templateUrl: '/partials/blog/edit-post',
      controller: 'editPostCtrl',
      resolve: {
        routeRoleCheck: ['mvAuth', function(mvAuth){
            return mvAuth.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('users', {
      url: '/admin/users',
      templateUrl: '/partials/admin/users-list',
      controller: 'userListCtrl',
      resolve: {
        routeRoleCheck: ['mvAuth', function(mvAuth){
            return mvAuth.authorizeCurrentUserForRoute('admin');
        }
      ]}
    });

}]);//end config


angular.module('willsBlog').run(['$rootScope', '$location', '$anchorScroll', function($rootScope, $location, $anchorScroll){

  $rootScope.$on('$routeChangeError', function(evt, current, previous, rejection) {
      if(rejection === 'not authorized') {
        $location.path('/');
      }
  });

  $rootScope.$on("$stateChangeSuccess", function (event, currentRoute, previousRoute) {
    window.scrollTo(0, 0);
  });

}]);

angular.module('willsBlog').controller('profileCtrl', ['$scope', 'mvAuth', 'identity', 'notifier', function($scope, mvAuth, identity, notifier){
  $scope.username = identity.currentUser.username;
  $scope.fName = identity.currentUser.firstName;
  $scope.lName = identity.currentUser.lastName;

  $scope.update = function(){
      var newUserData = {
        username: $scope.username,
        firstName: $scope.fName,
        lastName: $scope.lName
      }

      if($scope.password && $scope.password.length > 0) {
       newUserData.password = $scope.password;
      }

      mvAuth.updateCurrentUser(newUserData)
        .then(function(){
          notifier.notify('Your information has been updated');
        }, function(reason){
          notifier.error(reason);
        });
  }

}]);

angular.module('willsBlog').controller('userListCtrl', ['$scope', 'mvUser', function($scope, mvUser){
  $scope.users = mvUser.query();
}]);

angular.module('willsBlog').controller('blogListCtrl', ['$scope', 'mvCachedPost', 'identity', '$location', 'Meta',  function($scope, mvCachedPost, identity, $location, Meta){

  Meta.setTitle('Blog');

  $scope.posts = mvCachedPost.query();

  $scope.identity = identity;

  $scope.sortOptions= [
    {value: 'title', text: 'Sort by Title'},
    {value: 'published', text: 'Published Date'}];

  $scope.sortOrder = $scope.sortOptions[0].value;
}]);

angular.module('willsBlog').directive('commentForm', [function(){
  return{
    restrict: 'E',
    templateUrl: '/partials/blog/comment-form'
  }
}]);

angular.module('willsBlog').service('CommentService', ['$http', 'notifier', function($http, notifier){

  this.postComment = function(data, slug){
    return $http.post('/api/posts/comments/' + slug, data)
      .success(function(){
        notifier.notify('Thanks for submitting your comment');
      })
      .error(function(err){
        notifier.notify('There was a problem submitting your comment.');
      });
  }

}]);

 angular.module('willsBlog').controller('editPostCtrl', ['$scope', 'notifier', 'mvPost', '$q', '$location', '$stateParams', '$http', function($scope, notifier, mvPost, $q, $location, $stateParams, $http){

    $scope.post = mvPost.get({ slug: $stateParams.slug });

    $scope.post.data = {
        _id: $scope.post._id,
        title : $scope.post.title,
        slug: $scope.post.slug,
        categories : $scope.post.categories,
        headerImage : $scope.post.headerImage,
        excerpt : $scope.post.excerpt,
        body : $scope.post.body,
        author: $scope.post.author
    }

    $scope.updatePost = function(){
        $scope.post.$update( { slug: $scope.post.slug }, function(){
          notifier.notify('Post has been updated');
          $location.path('/posts');
        }, function(message){
          notifier.error(message.data);
        });
    }

    $scope.deletePost = function(){
      $scope.post.$delete(function() {
        notifier.notify('Post has been deleted');
        $location.path('/posts');
      });
    }

    $scope.cancel = function(){
      $location.path('/posts');
    }

}]);

angular.module('willsBlog').factory('mvCachedPost', ['mvPost', function(mvPost){
  var postList;

  return {
    query: function(){
      if(!postList){
        postList = mvPost.query();
      }
      return postList;
    }
  }

}]);

angular.module('willsBlog').factory('mvPost', ['$resource', function($resource){

  return $resource('/api/posts/:slug', {slug: '@slug'}, {
    update : {
      method: 'PUT'
    }
  }, {
    stripTrailingSlashes: false
  });

}]);

angular.module('willsBlog').controller('newPostCtrl', ['$scope', 'notifier', 'mvPost', '$location', function($scope, notifier, mvPost, $location){

  $scope.post = new mvPost();

  $scope.createNewPost = function(){
    $scope.post.$save(function(){
        notifier.notify('New Post Created');
        $location.path('/blog');
    });
  }
  $scope.cancel = function(){
    $location.path('/blog');
  }

}]);

angular.module('willsBlog').controller('postDetailCtrl', ['$scope', 'mvCachedPost', 'mvPost', '$stateParams', 'Meta', 'notifier', 'CommentService', function($scope, mvCachedPost, mvPost, $stateParams, Meta, notifier, CommentService){

  mvCachedPost.query().$promise.then(function(collection){
    collection.forEach(function(post){
      if(post.slug === $stateParams.slug){
        $scope.post = post;
        var title = $scope.post.title,
            desc = $scope.post.excerpt;
        Meta.setTitle(title);
        Meta.setDesc(desc);
      }
    });
  });

  $scope.submitComment = function(){
    var comment = {
      'content': $scope.comment.content,
      'firstName': $scope.comment.firstName,
      'lastName': $scope.comment.lastName,
    };

    var slug = $stateParams.slug;
    CommentService.postComment(comment, slug)
      .then(function(){
        $scope.commentForm.$setPristine();
      }, function(){
        //console.log('error');
      });
  };

}]);

angular.module('willsBlog').factory('identity', ['$window', 'mvUser', function($window, mvUser){

  var currentUser;
  if(!!$window.bootstrappedUserObject) {
    currentUser = new mvUser();
    angular.extend(currentUser, $window.bootstrappedUserObject);
  }
  return {
    currentUser: currentUser,
    isAuthenticated: function(){
      return !!this.currentUser;
    },

    isAuthorized: function(role){
      return !!this.currentUser && this.currentUser.roles.indexOf(role) > -1;
    }

  }

}]);

angular.module('willsBlog').controller('loginCtrl', ['$scope', '$http', 'identity', 'notifier', 'mvAuth', '$location', 'Meta', function($scope, $http, identity, notifier, mvAuth, $location, Meta){

    Meta.setTitle('Account');

    $scope.identity = identity;

    $scope.signIn = function(username, password){
      mvAuth.authenticateUser(username, password).then(function(success){
        if(success){
          notifier.notify('You have signed in');
          $location.url('/account');
          $scope.actShown = false;
        } else {
          notifier.error('Username/Password Incorrect');
        }
      });
    };

    $scope.signOut = function(){
      mvAuth.logoutUser().then(function() {
        $scope.username = '';
        $scope.password = '';
        notifier.notify('You have logged out');
        $location.path('/');
      });
    };

    $scope.signup = function(){
      var newUserData = {
        username: $scope.username,
        firstName: $scope.fName,
        lastName: $scope.lName,
        password: $scope.password
      };
      mvAuth.createUser(newUserData)
        .then(function(){
          notifier.notify('User account created');
          $location.path('/');
      }, function(message){
        notifier.error(message);
      });
    };

    $scope.cancel = function(){
      $location.path('/');
    };

    $scope.actShown = false;
    $scope.toggleAccount = function() {
      if(identity.isAuthenticated()){
        $location.path('/account');
      } else {
        $scope.actShown = !$scope.actShown;
      }
    };

    $scope.signupShown = false;
    $scope.toggleSignup = function() {
      $scope.signupShown = !$scope.signupShown;
    };


}]);


angular.module('willsBlog').factory('mvAuth', ['$http', 'identity', '$q', 'mvUser', function($http, identity, $q, mvUser){

  return {
    // this thing working
    authenticateUser: function(username, password){
      var deferred = $q.defer();

      $http.post('/login', {
        username: username,
        password: password
      }).then(function(response){
        if (response.data.success){

          var user = new mvUser();
          angular.extend(user, response.data.user);
          identity.currentUser = user;
          deferred.resolve(true);
        } else {
          deferred.resolve(false);
        }
      });

      return deferred.promise;
    },

    logoutUser: function() {
      var deferred = $q.defer();

      $http.post('/logout', {logout: true}).then(function(){
        identity.currentUser = undefined;
        deferred.resolve();
      });

      return deferred.promise;

    },

    authorizeCurrentUserForRoute: function(role){
      if (identity.isAuthorized('admin')){
        return true;
      } else {
        return $q.reject('not authorized');
      }
    },

    authorizeAutheticatedUserForRoute: function(){
      if (identity.isAuthenticated()){
        return true;
      } else {
        return $q.reject('not a current user');
      }
    },

    createUser : function(newUserData) {
       var newUser = new mvUser(newUserData);
       var deferred = $q.defer();

       newUser.$save().then(function(){
         identity.currentUser = newUser;
         deferred.resolve();
       }, function(response){
         deferred.reject(response.data.reason);
       });

       return deferred.promise;
    },

    updateCurrentUser: function(newUserData){
        var deferred = $q.defer();
        var clone = angular.copy(identity.currentUser);
        angular.extend(clone, newUserData);
        clone.$update().then(function(){
          identity.currentUser = clone;
          deferred.resolve();
        }, function(response){
          deferred.reject(response.data.reason);
        });
        return deferred.promise;
    }

  }// return

}]);

angular.module('willsBlog').factory('mvUser', ['$resource', function($resource){

  var UserResource = $resource('/api/users/:id', {_id : '@id'}, {
    update: {method: 'PUT', isArray: false}
  });

  UserResource.prototype.isAdmin = function(){
    return this.roles && this.roles.indexOf('admin') > -1;
  }

  return UserResource;

}]);

angular.module('willsBlog').controller('signupCtrl', ['$scope', 'mvAuth', 'notifier', '$location', function($scope, mvAuth, notifier, $location){
    $scope.signup = function(){

      var newUserData = {
        username: $scope.username,
        firstName: $scope.fName,
        lastName: $scope.lName,
        password: $scope.password
      };
      mvAuth.createUser(newUserData)
        .then(function(){
          notifier.notify('User account created');
          $location.path('/');
      }, function(reason){
        notifier.error(reason);
      });

    };

    $scope.cancel = function(){
      $location.path('/');
    };

}]);

angular.module('willsBlog').factory('Meta', function(){
  var title = 'Web Development, Seattle, WA';
  var desc = 'I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.';
  return {
    title: function() {return title;},
    setTitle: function(newTitle) { title = newTitle },
    description: function() { return desc;},
    setDesc : function(newDesc) { desc = newDesc}
  }
})
.controller('metaCtrl', ['$scope', 'Meta', function($scope, Meta){
  $scope.Meta = Meta;
  $scope.metaDesc = Meta;
}]);

angular.module('willsBlog').directive('globalModal', function(){
  return{
    restrict: 'E',
    scope: {
      show: '='
    },
    replace: true,
    transclude: true,
    link : function(scope, element, attrs){
      scope.dialogStyle = {};
      if(attrs.width)
        scope.dialogStyle.width = attrs.width;
      if (attrs.height)
        scope.dialogStyle.height = attrs.height;

      scope.hideModal = function(){
        scope.show = false;
      };
    },
    templateUrl: '/partials/common/modal'
  }
});

angular.module('willsBlog').value('notific8', notific8);

angular.module('willsBlog').factory('notifier', ['notific8', function(notific8){

  notific8('configure', {
    life: 3000,
    theme: 'atomic',
    zindex: 9999,
    verticalEdge: 'right',
    horizontalEdge: 'top',
    closeText: 'X'
  });

  return {
    notify: function(message){
      notific8(message, {color: 'pear'});
      console.log(message);
    },
    error: function(message){
      notific8(message, {color: 'tomato'});
      console.log(message);
    }
  }
}]);

angular.module('willsBlog').factory('TwitterService', ['$http', '$q', function($http, $q){

  var getUser = function(username){
    var d = $q.defer();

    $http.post('/twitter/user', {username : username})
      .success(function(data){
        return d.resolve(data);
      })
      .error(function(error){
        return d.reject(error);
      });
      return d.promise;
    };

    return {
      getUser : getUser
    }
}]);

angular.module('willsBlog').controller('carouselCtrl', ['$scope', function($scope){
  $scope.slides = [
    { name: 'Mobile',
    svg: 'mobile-svg',
    desc: 'Is your website up to date with the most current mobile design trends? If not, you are loosing valuable business. Ensure that your customers can reach your business from anywhere and receive the best user experience. By building with responsive design in mind, your customers will get a pixel perfect look from mobile to tablet or desktop.' },

    { name: 'ECommerce',
    svg: 'ecomm-svg',
    desc: 'Do you have a new product you are looking to bring to market and need an e-commerce site or just looking for more modern feel to an existing site?  By utilizing robust ecommerce platforms, I can design and develop a site that will scale with your business and needs all in time to meet your busy deadlines. ' },

    { name: 'SEO',
    svg: 'seo-svg',
    desc: 'Having a modern design and user friendly website is great, but if customers can`t find your business, it wont matter much.  I design and develop every aspect of the website with search engine optimization in mind and so your customers can find you among the competition.  Also through research and analytics I can develop, plan and deploy the best SEO and marketing practices to increase conversions and retention.' }
  ];

  $scope.currentIndex = 0;
  $scope.setCurrentSlideIndex = function(index){
    $scope.currentIndex = index;
  }
  $scope.isCurrentSlideIndex = function(index){
    return $scope.currentIndex === index;
  }
}])

.animation('.slide-animation', function(){
  return {
    addClass: function(element, className, done){
      if (className == 'ng-hide'){
          TweenMax.to(element, 0.5, {left: -element.parent().width(), onComplete: done });
      } else {
        done();
      }
    },
    removeClass: function(element, className, done){
      if(className == 'ng-hide'){
        element.removeClass('ng-hide');
        TweenMax.set(element, { left: element.parent().width() });
        TweenMax.to(element, 0.5, {left: 0, onComplete: done });
      } else {
        done();
      }
    }
  }
});

angular.module('willsBlog').controller('mainCtrl', ['$scope', '$location', 'mvCachedPost', 'notifier' ,'TwitterService', '$http', 'Meta',  function($scope, $location, mvCachedPost, notifier, TwitterService, $http, Meta){


  var $bgobj = $('#home');
  $(window).scroll(function() {
      var yPos = -( $(window).scrollTop() / $bgobj.data('speed'));
      var coords = '50% '+ yPos + 'px';
      $bgobj.css({ backgroundPosition: coords });
  });

  Meta.setTitle('Home');
  Meta.setDesc('I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.');

  $scope.services = [
    { name: 'Development',
    svg: 'dev-logo',
    description: 'Customized and reusable code using the most up to date HTML5, CSS3 and Javascript framworks. Options range from static sites, content managed sites, and ecommerce stores.',
    more: 'Development Skills include HTML5, CSS, Javascript, Angular, Backbone, Node, Express, Boostrap and more.' },

    { name: 'Web Design',
    svg: 'design-logo',
    description: 'Creating an excellent user experience through clean, simple and thoroughly crafted design. Collaboration with clients during design process ensures a superb finished project.',
    more: 'Services include wire frames, photoshop mockups, logo design, and company branding.' },

    { name: 'Support',
    svg: 'sup-logo',
    description: 'Support is readily available for clients when anything comes up along the development process. Also available are personal instruction on how to maintain or update your own site.',
    more: 'Have a new product or feature you want to implement? Plans for continued support and maintenance are available.' }

  ];

  $scope.posts = mvCachedPost.query();

  $scope.form = {};

  $scope.sendMail = function(){
    var data =({
      contactName : this.contactName,
      contactCompany : this.contactCompany,
      contactEmail : this.contactEmail,
      contactMessage : this.contactMessage
    });

    $http.post('/contact-form', data)
      .success(function(data, status, headers, config){
        notifier.notify('Thank you for your message ' + data.contactName);
           $scope.form.contactForm.$setPristine();
           $scope.form.contactForm.$setUntouched();
      })
      .error(function(data, status, headers, config){
        notifier.notify('There was an error processing your request. Please try again');
      });
      this.contactName = null;
      this.contactCompany = null;
      this.contactEmail = null;
      this.contactMessage = null;

  }

  $scope.getUser = function(username){
		TwitterService.getUser(username)
		    .then(function(data){
		        $scope.twitterErrors = undefined;
	        	$scope.tweets = JSON.parse(data.result.userData);
						// console.log($scope.tweets);
		    })
		    .catch(function(error){
		        console.error('there was an error retrieving data: ', error);
		        $scope.twitterErrors = error.error;
		    })
	};

  //$scope.getUser();

}]);

angular.module('willsBlog').controller('navCtrl', ['$scope', '$location', '$document', function($scope, $location, $document){
  $scope.showMenu = function(){
      angular.element(document.getElementsByClassName('collapse')).toggleClass('in');
  };

  $scope.scrollTop = function(){
    $document.scrollTopAnimated(0);
  };

  $scope.linkTo = function(id){

      var route = $location.url();
      var offset = 60;
      var duration = 800;
      var element = angular.element(document.getElementById(id));

      if(route !== '/'){
        $location.url('/', function(){
          $document.scrollToElement(element, offset, duration);
        });

      } else {
        $document.scrollToElement(element, offset, duration);
      }
    };

}]);

angular.module('willsBlog').controller('workCtrl', ['$scope', function($scope){

  $scope.projects = [
    {
      name: 'Tendril Inc.',
      link: 'https://www.tendrilinc.com',
      clickFunc: toggleTendril = function(){
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/tendril.jpg',
      modal: false,
      modalImg: 'img/gallery/tendril-mockup.png',
      noLink: false
    },
    {
      name: 'Crown Offroad',
      link: 'http://crownoffroad.com',
      clickFunc: toggleCrown = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/crown-offroad.jpg',
      modal: false,
      modalImg: 'img/gallery/crown-offroad-mockup.png',
      noLink: false
    },
    {
      name: 'Colorado Broadband Portal',
      link: 'http://broadband.co.gov',
      clickFunc: $scope.toggleBroad = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/wires.jpg',
      modal: false,
      modalImg: 'img/gallery/broadband.png',
      noLink: false
    },
    {
      name: 'adidas adiPlayer',
      link: '',
      clickFunc: toggleAdi = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/adiplayer.jpg',
      modal: false,
      modalImg: 'img/gallery/adiplayer_mockup.png',
      noLink: true
    }
  ]

}]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFkbWluL3Byb2ZpbGVDdHJsLmpzIiwiYWRtaW4vdXNlckxpc3RDdHJsLmpzIiwiYmxvZy9ibG9nTGlzdEN0cmwuanMiLCJibG9nL2NvbW1lbnREaXIuanMiLCJibG9nL2NvbW1lbnRTZXJ2aWNlLmpzIiwiYmxvZy9lZGl0UG9zdEN0cmwuanMiLCJibG9nL212Q2FjaGVkUG9zdC5qcyIsImJsb2cvbXZQb3N0LmpzIiwiYmxvZy9uZXdQb3N0Q3RybC5qcyIsImJsb2cvcG9zdERldGFpbEN0cmwuanMiLCJsb2dpbi9pZGVudGl0eS5qcyIsImxvZ2luL2xvZ2luQ3RybC5qcyIsImxvZ2luL212QXV0aC5qcyIsImxvZ2luL212VXNlci5qcyIsImxvZ2luL3NpZ251cEN0cmwuanMiLCJjb21tb24vbWV0YS5qcyIsImNvbW1vbi9tb2RhbERpci5qcyIsImNvbW1vbi9ub3RpZmllci5qcyIsImNvbW1vbi90d2l0dGVyLmpzIiwibWFpbi9jYXJvdXNlbEN0cmwuanMiLCJtYWluL21haW5DdHJsLmpzIiwibWFpbi9uYXZDdHJsLmpzIiwibWFpbi93b3JrQ3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycsIFsnbmdSZXNvdXJjZScsICduZ0FuaW1hdGUnLCAnbmdTYW5pdGl6ZScsICd1aS5yb3V0ZXInLCAnZHVTY3JvbGwnXSk7XG5cbmFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb25maWcoWyckbG9jYXRpb25Qcm92aWRlcicsICckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCBmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcil7XG5cbiAgICB2YXIgcm91dGVSb2xlQ2hlY2tzID0ge1xuICAgICAgYWRtaW46IGZ1bmN0aW9uKG12QXV0aCl7XG4gICAgICAgICAgcmV0dXJuIG12QXV0aC5hdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKCdhZG1pbicpO1xuICAgICAgfSxcbiAgICAgIHVzZXI6IGZ1bmN0aW9uKG12QXV0aCl7XG4gICAgICAgICAgcmV0dXJuIG12QXV0aC5hdXRob3JpemVBdXRoZXRpY2F0ZWRVc2VyRm9yUm91dGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICB1cmw6ICcvJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL21haW4vbWFpbicsXG4gICAgICBjb250cm9sbGVyOiAnbWFpbkN0cmwnXG4gICAgfSlcbiAgICAuc3RhdGUoJ2FjY291bnQnLCB7XG4gICAgICB1cmw6ICcvYWNjb3VudCcsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9sb2dpbi9sb2dpbicsXG4gICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdzaWdudXAnLCB7XG4gICAgICB1cmw6ICcvc2lnbnVwJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xvZ2luL3NpZ251cCcsXG4gICAgICBjb250cm9sbGVyOiAnc2lnbnVwQ3RybCdcbiAgICB9KVxuICAgIC5zdGF0ZSgncG9zdHMnLCB7XG4gICAgICB1cmw6ICcvcG9zdHMnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYmxvZy9ibG9nLWxpc3QnLFxuICAgICAgY29udHJvbGxlcjogJ2Jsb2dMaXN0Q3RybCdcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvZmlsZScsIHtcbiAgICAgIHVybDogJy9wcm9maWxlJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3Byb2ZpbGUnLFxuICAgICAgY29udHJvbGxlcjogJ3Byb2ZpbGVDdHJsJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgcm91dGVSb2xlQ2hlY2s6IFsnbXZBdXRoJywgZnVuY3Rpb24obXZBdXRoKXtcbiAgICAgICAgICAgIHJldHVybiBtdkF1dGguYXV0aG9yaXplQXV0aGV0aWNhdGVkVXNlckZvclJvdXRlKCk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSlcbiAgICAuc3RhdGUoJ3Bvc3REZXRhaWwnLCB7IC8vdmlldyBzaW5nbGUgcG9zdFxuICAgICAgdXJsOiAnL3Bvc3RzLzpzbHVnJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2Jsb2cvcG9zdC1kZXRhaWwnLFxuICAgICAgY29udHJvbGxlcjogJ3Bvc3REZXRhaWxDdHJsJ1xuICAgIH0pXG4gICAgLnN0YXRlKCduZXdQb3N0JywgeyAgLy9hZGRpbmcgYSBuZXcgcG9zdFxuICAgICAgdXJsOiAnL2FkbWluL25ldy1wb3N0JyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2Jsb2cvbmV3LXBvc3QnLFxuICAgICAgY29udHJvbGxlcjogJ25ld1Bvc3RDdHJsJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgcm91dGVSb2xlQ2hlY2s6IFsnbXZBdXRoJywgZnVuY3Rpb24obXZBdXRoKXtcbiAgICAgICAgICAgIHJldHVybiBtdkF1dGguYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSgnYWRtaW4nKTtcbiAgICAgICAgfVxuICAgICAgXX1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZWRpdFBvc3QnLCB7ICAvL2VkaXQgcG9zdFxuICAgICAgdXJsOiAnL2FkbWluLzpzbHVnL2VkaXQnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYmxvZy9lZGl0LXBvc3QnLFxuICAgICAgY29udHJvbGxlcjogJ2VkaXRQb3N0Q3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHJvdXRlUm9sZUNoZWNrOiBbJ212QXV0aCcsIGZ1bmN0aW9uKG12QXV0aCl7XG4gICAgICAgICAgICByZXR1cm4gbXZBdXRoLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSlcbiAgICAuc3RhdGUoJ3VzZXJzJywge1xuICAgICAgdXJsOiAnL2FkbWluL3VzZXJzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3VzZXJzLWxpc3QnLFxuICAgICAgY29udHJvbGxlcjogJ3VzZXJMaXN0Q3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHJvdXRlUm9sZUNoZWNrOiBbJ212QXV0aCcsIGZ1bmN0aW9uKG12QXV0aCl7XG4gICAgICAgICAgICByZXR1cm4gbXZBdXRoLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSk7XG5cbn1dKTsvL2VuZCBjb25maWdcblxuXG5hbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykucnVuKFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGFuY2hvclNjcm9sbCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJGFuY2hvclNjcm9sbCl7XG5cbiAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZ0LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XG4gICAgICBpZihyZWplY3Rpb24gPT09ICdub3QgYXV0aG9yaXplZCcpIHtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgIH1cbiAgfSk7XG5cbiAgJHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdWNjZXNzXCIsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudFJvdXRlLCBwcmV2aW91c1JvdXRlKSB7XG4gICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICB9KTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ3Byb2ZpbGVDdHJsJywgWyckc2NvcGUnLCAnbXZBdXRoJywgJ2lkZW50aXR5JywgJ25vdGlmaWVyJywgZnVuY3Rpb24oJHNjb3BlLCBtdkF1dGgsIGlkZW50aXR5LCBub3RpZmllcil7XG4gICRzY29wZS51c2VybmFtZSA9IGlkZW50aXR5LmN1cnJlbnRVc2VyLnVzZXJuYW1lO1xuICAkc2NvcGUuZk5hbWUgPSBpZGVudGl0eS5jdXJyZW50VXNlci5maXJzdE5hbWU7XG4gICRzY29wZS5sTmFtZSA9IGlkZW50aXR5LmN1cnJlbnRVc2VyLmxhc3ROYW1lO1xuXG4gICRzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIG5ld1VzZXJEYXRhID0ge1xuICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXJuYW1lLFxuICAgICAgICBmaXJzdE5hbWU6ICRzY29wZS5mTmFtZSxcbiAgICAgICAgbGFzdE5hbWU6ICRzY29wZS5sTmFtZVxuICAgICAgfVxuXG4gICAgICBpZigkc2NvcGUucGFzc3dvcmQgJiYgJHNjb3BlLnBhc3N3b3JkLmxlbmd0aCA+IDApIHtcbiAgICAgICBuZXdVc2VyRGF0YS5wYXNzd29yZCA9ICRzY29wZS5wYXNzd29yZDtcbiAgICAgIH1cblxuICAgICAgbXZBdXRoLnVwZGF0ZUN1cnJlbnRVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnWW91ciBpbmZvcm1hdGlvbiBoYXMgYmVlbiB1cGRhdGVkJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IocmVhc29uKTtcbiAgICAgICAgfSk7XG4gIH1cblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ3VzZXJMaXN0Q3RybCcsIFsnJHNjb3BlJywgJ212VXNlcicsIGZ1bmN0aW9uKCRzY29wZSwgbXZVc2VyKXtcbiAgJHNjb3BlLnVzZXJzID0gbXZVc2VyLnF1ZXJ5KCk7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignYmxvZ0xpc3RDdHJsJywgWyckc2NvcGUnLCAnbXZDYWNoZWRQb3N0JywgJ2lkZW50aXR5JywgJyRsb2NhdGlvbicsICdNZXRhJywgIGZ1bmN0aW9uKCRzY29wZSwgbXZDYWNoZWRQb3N0LCBpZGVudGl0eSwgJGxvY2F0aW9uLCBNZXRhKXtcblxuICBNZXRhLnNldFRpdGxlKCdCbG9nJyk7XG5cbiAgJHNjb3BlLnBvc3RzID0gbXZDYWNoZWRQb3N0LnF1ZXJ5KCk7XG5cbiAgJHNjb3BlLmlkZW50aXR5ID0gaWRlbnRpdHk7XG5cbiAgJHNjb3BlLnNvcnRPcHRpb25zPSBbXG4gICAge3ZhbHVlOiAndGl0bGUnLCB0ZXh0OiAnU29ydCBieSBUaXRsZSd9LFxuICAgIHt2YWx1ZTogJ3B1Ymxpc2hlZCcsIHRleHQ6ICdQdWJsaXNoZWQgRGF0ZSd9XTtcblxuICAkc2NvcGUuc29ydE9yZGVyID0gJHNjb3BlLnNvcnRPcHRpb25zWzBdLnZhbHVlO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmRpcmVjdGl2ZSgnY29tbWVudEZvcm0nLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYmxvZy9jb21tZW50LWZvcm0nXG4gIH1cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5zZXJ2aWNlKCdDb21tZW50U2VydmljZScsIFsnJGh0dHAnLCAnbm90aWZpZXInLCBmdW5jdGlvbigkaHR0cCwgbm90aWZpZXIpe1xuXG4gIHRoaXMucG9zdENvbW1lbnQgPSBmdW5jdGlvbihkYXRhLCBzbHVnKXtcbiAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9wb3N0cy9jb21tZW50cy8nICsgc2x1ZywgZGF0YSlcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKCl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVGhhbmtzIGZvciBzdWJtaXR0aW5nIHlvdXIgY29tbWVudCcpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpe1xuICAgICAgICBub3RpZmllci5ub3RpZnkoJ1RoZXJlIHdhcyBhIHByb2JsZW0gc3VibWl0dGluZyB5b3VyIGNvbW1lbnQuJyk7XG4gICAgICB9KTtcbiAgfVxuXG59XSk7XG4iLCIgYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ2VkaXRQb3N0Q3RybCcsIFsnJHNjb3BlJywgJ25vdGlmaWVyJywgJ212UG9zdCcsICckcScsICckbG9jYXRpb24nLCAnJHN0YXRlUGFyYW1zJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCBub3RpZmllciwgbXZQb3N0LCAkcSwgJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsICRodHRwKXtcblxuICAgICRzY29wZS5wb3N0ID0gbXZQb3N0LmdldCh7IHNsdWc6ICRzdGF0ZVBhcmFtcy5zbHVnIH0pO1xuXG4gICAgJHNjb3BlLnBvc3QuZGF0YSA9IHtcbiAgICAgICAgX2lkOiAkc2NvcGUucG9zdC5faWQsXG4gICAgICAgIHRpdGxlIDogJHNjb3BlLnBvc3QudGl0bGUsXG4gICAgICAgIHNsdWc6ICRzY29wZS5wb3N0LnNsdWcsXG4gICAgICAgIGNhdGVnb3JpZXMgOiAkc2NvcGUucG9zdC5jYXRlZ29yaWVzLFxuICAgICAgICBoZWFkZXJJbWFnZSA6ICRzY29wZS5wb3N0LmhlYWRlckltYWdlLFxuICAgICAgICBleGNlcnB0IDogJHNjb3BlLnBvc3QuZXhjZXJwdCxcbiAgICAgICAgYm9keSA6ICRzY29wZS5wb3N0LmJvZHksXG4gICAgICAgIGF1dGhvcjogJHNjb3BlLnBvc3QuYXV0aG9yXG4gICAgfVxuXG4gICAgJHNjb3BlLnVwZGF0ZVBvc3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAkc2NvcGUucG9zdC4kdXBkYXRlKCB7IHNsdWc6ICRzY29wZS5wb3N0LnNsdWcgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1Bvc3QgaGFzIGJlZW4gdXBkYXRlZCcpO1xuICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcG9zdHMnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IobWVzc2FnZS5kYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmRlbGV0ZVBvc3QgPSBmdW5jdGlvbigpe1xuICAgICAgJHNjb3BlLnBvc3QuJGRlbGV0ZShmdW5jdGlvbigpIHtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdQb3N0IGhhcyBiZWVuIGRlbGV0ZWQnKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wb3N0cycpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAkbG9jYXRpb24ucGF0aCgnL3Bvc3RzJyk7XG4gICAgfVxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZmFjdG9yeSgnbXZDYWNoZWRQb3N0JywgWydtdlBvc3QnLCBmdW5jdGlvbihtdlBvc3Qpe1xuICB2YXIgcG9zdExpc3Q7XG5cbiAgcmV0dXJuIHtcbiAgICBxdWVyeTogZnVuY3Rpb24oKXtcbiAgICAgIGlmKCFwb3N0TGlzdCl7XG4gICAgICAgIHBvc3RMaXN0ID0gbXZQb3N0LnF1ZXJ5KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcG9zdExpc3Q7XG4gICAgfVxuICB9XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5mYWN0b3J5KCdtdlBvc3QnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XG5cbiAgcmV0dXJuICRyZXNvdXJjZSgnL2FwaS9wb3N0cy86c2x1ZycsIHtzbHVnOiAnQHNsdWcnfSwge1xuICAgIHVwZGF0ZSA6IHtcbiAgICAgIG1ldGhvZDogJ1BVVCdcbiAgICB9XG4gIH0sIHtcbiAgICBzdHJpcFRyYWlsaW5nU2xhc2hlczogZmFsc2VcbiAgfSk7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb250cm9sbGVyKCduZXdQb3N0Q3RybCcsIFsnJHNjb3BlJywgJ25vdGlmaWVyJywgJ212UG9zdCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsIG5vdGlmaWVyLCBtdlBvc3QsICRsb2NhdGlvbil7XG5cbiAgJHNjb3BlLnBvc3QgPSBuZXcgbXZQb3N0KCk7XG5cbiAgJHNjb3BlLmNyZWF0ZU5ld1Bvc3QgPSBmdW5jdGlvbigpe1xuICAgICRzY29wZS5wb3N0LiRzYXZlKGZ1bmN0aW9uKCl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnTmV3IFBvc3QgQ3JlYXRlZCcpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2Jsb2cnKTtcbiAgICB9KTtcbiAgfVxuICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKXtcbiAgICAkbG9jYXRpb24ucGF0aCgnL2Jsb2cnKTtcbiAgfVxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcigncG9zdERldGFpbEN0cmwnLCBbJyRzY29wZScsICdtdkNhY2hlZFBvc3QnLCAnbXZQb3N0JywgJyRzdGF0ZVBhcmFtcycsICdNZXRhJywgJ25vdGlmaWVyJywgJ0NvbW1lbnRTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCBtdkNhY2hlZFBvc3QsIG12UG9zdCwgJHN0YXRlUGFyYW1zLCBNZXRhLCBub3RpZmllciwgQ29tbWVudFNlcnZpY2Upe1xuXG4gIG12Q2FjaGVkUG9zdC5xdWVyeSgpLiRwcm9taXNlLnRoZW4oZnVuY3Rpb24oY29sbGVjdGlvbil7XG4gICAgY29sbGVjdGlvbi5mb3JFYWNoKGZ1bmN0aW9uKHBvc3Qpe1xuICAgICAgaWYocG9zdC5zbHVnID09PSAkc3RhdGVQYXJhbXMuc2x1Zyl7XG4gICAgICAgICRzY29wZS5wb3N0ID0gcG9zdDtcbiAgICAgICAgdmFyIHRpdGxlID0gJHNjb3BlLnBvc3QudGl0bGUsXG4gICAgICAgICAgICBkZXNjID0gJHNjb3BlLnBvc3QuZXhjZXJwdDtcbiAgICAgICAgTWV0YS5zZXRUaXRsZSh0aXRsZSk7XG4gICAgICAgIE1ldGEuc2V0RGVzYyhkZXNjKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgJHNjb3BlLnN1Ym1pdENvbW1lbnQgPSBmdW5jdGlvbigpe1xuICAgIHZhciBjb21tZW50ID0ge1xuICAgICAgJ2NvbnRlbnQnOiAkc2NvcGUuY29tbWVudC5jb250ZW50LFxuICAgICAgJ2ZpcnN0TmFtZSc6ICRzY29wZS5jb21tZW50LmZpcnN0TmFtZSxcbiAgICAgICdsYXN0TmFtZSc6ICRzY29wZS5jb21tZW50Lmxhc3ROYW1lLFxuICAgIH07XG5cbiAgICB2YXIgc2x1ZyA9ICRzdGF0ZVBhcmFtcy5zbHVnO1xuICAgIENvbW1lbnRTZXJ2aWNlLnBvc3RDb21tZW50KGNvbW1lbnQsIHNsdWcpXG4gICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAkc2NvcGUuY29tbWVudEZvcm0uJHNldFByaXN0aW5lKCk7XG4gICAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgICAvL2NvbnNvbGUubG9nKCdlcnJvcicpO1xuICAgICAgfSk7XG4gIH07XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5mYWN0b3J5KCdpZGVudGl0eScsIFsnJHdpbmRvdycsICdtdlVzZXInLCBmdW5jdGlvbigkd2luZG93LCBtdlVzZXIpe1xuXG4gIHZhciBjdXJyZW50VXNlcjtcbiAgaWYoISEkd2luZG93LmJvb3RzdHJhcHBlZFVzZXJPYmplY3QpIHtcbiAgICBjdXJyZW50VXNlciA9IG5ldyBtdlVzZXIoKTtcbiAgICBhbmd1bGFyLmV4dGVuZChjdXJyZW50VXNlciwgJHdpbmRvdy5ib290c3RyYXBwZWRVc2VyT2JqZWN0KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRVc2VyO1xuICAgIH0sXG5cbiAgICBpc0F1dGhvcml6ZWQ6IGZ1bmN0aW9uKHJvbGUpe1xuICAgICAgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnJvbGVzLmluZGV4T2Yocm9sZSkgPiAtMTtcbiAgICB9XG5cbiAgfVxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignbG9naW5DdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnaWRlbnRpdHknLCAnbm90aWZpZXInLCAnbXZBdXRoJywgJyRsb2NhdGlvbicsICdNZXRhJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgaWRlbnRpdHksIG5vdGlmaWVyLCBtdkF1dGgsICRsb2NhdGlvbiwgTWV0YSl7XG5cbiAgICBNZXRhLnNldFRpdGxlKCdBY2NvdW50Jyk7XG5cbiAgICAkc2NvcGUuaWRlbnRpdHkgPSBpZGVudGl0eTtcblxuICAgICRzY29wZS5zaWduSW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgICAgbXZBdXRoLmF1dGhlbnRpY2F0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHN1Y2Nlc3Mpe1xuICAgICAgICBpZihzdWNjZXNzKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1lvdSBoYXZlIHNpZ25lZCBpbicpO1xuICAgICAgICAgICRsb2NhdGlvbi51cmwoJy9hY2NvdW50Jyk7XG4gICAgICAgICAgJHNjb3BlLmFjdFNob3duID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IoJ1VzZXJuYW1lL1Bhc3N3b3JkIEluY29ycmVjdCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNpZ25PdXQgPSBmdW5jdGlvbigpe1xuICAgICAgbXZBdXRoLmxvZ291dFVzZXIoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSAnJztcbiAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gJyc7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnWW91IGhhdmUgbG9nZ2VkIG91dCcpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaWdudXAgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIG5ld1VzZXJEYXRhID0ge1xuICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXJuYW1lLFxuICAgICAgICBmaXJzdE5hbWU6ICRzY29wZS5mTmFtZSxcbiAgICAgICAgbGFzdE5hbWU6ICRzY29wZS5sTmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzd29yZFxuICAgICAgfTtcbiAgICAgIG12QXV0aC5jcmVhdGVVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVXNlciBhY2NvdW50IGNyZWF0ZWQnKTtcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7XG4gICAgICAgIG5vdGlmaWVyLmVycm9yKG1lc3NhZ2UpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpe1xuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmFjdFNob3duID0gZmFsc2U7XG4gICAgJHNjb3BlLnRvZ2dsZUFjY291bnQgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmKGlkZW50aXR5LmlzQXV0aGVudGljYXRlZCgpKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9hY2NvdW50Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUuYWN0U2hvd24gPSAhJHNjb3BlLmFjdFNob3duO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuc2lnbnVwU2hvd24gPSBmYWxzZTtcbiAgICAkc2NvcGUudG9nZ2xlU2lnbnVwID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUuc2lnbnVwU2hvd24gPSAhJHNjb3BlLnNpZ251cFNob3duO1xuICAgIH07XG5cblxufV0pO1xuIiwiXG5hbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZmFjdG9yeSgnbXZBdXRoJywgWyckaHR0cCcsICdpZGVudGl0eScsICckcScsICdtdlVzZXInLCBmdW5jdGlvbigkaHR0cCwgaWRlbnRpdHksICRxLCBtdlVzZXIpe1xuXG4gIHJldHVybiB7XG4gICAgLy8gdGhpcyB0aGluZyB3b3JraW5nXG4gICAgYXV0aGVudGljYXRlVXNlcjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwLnBvc3QoJy9sb2dpbicsIHtcbiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdWNjZXNzKXtcblxuICAgICAgICAgIHZhciB1c2VyID0gbmV3IG12VXNlcigpO1xuICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHVzZXIsIHJlc3BvbnNlLmRhdGEudXNlcik7XG4gICAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgbG9nb3V0VXNlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KCcvbG9nb3V0Jywge2xvZ291dDogdHJ1ZX0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIH0sXG5cbiAgICBhdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlOiBmdW5jdGlvbihyb2xlKXtcbiAgICAgIGlmIChpZGVudGl0eS5pc0F1dGhvcml6ZWQoJ2FkbWluJykpe1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAkcS5yZWplY3QoJ25vdCBhdXRob3JpemVkJyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGF1dGhvcml6ZUF1dGhldGljYXRlZFVzZXJGb3JSb3V0ZTogZnVuY3Rpb24oKXtcbiAgICAgIGlmIChpZGVudGl0eS5pc0F1dGhlbnRpY2F0ZWQoKSl7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICRxLnJlamVjdCgnbm90IGEgY3VycmVudCB1c2VyJyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNyZWF0ZVVzZXIgOiBmdW5jdGlvbihuZXdVc2VyRGF0YSkge1xuICAgICAgIHZhciBuZXdVc2VyID0gbmV3IG12VXNlcihuZXdVc2VyRGF0YSk7XG4gICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgIG5ld1VzZXIuJHNhdmUoKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICBpZGVudGl0eS5jdXJyZW50VXNlciA9IG5ld1VzZXI7XG4gICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVhc29uKTtcbiAgICAgICB9KTtcblxuICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICB1cGRhdGVDdXJyZW50VXNlcjogZnVuY3Rpb24obmV3VXNlckRhdGEpe1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICB2YXIgY2xvbmUgPSBhbmd1bGFyLmNvcHkoaWRlbnRpdHkuY3VycmVudFVzZXIpO1xuICAgICAgICBhbmd1bGFyLmV4dGVuZChjbG9uZSwgbmV3VXNlckRhdGEpO1xuICAgICAgICBjbG9uZS4kdXBkYXRlKCkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIGlkZW50aXR5LmN1cnJlbnRVc2VyID0gY2xvbmU7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVhc29uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICB9Ly8gcmV0dXJuXG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5mYWN0b3J5KCdtdlVzZXInLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XG5cbiAgdmFyIFVzZXJSZXNvdXJjZSA9ICRyZXNvdXJjZSgnL2FwaS91c2Vycy86aWQnLCB7X2lkIDogJ0BpZCd9LCB7XG4gICAgdXBkYXRlOiB7bWV0aG9kOiAnUFVUJywgaXNBcnJheTogZmFsc2V9XG4gIH0pO1xuXG4gIFVzZXJSZXNvdXJjZS5wcm90b3R5cGUuaXNBZG1pbiA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMucm9sZXMgJiYgdGhpcy5yb2xlcy5pbmRleE9mKCdhZG1pbicpID4gLTE7XG4gIH1cblxuICByZXR1cm4gVXNlclJlc291cmNlO1xuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignc2lnbnVwQ3RybCcsIFsnJHNjb3BlJywgJ212QXV0aCcsICdub3RpZmllcicsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsIG12QXV0aCwgbm90aWZpZXIsICRsb2NhdGlvbil7XG4gICAgJHNjb3BlLnNpZ251cCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgIHZhciBuZXdVc2VyRGF0YSA9IHtcbiAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VybmFtZSxcbiAgICAgICAgZmlyc3ROYW1lOiAkc2NvcGUuZk5hbWUsXG4gICAgICAgIGxhc3ROYW1lOiAkc2NvcGUubE5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc3dvcmRcbiAgICAgIH07XG4gICAgICBtdkF1dGguY3JlYXRlVXNlcihuZXdVc2VyRGF0YSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1VzZXIgYWNjb3VudCBjcmVhdGVkJyk7XG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgICAgIG5vdGlmaWVyLmVycm9yKHJlYXNvbik7XG4gICAgICB9KTtcblxuICAgIH07XG5cbiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKXtcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmZhY3RvcnkoJ01ldGEnLCBmdW5jdGlvbigpe1xuICB2YXIgdGl0bGUgPSAnV2ViIERldmVsb3BtZW50LCBTZWF0dGxlLCBXQSc7XG4gIHZhciBkZXNjID0gJ0kgZW5qb3kgYWxsIHRoaW5ncyB3ZWIgZGV2ZWxvcG1lbnQgYW5kIGFtIGFsd2F5cyBhY3RpdmVseSBsZWFybmluZyB0aGUgbmV3ZXN0IHRlY2huaXF1ZXMgYW5kIGxhbmdhdWdlcy4gSWYgeW91IGhhdmUgYSB3ZWIgZGVzaWduIG9yIGRldmVsb3BtZW50IHByb2plY3QsIGdpdmUgbWUgYSBzaG91dCwgSSB3b3VsZCBsb3ZlIHRvIHRhbGsgYWJvdXQgaXQuJztcbiAgcmV0dXJuIHtcbiAgICB0aXRsZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRpdGxlO30sXG4gICAgc2V0VGl0bGU6IGZ1bmN0aW9uKG5ld1RpdGxlKSB7IHRpdGxlID0gbmV3VGl0bGUgfSxcbiAgICBkZXNjcmlwdGlvbjogZnVuY3Rpb24oKSB7IHJldHVybiBkZXNjO30sXG4gICAgc2V0RGVzYyA6IGZ1bmN0aW9uKG5ld0Rlc2MpIHsgZGVzYyA9IG5ld0Rlc2N9XG4gIH1cbn0pXG4uY29udHJvbGxlcignbWV0YUN0cmwnLCBbJyRzY29wZScsICdNZXRhJywgZnVuY3Rpb24oJHNjb3BlLCBNZXRhKXtcbiAgJHNjb3BlLk1ldGEgPSBNZXRhO1xuICAkc2NvcGUubWV0YURlc2MgPSBNZXRhO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmRpcmVjdGl2ZSgnZ2xvYmFsTW9kYWwnLCBmdW5jdGlvbigpe1xuICByZXR1cm57XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICBzY29wZToge1xuICAgICAgc2hvdzogJz0nXG4gICAgfSxcbiAgICByZXBsYWNlOiB0cnVlLFxuICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgbGluayA6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICBzY29wZS5kaWFsb2dTdHlsZSA9IHt9O1xuICAgICAgaWYoYXR0cnMud2lkdGgpXG4gICAgICAgIHNjb3BlLmRpYWxvZ1N0eWxlLndpZHRoID0gYXR0cnMud2lkdGg7XG4gICAgICBpZiAoYXR0cnMuaGVpZ2h0KVxuICAgICAgICBzY29wZS5kaWFsb2dTdHlsZS5oZWlnaHQgPSBhdHRycy5oZWlnaHQ7XG5cbiAgICAgIHNjb3BlLmhpZGVNb2RhbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHNjb3BlLnNob3cgPSBmYWxzZTtcbiAgICAgIH07XG4gICAgfSxcbiAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9jb21tb24vbW9kYWwnXG4gIH1cbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLnZhbHVlKCdub3RpZmljOCcsIG5vdGlmaWM4KTtcblxuYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmZhY3RvcnkoJ25vdGlmaWVyJywgWydub3RpZmljOCcsIGZ1bmN0aW9uKG5vdGlmaWM4KXtcblxuICBub3RpZmljOCgnY29uZmlndXJlJywge1xuICAgIGxpZmU6IDMwMDAsXG4gICAgdGhlbWU6ICdhdG9taWMnLFxuICAgIHppbmRleDogOTk5OSxcbiAgICB2ZXJ0aWNhbEVkZ2U6ICdyaWdodCcsXG4gICAgaG9yaXpvbnRhbEVkZ2U6ICd0b3AnLFxuICAgIGNsb3NlVGV4dDogJ1gnXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgbm90aWZ5OiBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgIG5vdGlmaWM4KG1lc3NhZ2UsIHtjb2xvcjogJ3BlYXInfSk7XG4gICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgIG5vdGlmaWM4KG1lc3NhZ2UsIHtjb2xvcjogJ3RvbWF0byd9KTtcbiAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmZhY3RvcnkoJ1R3aXR0ZXJTZXJ2aWNlJywgWyckaHR0cCcsICckcScsIGZ1bmN0aW9uKCRodHRwLCAkcSl7XG5cbiAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbih1c2VybmFtZSl7XG4gICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgJGh0dHAucG9zdCgnL3R3aXR0ZXIvdXNlcicsIHt1c2VybmFtZSA6IHVzZXJuYW1lfSlcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICByZXR1cm4gZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgIHJldHVybiBkLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICBnZXRVc2VyIDogZ2V0VXNlclxuICAgIH1cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb250cm9sbGVyKCdjYXJvdXNlbEN0cmwnLCBbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG4gICRzY29wZS5zbGlkZXMgPSBbXG4gICAgeyBuYW1lOiAnTW9iaWxlJyxcbiAgICBzdmc6ICdtb2JpbGUtc3ZnJyxcbiAgICBkZXNjOiAnSXMgeW91ciB3ZWJzaXRlIHVwIHRvIGRhdGUgd2l0aCB0aGUgbW9zdCBjdXJyZW50IG1vYmlsZSBkZXNpZ24gdHJlbmRzPyBJZiBub3QsIHlvdSBhcmUgbG9vc2luZyB2YWx1YWJsZSBidXNpbmVzcy4gRW5zdXJlIHRoYXQgeW91ciBjdXN0b21lcnMgY2FuIHJlYWNoIHlvdXIgYnVzaW5lc3MgZnJvbSBhbnl3aGVyZSBhbmQgcmVjZWl2ZSB0aGUgYmVzdCB1c2VyIGV4cGVyaWVuY2UuIEJ5IGJ1aWxkaW5nIHdpdGggcmVzcG9uc2l2ZSBkZXNpZ24gaW4gbWluZCwgeW91ciBjdXN0b21lcnMgd2lsbCBnZXQgYSBwaXhlbCBwZXJmZWN0IGxvb2sgZnJvbSBtb2JpbGUgdG8gdGFibGV0IG9yIGRlc2t0b3AuJyB9LFxuXG4gICAgeyBuYW1lOiAnRUNvbW1lcmNlJyxcbiAgICBzdmc6ICdlY29tbS1zdmcnLFxuICAgIGRlc2M6ICdEbyB5b3UgaGF2ZSBhIG5ldyBwcm9kdWN0IHlvdSBhcmUgbG9va2luZyB0byBicmluZyB0byBtYXJrZXQgYW5kIG5lZWQgYW4gZS1jb21tZXJjZSBzaXRlIG9yIGp1c3QgbG9va2luZyBmb3IgbW9yZSBtb2Rlcm4gZmVlbCB0byBhbiBleGlzdGluZyBzaXRlPyAgQnkgdXRpbGl6aW5nIHJvYnVzdCBlY29tbWVyY2UgcGxhdGZvcm1zLCBJIGNhbiBkZXNpZ24gYW5kIGRldmVsb3AgYSBzaXRlIHRoYXQgd2lsbCBzY2FsZSB3aXRoIHlvdXIgYnVzaW5lc3MgYW5kIG5lZWRzIGFsbCBpbiB0aW1lIHRvIG1lZXQgeW91ciBidXN5IGRlYWRsaW5lcy4gJyB9LFxuXG4gICAgeyBuYW1lOiAnU0VPJyxcbiAgICBzdmc6ICdzZW8tc3ZnJyxcbiAgICBkZXNjOiAnSGF2aW5nIGEgbW9kZXJuIGRlc2lnbiBhbmQgdXNlciBmcmllbmRseSB3ZWJzaXRlIGlzIGdyZWF0LCBidXQgaWYgY3VzdG9tZXJzIGNhbmB0IGZpbmQgeW91ciBidXNpbmVzcywgaXQgd29udCBtYXR0ZXIgbXVjaC4gIEkgZGVzaWduIGFuZCBkZXZlbG9wIGV2ZXJ5IGFzcGVjdCBvZiB0aGUgd2Vic2l0ZSB3aXRoIHNlYXJjaCBlbmdpbmUgb3B0aW1pemF0aW9uIGluIG1pbmQgYW5kIHNvIHlvdXIgY3VzdG9tZXJzIGNhbiBmaW5kIHlvdSBhbW9uZyB0aGUgY29tcGV0aXRpb24uICBBbHNvIHRocm91Z2ggcmVzZWFyY2ggYW5kIGFuYWx5dGljcyBJIGNhbiBkZXZlbG9wLCBwbGFuIGFuZCBkZXBsb3kgdGhlIGJlc3QgU0VPIGFuZCBtYXJrZXRpbmcgcHJhY3RpY2VzIHRvIGluY3JlYXNlIGNvbnZlcnNpb25zIGFuZCByZXRlbnRpb24uJyB9XG4gIF07XG5cbiAgJHNjb3BlLmN1cnJlbnRJbmRleCA9IDA7XG4gICRzY29wZS5zZXRDdXJyZW50U2xpZGVJbmRleCA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICAkc2NvcGUuY3VycmVudEluZGV4ID0gaW5kZXg7XG4gIH1cbiAgJHNjb3BlLmlzQ3VycmVudFNsaWRlSW5kZXggPSBmdW5jdGlvbihpbmRleCl7XG4gICAgcmV0dXJuICRzY29wZS5jdXJyZW50SW5kZXggPT09IGluZGV4O1xuICB9XG59XSlcblxuLmFuaW1hdGlvbignLnNsaWRlLWFuaW1hdGlvbicsIGZ1bmN0aW9uKCl7XG4gIHJldHVybiB7XG4gICAgYWRkQ2xhc3M6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSwgZG9uZSl7XG4gICAgICBpZiAoY2xhc3NOYW1lID09ICduZy1oaWRlJyl7XG4gICAgICAgICAgVHdlZW5NYXgudG8oZWxlbWVudCwgMC41LCB7bGVmdDogLWVsZW1lbnQucGFyZW50KCkud2lkdGgoKSwgb25Db21wbGV0ZTogZG9uZSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUsIGRvbmUpe1xuICAgICAgaWYoY2xhc3NOYW1lID09ICduZy1oaWRlJyl7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ25nLWhpZGUnKTtcbiAgICAgICAgVHdlZW5NYXguc2V0KGVsZW1lbnQsIHsgbGVmdDogZWxlbWVudC5wYXJlbnQoKS53aWR0aCgpIH0pO1xuICAgICAgICBUd2Vlbk1heC50byhlbGVtZW50LCAwLjUsIHtsZWZ0OiAwLCBvbkNvbXBsZXRlOiBkb25lIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignbWFpbkN0cmwnLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnbXZDYWNoZWRQb3N0JywgJ25vdGlmaWVyJyAsJ1R3aXR0ZXJTZXJ2aWNlJywgJyRodHRwJywgJ01ldGEnLCAgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIG12Q2FjaGVkUG9zdCwgbm90aWZpZXIsIFR3aXR0ZXJTZXJ2aWNlLCAkaHR0cCwgTWV0YSl7XG5cblxuICB2YXIgJGJnb2JqID0gJCgnI2hvbWUnKTtcbiAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcbiAgICAgIHZhciB5UG9zID0gLSggJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC8gJGJnb2JqLmRhdGEoJ3NwZWVkJykpO1xuICAgICAgdmFyIGNvb3JkcyA9ICc1MCUgJysgeVBvcyArICdweCc7XG4gICAgICAkYmdvYmouY3NzKHsgYmFja2dyb3VuZFBvc2l0aW9uOiBjb29yZHMgfSk7XG4gIH0pO1xuXG4gIE1ldGEuc2V0VGl0bGUoJ0hvbWUnKTtcbiAgTWV0YS5zZXREZXNjKCdJIGVuam95IGFsbCB0aGluZ3Mgd2ViIGRldmVsb3BtZW50IGFuZCBhbSBhbHdheXMgYWN0aXZlbHkgbGVhcm5pbmcgdGhlIG5ld2VzdCB0ZWNobmlxdWVzIGFuZCBsYW5nYXVnZXMuIElmIHlvdSBoYXZlIGEgd2ViIGRlc2lnbiBvciBkZXZlbG9wbWVudCBwcm9qZWN0LCBnaXZlIG1lIGEgc2hvdXQsIEkgd291bGQgbG92ZSB0byB0YWxrIGFib3V0IGl0LicpO1xuXG4gICRzY29wZS5zZXJ2aWNlcyA9IFtcbiAgICB7IG5hbWU6ICdEZXZlbG9wbWVudCcsXG4gICAgc3ZnOiAnZGV2LWxvZ28nLFxuICAgIGRlc2NyaXB0aW9uOiAnQ3VzdG9taXplZCBhbmQgcmV1c2FibGUgY29kZSB1c2luZyB0aGUgbW9zdCB1cCB0byBkYXRlIEhUTUw1LCBDU1MzIGFuZCBKYXZhc2NyaXB0IGZyYW13b3Jrcy4gT3B0aW9ucyByYW5nZSBmcm9tIHN0YXRpYyBzaXRlcywgY29udGVudCBtYW5hZ2VkIHNpdGVzLCBhbmQgZWNvbW1lcmNlIHN0b3Jlcy4nLFxuICAgIG1vcmU6ICdEZXZlbG9wbWVudCBTa2lsbHMgaW5jbHVkZSBIVE1MNSwgQ1NTLCBKYXZhc2NyaXB0LCBBbmd1bGFyLCBCYWNrYm9uZSwgTm9kZSwgRXhwcmVzcywgQm9vc3RyYXAgYW5kIG1vcmUuJyB9LFxuXG4gICAgeyBuYW1lOiAnV2ViIERlc2lnbicsXG4gICAgc3ZnOiAnZGVzaWduLWxvZ28nLFxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRpbmcgYW4gZXhjZWxsZW50IHVzZXIgZXhwZXJpZW5jZSB0aHJvdWdoIGNsZWFuLCBzaW1wbGUgYW5kIHRob3JvdWdobHkgY3JhZnRlZCBkZXNpZ24uIENvbGxhYm9yYXRpb24gd2l0aCBjbGllbnRzIGR1cmluZyBkZXNpZ24gcHJvY2VzcyBlbnN1cmVzIGEgc3VwZXJiIGZpbmlzaGVkIHByb2plY3QuJyxcbiAgICBtb3JlOiAnU2VydmljZXMgaW5jbHVkZSB3aXJlIGZyYW1lcywgcGhvdG9zaG9wIG1vY2t1cHMsIGxvZ28gZGVzaWduLCBhbmQgY29tcGFueSBicmFuZGluZy4nIH0sXG5cbiAgICB7IG5hbWU6ICdTdXBwb3J0JyxcbiAgICBzdmc6ICdzdXAtbG9nbycsXG4gICAgZGVzY3JpcHRpb246ICdTdXBwb3J0IGlzIHJlYWRpbHkgYXZhaWxhYmxlIGZvciBjbGllbnRzIHdoZW4gYW55dGhpbmcgY29tZXMgdXAgYWxvbmcgdGhlIGRldmVsb3BtZW50IHByb2Nlc3MuIEFsc28gYXZhaWxhYmxlIGFyZSBwZXJzb25hbCBpbnN0cnVjdGlvbiBvbiBob3cgdG8gbWFpbnRhaW4gb3IgdXBkYXRlIHlvdXIgb3duIHNpdGUuJyxcbiAgICBtb3JlOiAnSGF2ZSBhIG5ldyBwcm9kdWN0IG9yIGZlYXR1cmUgeW91IHdhbnQgdG8gaW1wbGVtZW50PyBQbGFucyBmb3IgY29udGludWVkIHN1cHBvcnQgYW5kIG1haW50ZW5hbmNlIGFyZSBhdmFpbGFibGUuJyB9XG5cbiAgXTtcblxuICAkc2NvcGUucG9zdHMgPSBtdkNhY2hlZFBvc3QucXVlcnkoKTtcblxuICAkc2NvcGUuZm9ybSA9IHt9O1xuXG4gICRzY29wZS5zZW5kTWFpbCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRhdGEgPSh7XG4gICAgICBjb250YWN0TmFtZSA6IHRoaXMuY29udGFjdE5hbWUsXG4gICAgICBjb250YWN0Q29tcGFueSA6IHRoaXMuY29udGFjdENvbXBhbnksXG4gICAgICBjb250YWN0RW1haWwgOiB0aGlzLmNvbnRhY3RFbWFpbCxcbiAgICAgIGNvbnRhY3RNZXNzYWdlIDogdGhpcy5jb250YWN0TWVzc2FnZVxuICAgIH0pO1xuXG4gICAgJGh0dHAucG9zdCgnL2NvbnRhY3QtZm9ybScsIGRhdGEpXG4gICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVGhhbmsgeW91IGZvciB5b3VyIG1lc3NhZ2UgJyArIGRhdGEuY29udGFjdE5hbWUpO1xuICAgICAgICAgICAkc2NvcGUuZm9ybS5jb250YWN0Rm9ybS4kc2V0UHJpc3RpbmUoKTtcbiAgICAgICAgICAgJHNjb3BlLmZvcm0uY29udGFjdEZvcm0uJHNldFVudG91Y2hlZCgpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVGhlcmUgd2FzIGFuIGVycm9yIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0LiBQbGVhc2UgdHJ5IGFnYWluJyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY29udGFjdE5hbWUgPSBudWxsO1xuICAgICAgdGhpcy5jb250YWN0Q29tcGFueSA9IG51bGw7XG4gICAgICB0aGlzLmNvbnRhY3RFbWFpbCA9IG51bGw7XG4gICAgICB0aGlzLmNvbnRhY3RNZXNzYWdlID0gbnVsbDtcblxuICB9XG5cbiAgJHNjb3BlLmdldFVzZXIgPSBmdW5jdGlvbih1c2VybmFtZSl7XG5cdFx0VHdpdHRlclNlcnZpY2UuZ2V0VXNlcih1c2VybmFtZSlcblx0XHQgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0ICAgICAgICAkc2NvcGUudHdpdHRlckVycm9ycyA9IHVuZGVmaW5lZDtcblx0ICAgICAgICBcdCRzY29wZS50d2VldHMgPSBKU09OLnBhcnNlKGRhdGEucmVzdWx0LnVzZXJEYXRhKTtcblx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKCRzY29wZS50d2VldHMpO1xuXHRcdCAgICB9KVxuXHRcdCAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuXHRcdCAgICAgICAgY29uc29sZS5lcnJvcigndGhlcmUgd2FzIGFuIGVycm9yIHJldHJpZXZpbmcgZGF0YTogJywgZXJyb3IpO1xuXHRcdCAgICAgICAgJHNjb3BlLnR3aXR0ZXJFcnJvcnMgPSBlcnJvci5lcnJvcjtcblx0XHQgICAgfSlcblx0fTtcblxuICAvLyRzY29wZS5nZXRVc2VyKCk7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb250cm9sbGVyKCduYXZDdHJsJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyRkb2N1bWVudCcsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkZG9jdW1lbnQpe1xuICAkc2NvcGUuc2hvd01lbnUgPSBmdW5jdGlvbigpe1xuICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbGxhcHNlJykpLnRvZ2dsZUNsYXNzKCdpbicpO1xuICB9O1xuXG4gICRzY29wZS5zY3JvbGxUb3AgPSBmdW5jdGlvbigpe1xuICAgICRkb2N1bWVudC5zY3JvbGxUb3BBbmltYXRlZCgwKTtcbiAgfTtcblxuICAkc2NvcGUubGlua1RvID0gZnVuY3Rpb24oaWQpe1xuXG4gICAgICB2YXIgcm91dGUgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICB2YXIgb2Zmc2V0ID0gNjA7XG4gICAgICB2YXIgZHVyYXRpb24gPSA4MDA7XG4gICAgICB2YXIgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpO1xuXG4gICAgICBpZihyb3V0ZSAhPT0gJy8nKXtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnLycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJGRvY3VtZW50LnNjcm9sbFRvRWxlbWVudChlbGVtZW50LCBvZmZzZXQsIGR1cmF0aW9uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRkb2N1bWVudC5zY3JvbGxUb0VsZW1lbnQoZWxlbWVudCwgb2Zmc2V0LCBkdXJhdGlvbik7XG4gICAgICB9XG4gICAgfTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ3dvcmtDdHJsJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuXG4gICRzY29wZS5wcm9qZWN0cyA9IFtcbiAgICB7XG4gICAgICBuYW1lOiAnVGVuZHJpbCBJbmMuJyxcbiAgICAgIGxpbms6ICdodHRwczovL3d3dy50ZW5kcmlsaW5jLmNvbScsXG4gICAgICBjbGlja0Z1bmM6IHRvZ2dsZVRlbmRyaWwgPSBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLm1vZGFsID0gIXRoaXMubW9kYWw7XG4gICAgICB9LFxuICAgICAgYmFja2dyb3VuZEltZzogJ2ltZy9nYWxsZXJ5L3RlbmRyaWwuanBnJyxcbiAgICAgIG1vZGFsOiBmYWxzZSxcbiAgICAgIG1vZGFsSW1nOiAnaW1nL2dhbGxlcnkvdGVuZHJpbC1tb2NrdXAucG5nJyxcbiAgICAgIG5vTGluazogZmFsc2VcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdDcm93biBPZmZyb2FkJyxcbiAgICAgIGxpbms6ICdodHRwOi8vY3Jvd25vZmZyb2FkLmNvbScsXG4gICAgICBjbGlja0Z1bmM6IHRvZ2dsZUNyb3duID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubW9kYWwgPSAhdGhpcy5tb2RhbDtcbiAgICAgIH0sXG4gICAgICBiYWNrZ3JvdW5kSW1nOiAnaW1nL2dhbGxlcnkvY3Jvd24tb2Zmcm9hZC5qcGcnLFxuICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgbW9kYWxJbWc6ICdpbWcvZ2FsbGVyeS9jcm93bi1vZmZyb2FkLW1vY2t1cC5wbmcnLFxuICAgICAgbm9MaW5rOiBmYWxzZVxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ0NvbG9yYWRvIEJyb2FkYmFuZCBQb3J0YWwnLFxuICAgICAgbGluazogJ2h0dHA6Ly9icm9hZGJhbmQuY28uZ292JyxcbiAgICAgIGNsaWNrRnVuYzogJHNjb3BlLnRvZ2dsZUJyb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubW9kYWwgPSAhdGhpcy5tb2RhbDtcbiAgICAgIH0sXG4gICAgICBiYWNrZ3JvdW5kSW1nOiAnaW1nL2dhbGxlcnkvd2lyZXMuanBnJyxcbiAgICAgIG1vZGFsOiBmYWxzZSxcbiAgICAgIG1vZGFsSW1nOiAnaW1nL2dhbGxlcnkvYnJvYWRiYW5kLnBuZycsXG4gICAgICBub0xpbms6IGZhbHNlXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnYWRpZGFzIGFkaVBsYXllcicsXG4gICAgICBsaW5rOiAnJyxcbiAgICAgIGNsaWNrRnVuYzogdG9nZ2xlQWRpID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMubW9kYWwgPSAhdGhpcy5tb2RhbDtcbiAgICAgIH0sXG4gICAgICBiYWNrZ3JvdW5kSW1nOiAnaW1nL2dhbGxlcnkvYWRpcGxheWVyLmpwZycsXG4gICAgICBtb2RhbDogZmFsc2UsXG4gICAgICBtb2RhbEltZzogJ2ltZy9nYWxsZXJ5L2FkaXBsYXllcl9tb2NrdXAucG5nJyxcbiAgICAgIG5vTGluazogdHJ1ZVxuICAgIH1cbiAgXVxuXG59XSk7XG4iXX0=
