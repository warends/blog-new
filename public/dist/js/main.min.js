angular.module('willsBlog', ['users', 'post', 'ngResource', 'ngSanitize', 'ui.router', 'duScroll', 'gist', 'ngScrollReveal']);

angular.module('willsBlog').config(['$locationProvider', '$stateProvider', '$urlRouterProvider', function($locationProvider, $stateProvider, $urlRouterProvider){

    var routeRoleChecks = {
      admin: function(AuthService){
          return AuthService.authorizeCurrentUserForRoute('admin');
      },
      user: function(AuthService){
          return AuthService.authorizeAutheticatedUserForRoute();
      }
    }

    $urlRouterProvider.otherwise('/');

    $locationProvider.html5Mode(true);

    $stateProvider
    .state('home', {
      url: '/',
      templateUrl: '/partials/main/main',
      controller: 'MainController'
    })
    .state('account', {
      url: '/account',
      templateUrl: '/partials/login/login',
      controller: 'LoginController'
    })
    .state('posts', {
      url: '/posts',
      templateUrl: '/partials/posts/post-list',
      controller: 'PostListController'
    })
    .state('profile', {
      url: '/profile',
      templateUrl: '/partials/admin/profile',
      controller: 'ProfileController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeAutheticatedUserForRoute();
        }
      ]}
    })
    .state('postDetail', {
      url: '/posts/:slug',
      templateUrl: '/partials/posts/post-detail',
      controller: 'PostDetailController'
    })
    .state('newPost', {
      url: '/admin/new-post',
      templateUrl: '/partials/posts/new-post',
      controller: 'NewPostController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('editPost', {
      url: '/admin/:slug/edit',
      templateUrl: '/partials/posts/edit-post',
      controller: 'EditPostController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('users', {
      url: '/admin/users',
      templateUrl: '/partials/admin/users-list',
      controller: 'UserListController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    });

}]);//end config


angular.module('willsBlog').run(['$rootScope', '$location', '$anchorScroll', function($rootScope, $location, $anchorScroll){

  $anchorScroll.yOffset = 60;

  $rootScope.$on('$routeChangeError', function(evt, current, previous, rejection) {
      if(rejection === 'not authorized') {
        $location.path('/');
      }
  });

  $rootScope.$on("$stateChangeSuccess", function (event, currentRoute, previousRoute) {
    window.scrollTo(0, 0);
  });

}]);

angular.module('willsBlog').controller('ProfileController', ['$scope', 'AuthService', 'IdentityService', 'NotifierService', function($scope, AuthService, identity, notifier){
  $scope.username = identity.currentUser.username;
  $scope.fName = identity.currentUser.firstName;
  $scope.lName = identity.currentUser.lastName;

  $scope.update = function(){
      var newUserData = {
        username: $scope.username,
        firstName: $scope.fName,
        lastName: $scope.lName
      }

      if($scope.password && $scope.password.length > 0) {
       newUserData.password = $scope.password;
      }

      AuthService.updateCurrentUser(newUserData)
        .then(function(){
          notifier.notify('Your information has been updated');
        }, function(reason){
          notifier.error(reason);
        });
  }

}]);

angular.module('willsBlog').controller('UserListController', ['$scope', 'UserService', function($scope, UserService){
  $scope.users = UserService.query();
}]);

angular.module('willsBlog').factory('Meta', function(){
  var title = 'Web Development, Seattle, WA';
  var desc = 'I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.';
  return {
    title: function() {return title;},
    setTitle: function(newTitle) { title = newTitle },
    description: function() { return desc;},
    setDesc : function(newDesc) { desc = newDesc}
  }
})
.controller('MetaController', ['$scope', 'Meta', function($scope, Meta){
  $scope.Meta = Meta;
  $scope.metaDesc = Meta;
}]);

angular.module('willsBlog').directive('globalModal', function(){
  return{
    restrict: 'E',
    scope: {
      show: '='
    },
    replace: true,
    transclude: true,
    link : function(scope, element, attrs){
      scope.dialogStyle = {};
      if(attrs.width)
        scope.dialogStyle.width = attrs.width;
      if (attrs.height)
        scope.dialogStyle.height = attrs.height;

      scope.hideModal = function(){
        scope.show = false;
      };
    },
    templateUrl: '/partials/common/modal'
  }
});

angular.module('willsBlog').value('notific8', notific8);

angular.module('willsBlog').factory('NotifierService', ['notific8', function(notific8){

  notific8('configure', {
    life: 3000,
    theme: 'atomic',
    zindex: 9999,
    verticalEdge: 'right',
    horizontalEdge: 'top',
    closeText: 'X'
  });

  return {
    notify: function(message){
      notific8(message, {color: 'pear'});
      console.log(message);
    },
    error: function(message){
      notific8(message, {color: 'tomato'});
      console.log(message);
    }
  }
}]);

angular.module('willsBlog').factory('TwitterService', ['$http', '$q', function($http, $q){

  var getUser = function(username){
    var d = $q.defer();

    $http.post('/twitter/user', {username : username})
      .success(function(data){
        return d.resolve(data);
      })
      .error(function(error){
        return d.reject(error);
      });
      return d.promise;
    };

    return {
      getUser : getUser
    }
}]);


angular.module('users.auth', []).factory('AuthService', ['$http', 'IdentityService', '$q', 'UserService', function($http, identity, $q, UserService){

  return {
    // this thing working
    authenticateUser: function(username, password){
      var deferred = $q.defer();

      $http.post('/login', {
        username: username,
        password: password
      }).then(function(response){
        if (response.data.success){

          var user = new UserService();
          angular.extend(user, response.data.user);
          identity.currentUser = user;
          deferred.resolve(true);
        } else {
          deferred.resolve(false);
        }
      });

      return deferred.promise;
    },

    logoutUser: function() {
      var deferred = $q.defer();

      $http.post('/logout', {logout: true}).then(function(){
        identity.currentUser = undefined;
        deferred.resolve();
      });

      return deferred.promise;

    },

    authorizeCurrentUserForRoute: function(role){
      if (identity.isAuthorized('admin')){
        return true;
      } else {
        return $q.reject('not authorized');
      }
    },

    authorizeAutheticatedUserForRoute: function(){
      if (identity.isAuthenticated()){
        return true;
      } else {
        return $q.reject('not a current user');
      }
    },

    createUser : function(newUserData) {
       var newUser = new UserService(newUserData);
       var deferred = $q.defer();

       newUser.$save().then(function(){
         identity.currentUser = newUser;
         deferred.resolve();
       }, function(response){
         deferred.reject(response.data.reason);
       });

       return deferred.promise;
    },

    updateCurrentUser: function(newUserData){
        var deferred = $q.defer();
        var clone = angular.copy(identity.currentUser);
        angular.extend(clone, newUserData);
        clone.$update().then(function(){
          identity.currentUser = clone;
          deferred.resolve();
        }, function(response){
          deferred.reject(response.data.reason);
        });
        return deferred.promise;
    }

  }// return

}]);

angular.module('users.identity', []).factory('IdentityService', ['$window', 'UserService', function($window, UserService){

  var currentUser;
  if(!!$window.bootstrappedUserObject) {
    currentUser = new UserService();
    angular.extend(currentUser, $window.bootstrappedUserObject);
  }
  return {
    currentUser: currentUser,
    isAuthenticated: function(){
      return !!this.currentUser;
    },

    isAuthorized: function(role){
      return !!this.currentUser && this.currentUser.roles.indexOf(role) > -1;
    }

  }

}]);

angular.module('users.login', []).controller('LoginController', ['$scope', 'IdentityService', 'NotifierService', 'AuthService', '$location', 'Meta', function($scope, identity, notifier, AuthService, $location, Meta){

    Meta.setTitle('Account');

    $scope.identity = identity;

    $scope.signIn = function(username, password){
      AuthService.authenticateUser(username, password).then(function(success){
        if(success){
          notifier.notify('You have signed in');
          $location.url('/account');
          $scope.actShown = false;
        } else {
          notifier.error('Username/Password Incorrect');
        }
      });
    };

    $scope.signOut = function(){
      AuthService.logoutUser().then(function() {
        $scope.username = '';
        $scope.password = '';
        notifier.notify('You have logged out');
        $location.path('/');
      });
    };

    $scope.signup = function(firstName, lastName, username, password){
      var newUserData = {
        'username': username,
        'firstName': firstName,
        'lastName': lastName,
        'password': password
      };
      AuthService.createUser(newUserData)
        .then(function(){
          notifier.notify('User Account Created');
          $location.path('/');
      }, function(message){
        notifier.error(message);
      });
    };
    $scope.cancel = function(){
      $location.path('/');
    };

    $scope.actShown = false;
    $scope.toggleAccount = function() {
      if(identity.isAuthenticated()){
        $location.path('/account');
      } else {
        $scope.actShown = !$scope.actShown;
      }
    };

    $scope.signupShown = false;
    $scope.toggleSignup = function() {
      $scope.signupShown = !$scope.signupShown;
    };


}]);

angular.module('users.service', ['ngResource']).factory('UserService', ['$resource', function($resource){

  var UserResource = $resource('/api/users/:id', {_id : '@id'}, {
    update: {method: 'PUT', isArray: false}
  });

  UserResource.prototype.isAdmin = function(){
    return this.roles && this.roles.indexOf('admin') > -1;
  }

  return UserResource;

}]);

angular.module('users', ['users.service', 'users.login', 'users.identity', 'users.auth']);

angular.module('willsBlog').controller('CarouselController', ['$scope', function($scope){
  $scope.slides = [
    { name: 'Mobile',
    svg: 'mobile-svg',
    desc: 'Is your website up to date with the most current mobile design trends? If not, you are loosing valuable business. Ensure that your customers can reach your business from anywhere and receive the best user experience. By building with responsive design in mind, your customers will get a pixel perfect look from mobile to tablet or desktop.' },

    { name: 'ECommerce',
    svg: 'ecomm-svg',
    desc: 'Do you have a new product you are looking to bring to market and need an e-commerce site or just looking for more modern feel to an existing site?  By utilizing robust ecommerce platforms, I can design and develop a site that will scale with your business and needs all in time to meet your busy deadlines. ' },

    { name: 'SEO',
    svg: 'seo-svg',
    desc: 'Having a modern design and user friendly website is great, but if customers can`t find your business, it wont matter much.  I design and develop every aspect of the website with search engine optimization in mind and so your customers can find you among the competition.  Also through research and analytics I can develop, plan and deploy the best SEO and marketing practices to increase conversions and retention.' }
  ];

  $scope.currentIndex = 0;
  $scope.setCurrentSlideIndex = function(index){
    $scope.currentIndex = index;
  }
  $scope.isCurrentSlideIndex = function(index){
    return $scope.currentIndex === index;
  }
}]);

angular.module('willsBlog').controller('MainController', ['$scope', '$location', 'CachedPostService', 'NotifierService' ,'$window', '$http', 'Meta',  function($scope, $location, CachedPostService, notifier, $window, $http, Meta){

  $(window).scroll(function() {
      var $bgobj = $('#home');
      var windowSize = $window.innerWidth;
      var xPos = (windowSize > 768) ? xPos = '50' : xPos = '20';
      var yPos = -( $(window).scrollTop() / $bgobj.data('speed'));
      var coords = xPos + '% '+ yPos + 'px';
      $bgobj.css({ backgroundPosition: coords });
  });

  $scope.aboutOptions = {
    origin: 'top',
    distance: '150px',
    easing: 'ease-in-out',
    delay: 30,
    scale: 1,
    duration: 1000,
    // reset: true,
    sequence: {
       selector: '.services-web',
       interval: 300
     }
  };

  Meta.setTitle('Home');
  Meta.setDesc('I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.');

  $scope.services = [
    { name: 'Development',
    svg: 'dev-logo',
    description: 'Customized and reusable code using the most up to date HTML5, CSS3 and Javascript framworks. Options range from static sites, content managed sites, and ecommerce stores.',
    more: 'Development Skills include HTML5, CSS, Javascript, Angular, Backbone, Node, Express, Boostrap and more.' },

    { name: 'Web Design',
    svg: 'design-logo',
    description: 'Creating an excellent user experience through clean, simple and thoroughly crafted design. Collaboration with clients during design process ensures a superb finished project.',
    more: 'Services include wire frames, photoshop mockups, logo design, and company branding.' },

    { name: 'Support',
    svg: 'sup-logo',
    description: 'Support is readily available for clients when anything comes up along the development process. Also available are personal instruction on how to maintain or update your own site.',
    more: 'Have a new product or feature you want to implement? Plans for continued support and maintenance are available.' }

  ];

  $scope.posts = CachedPostService.query();

  $scope.form = {};

  $scope.sendMail = function(){
    var data =({
      contactName : this.contactName,
      contactCompany : this.contactCompany,
      contactEmail : this.contactEmail,
      contactMessage : this.contactMessage
    });

    $http.post('/contact-form', data)
      .then(function(message, status, headers, config){
        notifier.notify('Thank you for your message ' + message.data.contactName);
           $scope.form.contactForm.$setPristine();
           $scope.form.contactForm.$setUntouched();
      }, function(message, status, headers, config){
        notifier.notify('There was an error processing your request. Please try again');
      });
      this.contactName = null;
      this.contactCompany = null;
      this.contactEmail = null;
      this.contactMessage = null;

  }

  $scope.getUser = function(username){
		TwitterService.getUser(username)
		    .then(function(data){
		        $scope.twitterErrors = undefined;
	        	$scope.tweets = JSON.parse(data.result.userData);
						// console.log($scope.tweets);
		    })
		    .catch(function(error){
		        console.error('there was an error retrieving data: ', error);
		        $scope.twitterErrors = error.error;
		    })
	};

  //$scope.getUser();

}]);

angular.module('willsBlog').controller('NavCtrl', ['$scope', '$location', '$document', function($scope, $location, $document){
  $scope.showMenu = function(){
      angular.element(document.getElementsByClassName('collapse')).toggleClass('in');
      angular.element(document.getElementsByClassName('navbar-toggle')).toggleClass('open');
  };

  $scope.scrollTop = function(){
    $document.scrollTopAnimated(0);
  };

  $scope.linkTo = function(id){

      var route = $location.url();
      var offset = 60;
      var duration = 800;
      var element = angular.element(document.getElementById(id));

      if(route !== '/'){
        $location.url('/', function(){
          $document.scrollToElement(element, offset, duration);
        });

      } else {
        $document.scrollToElement(element, offset, duration);
      }
    };

}]);

angular.module('willsBlog').controller('WorkController', ['$scope', function($scope){

  $scope.options = {
    origin: 'left',
    distance: '150px',
    easing: 'ease-in-out',
    delay: 30,
    scale: 1,
    duration: 1000,
    // reset: true,
    afterReveal: function (domEl) {
      document.getElementById("gallery").style.visibility = "visible";
    },
    sequence: {
       selector: '.gallery-inner',
       interval: 300
     }
  };

  $scope.projects = [
    {
      name: 'Tendril Inc.',
      link: 'https://www.tendrilinc.com',
      clickFunc: toggleTendril = function(){
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/tendril.jpg',
      modal: false,
      modalImg: 'img/gallery/tendril-mockup.png',
      noLink: false
    },
    {
      name: 'Crown Offroad',
      link: 'http://crownoffroad.com',
      clickFunc: toggleCrown = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/crown-offroad.jpg',
      modal: false,
      modalImg: 'img/gallery/crown-offroad-mockup.png',
      noLink: false
    },
    {
      name: 'Colorado Broadband Portal',
      link: 'http://broadband.co.gov',
      clickFunc: $scope.toggleBroad = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/wires.jpg',
      modal: false,
      modalImg: 'img/gallery/broadband.png',
      noLink: false
    },
    {
      name: 'adidas adiPlayer',
      link: '',
      clickFunc: toggleAdi = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/adiplayer.jpg',
      modal: false,
      modalImg: 'img/gallery/adiplayer_mockup.png',
      noLink: true
    }
  ]

}]);

angular.module('post.cache', []).factory('CachedPostService', ['PostService', function(PostService){
  var postList;

  return {
    query: function(){
      if(!postList){
        postList = PostService.query();
      }
      return postList;
    }
  }

}]);

angular.module('post.commentDirs', []).directive('commentForm', [function(){
  return{
    restrict: 'E',
    templateUrl: '/partials/posts/comment-form'
  }
}])

.directive('commentList', [function(){
  return{
    restrict: 'E',
    templateUrl: '/partials/posts/comment-list'
  }
}]);

angular.module('post.comments', []).service('CommentService', ['$http', 'NotifierService', function($http, notifier){

  this.postComment = function(data, slug){
    return $http.post('/api/posts/comments/' + slug, data)
      .then(function(response){
        notifier.notify('Thanks for submitting your comment ' + response.data.message);
      }, function(err){
        console.log(err);
        notifier.error('There was a problem submitting your comment.');
      });
  };

  this.deleteComment = function(data, slug){
    return $http.put('/api/posts/comments/' + slug, data)
      .then(function(response){
        notifier.notify('Comment number ' + response.data.message + ' has been deleted!');
      }, function(err){
        console.log(err);
        notifier.error('There was a problem deleting your comment.');
      });
  };

}]);

 angular.module('post.edit', []).controller('EditPostController', [ '$scope', '$location', '$stateParams', 'NotifierService', 'PostService', 'IdentityService', 'CommentService', 'Meta', function($scope, $location, $stateParams, notifier, PostService, identity, CommentService, Meta){

   Meta.setTitle('Edit Post');

    $scope.identity = identity;

    $scope.post = PostService.get({ slug: $stateParams.slug }, function(){
      //$scope.gistList = $scope.post.gists;
    });

    $scope.addGist = function(newGist){
      $scope.post.gists.push(newGist);
    };

    $scope.removeGist = function(){
      $scope.post.gists.pop();
    };

    $scope.post.data = {
        _id: $scope.post._id,
        title : $scope.post.title,
        slug: $scope.post.slug,
        categories : $scope.post.categories,
        excerpt : $scope.post.excerpt,
        body : $scope.post.body,
        author: $scope.post.author,
        postedDate: Date.now(),
        gists: $scope.post.gists
    };

    $scope.updatePost = function(){
        $scope.post.$update( { slug: $scope.post.slug }, function(){
          notifier.notify('Post has been updated');
          $location.path('/posts');
        }, function(message){
          notifier.error(message.data);
        });
    };

    $scope.deletePost = function(){
      $scope.post.$delete(function() {
        notifier.notify('Post has been deleted');
        $location.path('/posts');
      });
    };

    $scope.deleteComment = function(comment){
      var slug = $stateParams.slug;
      CommentService.deleteComment(comment, slug)
        .then(function(){
          $scope.post.comments.pop();
        }, function(){

        });
    };

    $scope.cancel = function(){
      $location.path('/posts');
    };

}]);

angular.module('post.new', []).controller('NewPostController', ['$scope', 'NotifierService', 'PostService', '$location', function($scope, notifier, PostService, $location){

  $scope.post = new PostService();

  $scope.createNewPost = function(){
    $scope.post.$save(function(){
        notifier.notify('New Post Created');
        $location.path('/posts');
    });
  }

  $scope.post.gists = [];
  $scope.addGist = function(newGist){
    $scope.post.gists.push(newGist);
  }

  $scope.removeGist = function(newGist){
    $scope.post.gists.pop();
  }

  $scope.cancel = function(){
    $location.path('/blog');
  }

}]);

angular.module('post', ['post.detail', 'post.service', 'post.new', 'post.edit', 'post.cache', 'post.list', 'post.comments', 'post.commentDirs']);

angular.module('post.service', ['ngResource']).factory('PostService', ['$resource', function($resource){

  var PostResource = $resource('/api/posts/:slug', {slug: '@slug'}, {
    update : {
      method: 'PUT'
    }
  });

  return PostResource;

}]);

angular.module('post.detail', []).controller('PostDetailController', ['$scope', 'CachedPostService', 'PostService', '$stateParams', 'Meta', 'NotifierService', 'CommentService', function($scope, CachedPostService, PostService, $stateParams, Meta, notifier, CommentService){

  CachedPostService.query().$promise.then(function(collection){
    collection.forEach(function(post){
      if(post.slug === $stateParams.slug){
        $scope.post = post;
        var title = $scope.post.title,
            desc = $scope.post.excerpt;
        Meta.setTitle(title);
        Meta.setDesc(desc);
      }
    });
  });

  $scope.submitComment = function(){
    var comment = {
      'content': $scope.comment.content,
      'date': Date.now(),
      'firstName': $scope.comment.firstName,
      'lastName': $scope.comment.lastName,
    };
    var slug = $stateParams.slug;
    CommentService.postComment(comment, slug)
      .then(function(){
        $scope.post.comments.push(comment);
        $scope.comment.content= "";
        $scope.comment.firstName= "";
        $scope.comment.lastName= "";
      }, function(){
      });
  };

}]);

angular.module('post.list', []).controller('PostListController', ['$scope', 'PostService',  function($scope, PostService){

  //Meta.setTitle('Posts');

  $scope.posts = PostService.query();

  //$scope.identity = identity;

  $scope.sortOptions= [
    {value: 'published', text: 'Published Date'},
    {value: 'title', text: 'Sort by Title'}
  ]

  $scope.sortOrder = $scope.sortOptions[0].value;
}]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFkbWluL3Byb2ZpbGUuY29udHJvbGxlci5qcyIsImFkbWluL3VzZXJMaXN0LmNvbnRyb2xsZXIuanMiLCJjb21tb24vbWV0YS5jb250cm9sbGVyLmpzIiwiY29tbW9uL21vZGFsLmRpcmVjdGl2ZS5qcyIsImNvbW1vbi9ub3RpZmllci5zZXJ2aWNlLmpzIiwiY29tbW9uL3R3aXR0ZXIuanMiLCJsb2dpbi9hdXRoLnNlcnZpY2UuanMiLCJsb2dpbi9pZGVudGl0eS5zZXJ2aWNlLmpzIiwibG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsImxvZ2luL3VzZXIuc2VydmljZS5qcyIsImxvZ2luL3VzZXJzLm1vZHVsZS5qcyIsIm1haW4vY2Fyb3VzZWwuY29udHJvbGxlci5qcyIsIm1haW4vbWFpbi5jb250cm9sbGVyLmpzIiwibWFpbi9uYXYuY29udHJvbGxlci5qcyIsIm1haW4vd29yay5jb250cm9sbGVyLmpzIiwicG9zdHMvY2hhY2hlZFBvc3Quc2VydmljZS5qcyIsInBvc3RzL2NvbW1lbnQuZGlyZWN0aXZlLmpzIiwicG9zdHMvY29tbWVudC5zZXJ2aWNlLmpzIiwicG9zdHMvZWRpdFBvc3QuY29udHJvbGxlci5qcyIsInBvc3RzL25ld1Bvc3QuY29udHJvbGxlci5qcyIsInBvc3RzL3Bvc3QubW9kdWxlLmpzIiwicG9zdHMvcG9zdC5zZXJ2aWNlLmpzIiwicG9zdHMvcG9zdERldGFpbC5jb250cm9sbGVyLmpzIiwicG9zdHMvcG9zdExpc3QuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJywgWyd1c2VycycsICdwb3N0JywgJ25nUmVzb3VyY2UnLCAnbmdTYW5pdGl6ZScsICd1aS5yb3V0ZXInLCAnZHVTY3JvbGwnLCAnZ2lzdCcsICduZ1Njcm9sbFJldmVhbCddKTtcblxuYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbmZpZyhbJyRsb2NhdGlvblByb3ZpZGVyJywgJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlcicsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKXtcblxuICAgIHZhciByb3V0ZVJvbGVDaGVja3MgPSB7XG4gICAgICBhZG1pbjogZnVuY3Rpb24oQXV0aFNlcnZpY2Upe1xuICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5hdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKCdhZG1pbicpO1xuICAgICAgfSxcbiAgICAgIHVzZXI6IGZ1bmN0aW9uKEF1dGhTZXJ2aWNlKXtcbiAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuYXV0aG9yaXplQXV0aGV0aWNhdGVkVXNlckZvclJvdXRlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICB1cmw6ICcvJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL21haW4vbWFpbicsXG4gICAgICBjb250cm9sbGVyOiAnTWFpbkNvbnRyb2xsZXInXG4gICAgfSlcbiAgICAuc3RhdGUoJ2FjY291bnQnLCB7XG4gICAgICB1cmw6ICcvYWNjb3VudCcsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9sb2dpbi9sb2dpbicsXG4gICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdwb3N0cycsIHtcbiAgICAgIHVybDogJy9wb3N0cycsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9wb3N0cy9wb3N0LWxpc3QnLFxuICAgICAgY29udHJvbGxlcjogJ1Bvc3RMaXN0Q29udHJvbGxlcidcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvZmlsZScsIHtcbiAgICAgIHVybDogJy9wcm9maWxlJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3Byb2ZpbGUnLFxuICAgICAgY29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgcm91dGVSb2xlQ2hlY2s6IFsnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbihBdXRoU2VydmljZSl7XG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuYXV0aG9yaXplQXV0aGV0aWNhdGVkVXNlckZvclJvdXRlKCk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSlcbiAgICAuc3RhdGUoJ3Bvc3REZXRhaWwnLCB7XG4gICAgICB1cmw6ICcvcG9zdHMvOnNsdWcnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvcG9zdC1kZXRhaWwnLFxuICAgICAgY29udHJvbGxlcjogJ1Bvc3REZXRhaWxDb250cm9sbGVyJ1xuICAgIH0pXG4gICAgLnN0YXRlKCduZXdQb3N0Jywge1xuICAgICAgdXJsOiAnL2FkbWluL25ldy1wb3N0JyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL3Bvc3RzL25ldy1wb3N0JyxcbiAgICAgIGNvbnRyb2xsZXI6ICdOZXdQb3N0Q29udHJvbGxlcicsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHJvdXRlUm9sZUNoZWNrOiBbJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oQXV0aFNlcnZpY2Upe1xuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSlcbiAgICAuc3RhdGUoJ2VkaXRQb3N0Jywge1xuICAgICAgdXJsOiAnL2FkbWluLzpzbHVnL2VkaXQnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvZWRpdC1wb3N0JyxcbiAgICAgIGNvbnRyb2xsZXI6ICdFZGl0UG9zdENvbnRyb2xsZXInLFxuICAgICAgcmVzb2x2ZToge1xuICAgICAgICByb3V0ZVJvbGVDaGVjazogWydBdXRoU2VydmljZScsIGZ1bmN0aW9uKEF1dGhTZXJ2aWNlKXtcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5hdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKCdhZG1pbicpO1xuICAgICAgICB9XG4gICAgICBdfVxuICAgIH0pXG4gICAgLnN0YXRlKCd1c2VycycsIHtcbiAgICAgIHVybDogJy9hZG1pbi91c2VycycsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hZG1pbi91c2Vycy1saXN0JyxcbiAgICAgIGNvbnRyb2xsZXI6ICdVc2VyTGlzdENvbnRyb2xsZXInLFxuICAgICAgcmVzb2x2ZToge1xuICAgICAgICByb3V0ZVJvbGVDaGVjazogWydBdXRoU2VydmljZScsIGZ1bmN0aW9uKEF1dGhTZXJ2aWNlKXtcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5hdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKCdhZG1pbicpO1xuICAgICAgICB9XG4gICAgICBdfVxuICAgIH0pO1xuXG59XSk7Ly9lbmQgY29uZmlnXG5cblxuYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLnJ1bihbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyRhbmNob3JTY3JvbGwnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRhbmNob3JTY3JvbGwpe1xuXG4gICRhbmNob3JTY3JvbGwueU9mZnNldCA9IDYwO1xuXG4gICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uKGV2dCwgY3VycmVudCwgcHJldmlvdXMsIHJlamVjdGlvbikge1xuICAgICAgaWYocmVqZWN0aW9uID09PSAnbm90IGF1dGhvcml6ZWQnKSB7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICB9XG4gIH0pO1xuXG4gICRyb290U2NvcGUuJG9uKFwiJHN0YXRlQ2hhbmdlU3VjY2Vzc1wiLCBmdW5jdGlvbiAoZXZlbnQsIGN1cnJlbnRSb3V0ZSwgcHJldmlvdXNSb3V0ZSkge1xuICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcbiAgfSk7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0F1dGhTZXJ2aWNlJywgJ0lkZW50aXR5U2VydmljZScsICdOb3RpZmllclNlcnZpY2UnLCBmdW5jdGlvbigkc2NvcGUsIEF1dGhTZXJ2aWNlLCBpZGVudGl0eSwgbm90aWZpZXIpe1xuICAkc2NvcGUudXNlcm5hbWUgPSBpZGVudGl0eS5jdXJyZW50VXNlci51c2VybmFtZTtcbiAgJHNjb3BlLmZOYW1lID0gaWRlbnRpdHkuY3VycmVudFVzZXIuZmlyc3ROYW1lO1xuICAkc2NvcGUubE5hbWUgPSBpZGVudGl0eS5jdXJyZW50VXNlci5sYXN0TmFtZTtcblxuICAkc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBuZXdVc2VyRGF0YSA9IHtcbiAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VybmFtZSxcbiAgICAgICAgZmlyc3ROYW1lOiAkc2NvcGUuZk5hbWUsXG4gICAgICAgIGxhc3ROYW1lOiAkc2NvcGUubE5hbWVcbiAgICAgIH1cblxuICAgICAgaWYoJHNjb3BlLnBhc3N3b3JkICYmICRzY29wZS5wYXNzd29yZC5sZW5ndGggPiAwKSB7XG4gICAgICAgbmV3VXNlckRhdGEucGFzc3dvcmQgPSAkc2NvcGUucGFzc3dvcmQ7XG4gICAgICB9XG5cbiAgICAgIEF1dGhTZXJ2aWNlLnVwZGF0ZUN1cnJlbnRVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnWW91ciBpbmZvcm1hdGlvbiBoYXMgYmVlbiB1cGRhdGVkJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbil7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IocmVhc29uKTtcbiAgICAgICAgfSk7XG4gIH1cblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ1VzZXJMaXN0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU2VydmljZSl7XG4gICRzY29wZS51c2VycyA9IFVzZXJTZXJ2aWNlLnF1ZXJ5KCk7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZmFjdG9yeSgnTWV0YScsIGZ1bmN0aW9uKCl7XG4gIHZhciB0aXRsZSA9ICdXZWIgRGV2ZWxvcG1lbnQsIFNlYXR0bGUsIFdBJztcbiAgdmFyIGRlc2MgPSAnSSBlbmpveSBhbGwgdGhpbmdzIHdlYiBkZXZlbG9wbWVudCBhbmQgYW0gYWx3YXlzIGFjdGl2ZWx5IGxlYXJuaW5nIHRoZSBuZXdlc3QgdGVjaG5pcXVlcyBhbmQgbGFuZ2F1Z2VzLiBJZiB5b3UgaGF2ZSBhIHdlYiBkZXNpZ24gb3IgZGV2ZWxvcG1lbnQgcHJvamVjdCwgZ2l2ZSBtZSBhIHNob3V0LCBJIHdvdWxkIGxvdmUgdG8gdGFsayBhYm91dCBpdC4nO1xuICByZXR1cm4ge1xuICAgIHRpdGxlOiBmdW5jdGlvbigpIHtyZXR1cm4gdGl0bGU7fSxcbiAgICBzZXRUaXRsZTogZnVuY3Rpb24obmV3VGl0bGUpIHsgdGl0bGUgPSBuZXdUaXRsZSB9LFxuICAgIGRlc2NyaXB0aW9uOiBmdW5jdGlvbigpIHsgcmV0dXJuIGRlc2M7fSxcbiAgICBzZXREZXNjIDogZnVuY3Rpb24obmV3RGVzYykgeyBkZXNjID0gbmV3RGVzY31cbiAgfVxufSlcbi5jb250cm9sbGVyKCdNZXRhQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ01ldGEnLCBmdW5jdGlvbigkc2NvcGUsIE1ldGEpe1xuICAkc2NvcGUuTWV0YSA9IE1ldGE7XG4gICRzY29wZS5tZXRhRGVzYyA9IE1ldGE7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZGlyZWN0aXZlKCdnbG9iYWxNb2RhbCcsIGZ1bmN0aW9uKCl7XG4gIHJldHVybntcbiAgICByZXN0cmljdDogJ0UnLFxuICAgIHNjb3BlOiB7XG4gICAgICBzaG93OiAnPSdcbiAgICB9LFxuICAgIHJlcGxhY2U6IHRydWUsXG4gICAgdHJhbnNjbHVkZTogdHJ1ZSxcbiAgICBsaW5rIDogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKXtcbiAgICAgIHNjb3BlLmRpYWxvZ1N0eWxlID0ge307XG4gICAgICBpZihhdHRycy53aWR0aClcbiAgICAgICAgc2NvcGUuZGlhbG9nU3R5bGUud2lkdGggPSBhdHRycy53aWR0aDtcbiAgICAgIGlmIChhdHRycy5oZWlnaHQpXG4gICAgICAgIHNjb3BlLmRpYWxvZ1N0eWxlLmhlaWdodCA9IGF0dHJzLmhlaWdodDtcblxuICAgICAgc2NvcGUuaGlkZU1vZGFsID0gZnVuY3Rpb24oKXtcbiAgICAgICAgc2NvcGUuc2hvdyA9IGZhbHNlO1xuICAgICAgfTtcbiAgICB9LFxuICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2NvbW1vbi9tb2RhbCdcbiAgfVxufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykudmFsdWUoJ25vdGlmaWM4Jywgbm90aWZpYzgpO1xuXG5hbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZmFjdG9yeSgnTm90aWZpZXJTZXJ2aWNlJywgWydub3RpZmljOCcsIGZ1bmN0aW9uKG5vdGlmaWM4KXtcblxuICBub3RpZmljOCgnY29uZmlndXJlJywge1xuICAgIGxpZmU6IDMwMDAsXG4gICAgdGhlbWU6ICdhdG9taWMnLFxuICAgIHppbmRleDogOTk5OSxcbiAgICB2ZXJ0aWNhbEVkZ2U6ICdyaWdodCcsXG4gICAgaG9yaXpvbnRhbEVkZ2U6ICd0b3AnLFxuICAgIGNsb3NlVGV4dDogJ1gnXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgbm90aWZ5OiBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgIG5vdGlmaWM4KG1lc3NhZ2UsIHtjb2xvcjogJ3BlYXInfSk7XG4gICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICB9LFxuICAgIGVycm9yOiBmdW5jdGlvbihtZXNzYWdlKXtcbiAgICAgIG5vdGlmaWM4KG1lc3NhZ2UsIHtjb2xvcjogJ3RvbWF0byd9KTtcbiAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmZhY3RvcnkoJ1R3aXR0ZXJTZXJ2aWNlJywgWyckaHR0cCcsICckcScsIGZ1bmN0aW9uKCRodHRwLCAkcSl7XG5cbiAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbih1c2VybmFtZSl7XG4gICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgJGh0dHAucG9zdCgnL3R3aXR0ZXIvdXNlcicsIHt1c2VybmFtZSA6IHVzZXJuYW1lfSlcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICByZXR1cm4gZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgIHJldHVybiBkLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICBnZXRVc2VyIDogZ2V0VXNlclxuICAgIH1cbn1dKTtcbiIsIlxuYW5ndWxhci5tb2R1bGUoJ3VzZXJzLmF1dGgnLCBbXSkuZmFjdG9yeSgnQXV0aFNlcnZpY2UnLCBbJyRodHRwJywgJ0lkZW50aXR5U2VydmljZScsICckcScsICdVc2VyU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCBpZGVudGl0eSwgJHEsIFVzZXJTZXJ2aWNlKXtcblxuICByZXR1cm4ge1xuICAgIC8vIHRoaXMgdGhpbmcgd29ya2luZ1xuICAgIGF1dGhlbnRpY2F0ZVVzZXI6IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCl7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KCcvbG9naW4nLCB7XG4gICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3VjY2Vzcyl7XG5cbiAgICAgICAgICB2YXIgdXNlciA9IG5ldyBVc2VyU2VydmljZSgpO1xuICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHVzZXIsIHJlc3BvbnNlLmRhdGEudXNlcik7XG4gICAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgbG9nb3V0VXNlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KCcvbG9nb3V0Jywge2xvZ291dDogdHJ1ZX0pLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIH0sXG5cbiAgICBhdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlOiBmdW5jdGlvbihyb2xlKXtcbiAgICAgIGlmIChpZGVudGl0eS5pc0F1dGhvcml6ZWQoJ2FkbWluJykpe1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAkcS5yZWplY3QoJ25vdCBhdXRob3JpemVkJyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGF1dGhvcml6ZUF1dGhldGljYXRlZFVzZXJGb3JSb3V0ZTogZnVuY3Rpb24oKXtcbiAgICAgIGlmIChpZGVudGl0eS5pc0F1dGhlbnRpY2F0ZWQoKSl7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICRxLnJlamVjdCgnbm90IGEgY3VycmVudCB1c2VyJyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNyZWF0ZVVzZXIgOiBmdW5jdGlvbihuZXdVc2VyRGF0YSkge1xuICAgICAgIHZhciBuZXdVc2VyID0gbmV3IFVzZXJTZXJ2aWNlKG5ld1VzZXJEYXRhKTtcbiAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgbmV3VXNlci4kc2F2ZSgpLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgIGlkZW50aXR5LmN1cnJlbnRVc2VyID0gbmV3VXNlcjtcbiAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UuZGF0YS5yZWFzb24pO1xuICAgICAgIH0pO1xuXG4gICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcblxuICAgIHVwZGF0ZUN1cnJlbnRVc2VyOiBmdW5jdGlvbihuZXdVc2VyRGF0YSl7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIHZhciBjbG9uZSA9IGFuZ3VsYXIuY29weShpZGVudGl0eS5jdXJyZW50VXNlcik7XG4gICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNsb25lLCBuZXdVc2VyRGF0YSk7XG4gICAgICAgIGNsb25lLiR1cGRhdGUoKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSBjbG9uZTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UuZGF0YS5yZWFzb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gIH0vLyByZXR1cm5cblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3VzZXJzLmlkZW50aXR5JywgW10pLmZhY3RvcnkoJ0lkZW50aXR5U2VydmljZScsIFsnJHdpbmRvdycsICdVc2VyU2VydmljZScsIGZ1bmN0aW9uKCR3aW5kb3csIFVzZXJTZXJ2aWNlKXtcblxuICB2YXIgY3VycmVudFVzZXI7XG4gIGlmKCEhJHdpbmRvdy5ib290c3RyYXBwZWRVc2VyT2JqZWN0KSB7XG4gICAgY3VycmVudFVzZXIgPSBuZXcgVXNlclNlcnZpY2UoKTtcbiAgICBhbmd1bGFyLmV4dGVuZChjdXJyZW50VXNlciwgJHdpbmRvdy5ib290c3RyYXBwZWRVc2VyT2JqZWN0KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRVc2VyO1xuICAgIH0sXG5cbiAgICBpc0F1dGhvcml6ZWQ6IGZ1bmN0aW9uKHJvbGUpe1xuICAgICAgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnJvbGVzLmluZGV4T2Yocm9sZSkgPiAtMTtcbiAgICB9XG5cbiAgfVxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndXNlcnMubG9naW4nLCBbXSkuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnSWRlbnRpdHlTZXJ2aWNlJywgJ05vdGlmaWVyU2VydmljZScsICdBdXRoU2VydmljZScsICckbG9jYXRpb24nLCAnTWV0YScsIGZ1bmN0aW9uKCRzY29wZSwgaWRlbnRpdHksIG5vdGlmaWVyLCBBdXRoU2VydmljZSwgJGxvY2F0aW9uLCBNZXRhKXtcblxuICAgIE1ldGEuc2V0VGl0bGUoJ0FjY291bnQnKTtcblxuICAgICRzY29wZS5pZGVudGl0eSA9IGlkZW50aXR5O1xuXG4gICAgJHNjb3BlLnNpZ25JbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCl7XG4gICAgICBBdXRoU2VydmljZS5hdXRoZW50aWNhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbihmdW5jdGlvbihzdWNjZXNzKXtcbiAgICAgICAgaWYoc3VjY2Vzcyl7XG4gICAgICAgICAgbm90aWZpZXIubm90aWZ5KCdZb3UgaGF2ZSBzaWduZWQgaW4nKTtcbiAgICAgICAgICAkbG9jYXRpb24udXJsKCcvYWNjb3VudCcpO1xuICAgICAgICAgICRzY29wZS5hY3RTaG93biA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5vdGlmaWVyLmVycm9yKCdVc2VybmFtZS9QYXNzd29yZCBJbmNvcnJlY3QnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaWduT3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgIEF1dGhTZXJ2aWNlLmxvZ291dFVzZXIoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSAnJztcbiAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gJyc7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnWW91IGhhdmUgbG9nZ2VkIG91dCcpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zaWdudXAgPSBmdW5jdGlvbihmaXJzdE5hbWUsIGxhc3ROYW1lLCB1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgICAgdmFyIG5ld1VzZXJEYXRhID0ge1xuICAgICAgICAndXNlcm5hbWUnOiB1c2VybmFtZSxcbiAgICAgICAgJ2ZpcnN0TmFtZSc6IGZpcnN0TmFtZSxcbiAgICAgICAgJ2xhc3ROYW1lJzogbGFzdE5hbWUsXG4gICAgICAgICdwYXNzd29yZCc6IHBhc3N3b3JkXG4gICAgICB9O1xuICAgICAgQXV0aFNlcnZpY2UuY3JlYXRlVXNlcihuZXdVc2VyRGF0YSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1VzZXIgQWNjb3VudCBDcmVhdGVkJyk7XG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgIH0sIGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgICAgICBub3RpZmllci5lcnJvcihtZXNzYWdlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWN0U2hvd24gPSBmYWxzZTtcbiAgICAkc2NvcGUudG9nZ2xlQWNjb3VudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYoaWRlbnRpdHkuaXNBdXRoZW50aWNhdGVkKCkpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2FjY291bnQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRzY29wZS5hY3RTaG93biA9ICEkc2NvcGUuYWN0U2hvd247XG4gICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5zaWdudXBTaG93biA9IGZhbHNlO1xuICAgICRzY29wZS50b2dnbGVTaWdudXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICRzY29wZS5zaWdudXBTaG93biA9ICEkc2NvcGUuc2lnbnVwU2hvd247XG4gICAgfTtcblxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndXNlcnMuc2VydmljZScsIFsnbmdSZXNvdXJjZSddKS5mYWN0b3J5KCdVc2VyU2VydmljZScsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKXtcblxuICB2YXIgVXNlclJlc291cmNlID0gJHJlc291cmNlKCcvYXBpL3VzZXJzLzppZCcsIHtfaWQgOiAnQGlkJ30sIHtcbiAgICB1cGRhdGU6IHttZXRob2Q6ICdQVVQnLCBpc0FycmF5OiBmYWxzZX1cbiAgfSk7XG5cbiAgVXNlclJlc291cmNlLnByb3RvdHlwZS5pc0FkbWluID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5yb2xlcyAmJiB0aGlzLnJvbGVzLmluZGV4T2YoJ2FkbWluJykgPiAtMTtcbiAgfVxuXG4gIHJldHVybiBVc2VyUmVzb3VyY2U7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd1c2VycycsIFsndXNlcnMuc2VydmljZScsICd1c2Vycy5sb2dpbicsICd1c2Vycy5pZGVudGl0eScsICd1c2Vycy5hdXRoJ10pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ0Nhcm91c2VsQ29udHJvbGxlcicsIFsnJHNjb3BlJywgZnVuY3Rpb24oJHNjb3BlKXtcbiAgJHNjb3BlLnNsaWRlcyA9IFtcbiAgICB7IG5hbWU6ICdNb2JpbGUnLFxuICAgIHN2ZzogJ21vYmlsZS1zdmcnLFxuICAgIGRlc2M6ICdJcyB5b3VyIHdlYnNpdGUgdXAgdG8gZGF0ZSB3aXRoIHRoZSBtb3N0IGN1cnJlbnQgbW9iaWxlIGRlc2lnbiB0cmVuZHM/IElmIG5vdCwgeW91IGFyZSBsb29zaW5nIHZhbHVhYmxlIGJ1c2luZXNzLiBFbnN1cmUgdGhhdCB5b3VyIGN1c3RvbWVycyBjYW4gcmVhY2ggeW91ciBidXNpbmVzcyBmcm9tIGFueXdoZXJlIGFuZCByZWNlaXZlIHRoZSBiZXN0IHVzZXIgZXhwZXJpZW5jZS4gQnkgYnVpbGRpbmcgd2l0aCByZXNwb25zaXZlIGRlc2lnbiBpbiBtaW5kLCB5b3VyIGN1c3RvbWVycyB3aWxsIGdldCBhIHBpeGVsIHBlcmZlY3QgbG9vayBmcm9tIG1vYmlsZSB0byB0YWJsZXQgb3IgZGVza3RvcC4nIH0sXG5cbiAgICB7IG5hbWU6ICdFQ29tbWVyY2UnLFxuICAgIHN2ZzogJ2Vjb21tLXN2ZycsXG4gICAgZGVzYzogJ0RvIHlvdSBoYXZlIGEgbmV3IHByb2R1Y3QgeW91IGFyZSBsb29raW5nIHRvIGJyaW5nIHRvIG1hcmtldCBhbmQgbmVlZCBhbiBlLWNvbW1lcmNlIHNpdGUgb3IganVzdCBsb29raW5nIGZvciBtb3JlIG1vZGVybiBmZWVsIHRvIGFuIGV4aXN0aW5nIHNpdGU/ICBCeSB1dGlsaXppbmcgcm9idXN0IGVjb21tZXJjZSBwbGF0Zm9ybXMsIEkgY2FuIGRlc2lnbiBhbmQgZGV2ZWxvcCBhIHNpdGUgdGhhdCB3aWxsIHNjYWxlIHdpdGggeW91ciBidXNpbmVzcyBhbmQgbmVlZHMgYWxsIGluIHRpbWUgdG8gbWVldCB5b3VyIGJ1c3kgZGVhZGxpbmVzLiAnIH0sXG5cbiAgICB7IG5hbWU6ICdTRU8nLFxuICAgIHN2ZzogJ3Nlby1zdmcnLFxuICAgIGRlc2M6ICdIYXZpbmcgYSBtb2Rlcm4gZGVzaWduIGFuZCB1c2VyIGZyaWVuZGx5IHdlYnNpdGUgaXMgZ3JlYXQsIGJ1dCBpZiBjdXN0b21lcnMgY2FuYHQgZmluZCB5b3VyIGJ1c2luZXNzLCBpdCB3b250IG1hdHRlciBtdWNoLiAgSSBkZXNpZ24gYW5kIGRldmVsb3AgZXZlcnkgYXNwZWN0IG9mIHRoZSB3ZWJzaXRlIHdpdGggc2VhcmNoIGVuZ2luZSBvcHRpbWl6YXRpb24gaW4gbWluZCBhbmQgc28geW91ciBjdXN0b21lcnMgY2FuIGZpbmQgeW91IGFtb25nIHRoZSBjb21wZXRpdGlvbi4gIEFsc28gdGhyb3VnaCByZXNlYXJjaCBhbmQgYW5hbHl0aWNzIEkgY2FuIGRldmVsb3AsIHBsYW4gYW5kIGRlcGxveSB0aGUgYmVzdCBTRU8gYW5kIG1hcmtldGluZyBwcmFjdGljZXMgdG8gaW5jcmVhc2UgY29udmVyc2lvbnMgYW5kIHJldGVudGlvbi4nIH1cbiAgXTtcblxuICAkc2NvcGUuY3VycmVudEluZGV4ID0gMDtcbiAgJHNjb3BlLnNldEN1cnJlbnRTbGlkZUluZGV4ID0gZnVuY3Rpb24oaW5kZXgpe1xuICAgICRzY29wZS5jdXJyZW50SW5kZXggPSBpbmRleDtcbiAgfVxuICAkc2NvcGUuaXNDdXJyZW50U2xpZGVJbmRleCA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRJbmRleCA9PT0gaW5kZXg7XG4gIH1cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd3aWxsc0Jsb2cnKS5jb250cm9sbGVyKCdNYWluQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICdDYWNoZWRQb3N0U2VydmljZScsICdOb3RpZmllclNlcnZpY2UnICwnJHdpbmRvdycsICckaHR0cCcsICdNZXRhJywgIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCBDYWNoZWRQb3N0U2VydmljZSwgbm90aWZpZXIsICR3aW5kb3csICRodHRwLCBNZXRhKXtcblxuICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyICRiZ29iaiA9ICQoJyNob21lJyk7XG4gICAgICB2YXIgd2luZG93U2l6ZSA9ICR3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgIHZhciB4UG9zID0gKHdpbmRvd1NpemUgPiA3NjgpID8geFBvcyA9ICc1MCcgOiB4UG9zID0gJzIwJztcbiAgICAgIHZhciB5UG9zID0gLSggJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC8gJGJnb2JqLmRhdGEoJ3NwZWVkJykpO1xuICAgICAgdmFyIGNvb3JkcyA9IHhQb3MgKyAnJSAnKyB5UG9zICsgJ3B4JztcbiAgICAgICRiZ29iai5jc3MoeyBiYWNrZ3JvdW5kUG9zaXRpb246IGNvb3JkcyB9KTtcbiAgfSk7XG5cbiAgJHNjb3BlLmFib3V0T3B0aW9ucyA9IHtcbiAgICBvcmlnaW46ICd0b3AnLFxuICAgIGRpc3RhbmNlOiAnMTUwcHgnLFxuICAgIGVhc2luZzogJ2Vhc2UtaW4tb3V0JyxcbiAgICBkZWxheTogMzAsXG4gICAgc2NhbGU6IDEsXG4gICAgZHVyYXRpb246IDEwMDAsXG4gICAgLy8gcmVzZXQ6IHRydWUsXG4gICAgc2VxdWVuY2U6IHtcbiAgICAgICBzZWxlY3RvcjogJy5zZXJ2aWNlcy13ZWInLFxuICAgICAgIGludGVydmFsOiAzMDBcbiAgICAgfVxuICB9O1xuXG4gIE1ldGEuc2V0VGl0bGUoJ0hvbWUnKTtcbiAgTWV0YS5zZXREZXNjKCdJIGVuam95IGFsbCB0aGluZ3Mgd2ViIGRldmVsb3BtZW50IGFuZCBhbSBhbHdheXMgYWN0aXZlbHkgbGVhcm5pbmcgdGhlIG5ld2VzdCB0ZWNobmlxdWVzIGFuZCBsYW5nYXVnZXMuIElmIHlvdSBoYXZlIGEgd2ViIGRlc2lnbiBvciBkZXZlbG9wbWVudCBwcm9qZWN0LCBnaXZlIG1lIGEgc2hvdXQsIEkgd291bGQgbG92ZSB0byB0YWxrIGFib3V0IGl0LicpO1xuXG4gICRzY29wZS5zZXJ2aWNlcyA9IFtcbiAgICB7IG5hbWU6ICdEZXZlbG9wbWVudCcsXG4gICAgc3ZnOiAnZGV2LWxvZ28nLFxuICAgIGRlc2NyaXB0aW9uOiAnQ3VzdG9taXplZCBhbmQgcmV1c2FibGUgY29kZSB1c2luZyB0aGUgbW9zdCB1cCB0byBkYXRlIEhUTUw1LCBDU1MzIGFuZCBKYXZhc2NyaXB0IGZyYW13b3Jrcy4gT3B0aW9ucyByYW5nZSBmcm9tIHN0YXRpYyBzaXRlcywgY29udGVudCBtYW5hZ2VkIHNpdGVzLCBhbmQgZWNvbW1lcmNlIHN0b3Jlcy4nLFxuICAgIG1vcmU6ICdEZXZlbG9wbWVudCBTa2lsbHMgaW5jbHVkZSBIVE1MNSwgQ1NTLCBKYXZhc2NyaXB0LCBBbmd1bGFyLCBCYWNrYm9uZSwgTm9kZSwgRXhwcmVzcywgQm9vc3RyYXAgYW5kIG1vcmUuJyB9LFxuXG4gICAgeyBuYW1lOiAnV2ViIERlc2lnbicsXG4gICAgc3ZnOiAnZGVzaWduLWxvZ28nLFxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRpbmcgYW4gZXhjZWxsZW50IHVzZXIgZXhwZXJpZW5jZSB0aHJvdWdoIGNsZWFuLCBzaW1wbGUgYW5kIHRob3JvdWdobHkgY3JhZnRlZCBkZXNpZ24uIENvbGxhYm9yYXRpb24gd2l0aCBjbGllbnRzIGR1cmluZyBkZXNpZ24gcHJvY2VzcyBlbnN1cmVzIGEgc3VwZXJiIGZpbmlzaGVkIHByb2plY3QuJyxcbiAgICBtb3JlOiAnU2VydmljZXMgaW5jbHVkZSB3aXJlIGZyYW1lcywgcGhvdG9zaG9wIG1vY2t1cHMsIGxvZ28gZGVzaWduLCBhbmQgY29tcGFueSBicmFuZGluZy4nIH0sXG5cbiAgICB7IG5hbWU6ICdTdXBwb3J0JyxcbiAgICBzdmc6ICdzdXAtbG9nbycsXG4gICAgZGVzY3JpcHRpb246ICdTdXBwb3J0IGlzIHJlYWRpbHkgYXZhaWxhYmxlIGZvciBjbGllbnRzIHdoZW4gYW55dGhpbmcgY29tZXMgdXAgYWxvbmcgdGhlIGRldmVsb3BtZW50IHByb2Nlc3MuIEFsc28gYXZhaWxhYmxlIGFyZSBwZXJzb25hbCBpbnN0cnVjdGlvbiBvbiBob3cgdG8gbWFpbnRhaW4gb3IgdXBkYXRlIHlvdXIgb3duIHNpdGUuJyxcbiAgICBtb3JlOiAnSGF2ZSBhIG5ldyBwcm9kdWN0IG9yIGZlYXR1cmUgeW91IHdhbnQgdG8gaW1wbGVtZW50PyBQbGFucyBmb3IgY29udGludWVkIHN1cHBvcnQgYW5kIG1haW50ZW5hbmNlIGFyZSBhdmFpbGFibGUuJyB9XG5cbiAgXTtcblxuICAkc2NvcGUucG9zdHMgPSBDYWNoZWRQb3N0U2VydmljZS5xdWVyeSgpO1xuXG4gICRzY29wZS5mb3JtID0ge307XG5cbiAgJHNjb3BlLnNlbmRNYWlsID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZGF0YSA9KHtcbiAgICAgIGNvbnRhY3ROYW1lIDogdGhpcy5jb250YWN0TmFtZSxcbiAgICAgIGNvbnRhY3RDb21wYW55IDogdGhpcy5jb250YWN0Q29tcGFueSxcbiAgICAgIGNvbnRhY3RFbWFpbCA6IHRoaXMuY29udGFjdEVtYWlsLFxuICAgICAgY29udGFjdE1lc3NhZ2UgOiB0aGlzLmNvbnRhY3RNZXNzYWdlXG4gICAgfSk7XG5cbiAgICAkaHR0cC5wb3N0KCcvY29udGFjdC1mb3JtJywgZGF0YSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKG1lc3NhZ2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKXtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdUaGFuayB5b3UgZm9yIHlvdXIgbWVzc2FnZSAnICsgbWVzc2FnZS5kYXRhLmNvbnRhY3ROYW1lKTtcbiAgICAgICAgICAgJHNjb3BlLmZvcm0uY29udGFjdEZvcm0uJHNldFByaXN0aW5lKCk7XG4gICAgICAgICAgICRzY29wZS5mb3JtLmNvbnRhY3RGb3JtLiRzZXRVbnRvdWNoZWQoKTtcbiAgICAgIH0sIGZ1bmN0aW9uKG1lc3NhZ2UsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKXtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB5b3VyIHJlcXVlc3QuIFBsZWFzZSB0cnkgYWdhaW4nKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250YWN0TmFtZSA9IG51bGw7XG4gICAgICB0aGlzLmNvbnRhY3RDb21wYW55ID0gbnVsbDtcbiAgICAgIHRoaXMuY29udGFjdEVtYWlsID0gbnVsbDtcbiAgICAgIHRoaXMuY29udGFjdE1lc3NhZ2UgPSBudWxsO1xuXG4gIH1cblxuICAkc2NvcGUuZ2V0VXNlciA9IGZ1bmN0aW9uKHVzZXJuYW1lKXtcblx0XHRUd2l0dGVyU2VydmljZS5nZXRVc2VyKHVzZXJuYW1lKVxuXHRcdCAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHQgICAgICAgICRzY29wZS50d2l0dGVyRXJyb3JzID0gdW5kZWZpbmVkO1xuXHQgICAgICAgIFx0JHNjb3BlLnR3ZWV0cyA9IEpTT04ucGFyc2UoZGF0YS5yZXN1bHQudXNlckRhdGEpO1xuXHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coJHNjb3BlLnR3ZWV0cyk7XG5cdFx0ICAgIH0pXG5cdFx0ICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcil7XG5cdFx0ICAgICAgICBjb25zb2xlLmVycm9yKCd0aGVyZSB3YXMgYW4gZXJyb3IgcmV0cmlldmluZyBkYXRhOiAnLCBlcnJvcik7XG5cdFx0ICAgICAgICAkc2NvcGUudHdpdHRlckVycm9ycyA9IGVycm9yLmVycm9yO1xuXHRcdCAgICB9KVxuXHR9O1xuXG4gIC8vJHNjb3BlLmdldFVzZXIoKTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ05hdkN0cmwnLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnJGRvY3VtZW50JywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRkb2N1bWVudCl7XG4gICRzY29wZS5zaG93TWVudSA9IGZ1bmN0aW9uKCl7XG4gICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sbGFwc2UnKSkudG9nZ2xlQ2xhc3MoJ2luJyk7XG4gICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbmF2YmFyLXRvZ2dsZScpKS50b2dnbGVDbGFzcygnb3BlbicpO1xuICB9O1xuXG4gICRzY29wZS5zY3JvbGxUb3AgPSBmdW5jdGlvbigpe1xuICAgICRkb2N1bWVudC5zY3JvbGxUb3BBbmltYXRlZCgwKTtcbiAgfTtcblxuICAkc2NvcGUubGlua1RvID0gZnVuY3Rpb24oaWQpe1xuXG4gICAgICB2YXIgcm91dGUgPSAkbG9jYXRpb24udXJsKCk7XG4gICAgICB2YXIgb2Zmc2V0ID0gNjA7XG4gICAgICB2YXIgZHVyYXRpb24gPSA4MDA7XG4gICAgICB2YXIgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpO1xuXG4gICAgICBpZihyb3V0ZSAhPT0gJy8nKXtcbiAgICAgICAgJGxvY2F0aW9uLnVybCgnLycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJGRvY3VtZW50LnNjcm9sbFRvRWxlbWVudChlbGVtZW50LCBvZmZzZXQsIGR1cmF0aW9uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRkb2N1bWVudC5zY3JvbGxUb0VsZW1lbnQoZWxlbWVudCwgb2Zmc2V0LCBkdXJhdGlvbik7XG4gICAgICB9XG4gICAgfTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ1dvcmtDb250cm9sbGVyJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuXG4gICRzY29wZS5vcHRpb25zID0ge1xuICAgIG9yaWdpbjogJ2xlZnQnLFxuICAgIGRpc3RhbmNlOiAnMTUwcHgnLFxuICAgIGVhc2luZzogJ2Vhc2UtaW4tb3V0JyxcbiAgICBkZWxheTogMzAsXG4gICAgc2NhbGU6IDEsXG4gICAgZHVyYXRpb246IDEwMDAsXG4gICAgLy8gcmVzZXQ6IHRydWUsXG4gICAgYWZ0ZXJSZXZlYWw6IGZ1bmN0aW9uIChkb21FbCkge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYWxsZXJ5XCIpLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICB9LFxuICAgIHNlcXVlbmNlOiB7XG4gICAgICAgc2VsZWN0b3I6ICcuZ2FsbGVyeS1pbm5lcicsXG4gICAgICAgaW50ZXJ2YWw6IDMwMFxuICAgICB9XG4gIH07XG5cbiAgJHNjb3BlLnByb2plY3RzID0gW1xuICAgIHtcbiAgICAgIG5hbWU6ICdUZW5kcmlsIEluYy4nLFxuICAgICAgbGluazogJ2h0dHBzOi8vd3d3LnRlbmRyaWxpbmMuY29tJyxcbiAgICAgIGNsaWNrRnVuYzogdG9nZ2xlVGVuZHJpbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMubW9kYWwgPSAhdGhpcy5tb2RhbDtcbiAgICAgIH0sXG4gICAgICBiYWNrZ3JvdW5kSW1nOiAnaW1nL2dhbGxlcnkvdGVuZHJpbC5qcGcnLFxuICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgbW9kYWxJbWc6ICdpbWcvZ2FsbGVyeS90ZW5kcmlsLW1vY2t1cC5wbmcnLFxuICAgICAgbm9MaW5rOiBmYWxzZVxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ0Nyb3duIE9mZnJvYWQnLFxuICAgICAgbGluazogJ2h0dHA6Ly9jcm93bm9mZnJvYWQuY29tJyxcbiAgICAgIGNsaWNrRnVuYzogdG9nZ2xlQ3Jvd24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS9jcm93bi1vZmZyb2FkLmpwZycsXG4gICAgICBtb2RhbDogZmFsc2UsXG4gICAgICBtb2RhbEltZzogJ2ltZy9nYWxsZXJ5L2Nyb3duLW9mZnJvYWQtbW9ja3VwLnBuZycsXG4gICAgICBub0xpbms6IGZhbHNlXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnQ29sb3JhZG8gQnJvYWRiYW5kIFBvcnRhbCcsXG4gICAgICBsaW5rOiAnaHR0cDovL2Jyb2FkYmFuZC5jby5nb3YnLFxuICAgICAgY2xpY2tGdW5jOiAkc2NvcGUudG9nZ2xlQnJvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS93aXJlcy5qcGcnLFxuICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgbW9kYWxJbWc6ICdpbWcvZ2FsbGVyeS9icm9hZGJhbmQucG5nJyxcbiAgICAgIG5vTGluazogZmFsc2VcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdhZGlkYXMgYWRpUGxheWVyJyxcbiAgICAgIGxpbms6ICcnLFxuICAgICAgY2xpY2tGdW5jOiB0b2dnbGVBZGkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS9hZGlwbGF5ZXIuanBnJyxcbiAgICAgIG1vZGFsOiBmYWxzZSxcbiAgICAgIG1vZGFsSW1nOiAnaW1nL2dhbGxlcnkvYWRpcGxheWVyX21vY2t1cC5wbmcnLFxuICAgICAgbm9MaW5rOiB0cnVlXG4gICAgfVxuICBdXG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmNhY2hlJywgW10pLmZhY3RvcnkoJ0NhY2hlZFBvc3RTZXJ2aWNlJywgWydQb3N0U2VydmljZScsIGZ1bmN0aW9uKFBvc3RTZXJ2aWNlKXtcbiAgdmFyIHBvc3RMaXN0O1xuXG4gIHJldHVybiB7XG4gICAgcXVlcnk6IGZ1bmN0aW9uKCl7XG4gICAgICBpZighcG9zdExpc3Qpe1xuICAgICAgICBwb3N0TGlzdCA9IFBvc3RTZXJ2aWNlLnF1ZXJ5KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcG9zdExpc3Q7XG4gICAgfVxuICB9XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmNvbW1lbnREaXJzJywgW10pLmRpcmVjdGl2ZSgnY29tbWVudEZvcm0nLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvY29tbWVudC1mb3JtJ1xuICB9XG59XSlcblxuLmRpcmVjdGl2ZSgnY29tbWVudExpc3QnLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvY29tbWVudC1saXN0J1xuICB9XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgncG9zdC5jb21tZW50cycsIFtdKS5zZXJ2aWNlKCdDb21tZW50U2VydmljZScsIFsnJGh0dHAnLCAnTm90aWZpZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsIG5vdGlmaWVyKXtcblxuICB0aGlzLnBvc3RDb21tZW50ID0gZnVuY3Rpb24oZGF0YSwgc2x1Zyl7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMvY29tbWVudHMvJyArIHNsdWcsIGRhdGEpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVGhhbmtzIGZvciBzdWJtaXR0aW5nIHlvdXIgY29tbWVudCAnICsgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIG5vdGlmaWVyLmVycm9yKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHN1Ym1pdHRpbmcgeW91ciBjb21tZW50LicpO1xuICAgICAgfSk7XG4gIH07XG5cbiAgdGhpcy5kZWxldGVDb21tZW50ID0gZnVuY3Rpb24oZGF0YSwgc2x1Zyl7XG4gICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS9wb3N0cy9jb21tZW50cy8nICsgc2x1ZywgZGF0YSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdDb21tZW50IG51bWJlciAnICsgcmVzcG9uc2UuZGF0YS5tZXNzYWdlICsgJyBoYXMgYmVlbiBkZWxldGVkIScpO1xuICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgbm90aWZpZXIuZXJyb3IoJ1RoZXJlIHdhcyBhIHByb2JsZW0gZGVsZXRpbmcgeW91ciBjb21tZW50LicpO1xuICAgICAgfSk7XG4gIH07XG5cbn1dKTtcbiIsIiBhbmd1bGFyLm1vZHVsZSgncG9zdC5lZGl0JywgW10pLmNvbnRyb2xsZXIoJ0VkaXRQb3N0Q29udHJvbGxlcicsIFsgJyRzY29wZScsICckbG9jYXRpb24nLCAnJHN0YXRlUGFyYW1zJywgJ05vdGlmaWVyU2VydmljZScsICdQb3N0U2VydmljZScsICdJZGVudGl0eVNlcnZpY2UnLCAnQ29tbWVudFNlcnZpY2UnLCAnTWV0YScsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsIG5vdGlmaWVyLCBQb3N0U2VydmljZSwgaWRlbnRpdHksIENvbW1lbnRTZXJ2aWNlLCBNZXRhKXtcblxuICAgTWV0YS5zZXRUaXRsZSgnRWRpdCBQb3N0Jyk7XG5cbiAgICAkc2NvcGUuaWRlbnRpdHkgPSBpZGVudGl0eTtcblxuICAgICRzY29wZS5wb3N0ID0gUG9zdFNlcnZpY2UuZ2V0KHsgc2x1ZzogJHN0YXRlUGFyYW1zLnNsdWcgfSwgZnVuY3Rpb24oKXtcbiAgICAgIC8vJHNjb3BlLmdpc3RMaXN0ID0gJHNjb3BlLnBvc3QuZ2lzdHM7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuYWRkR2lzdCA9IGZ1bmN0aW9uKG5ld0dpc3Qpe1xuICAgICAgJHNjb3BlLnBvc3QuZ2lzdHMucHVzaChuZXdHaXN0KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnJlbW92ZUdpc3QgPSBmdW5jdGlvbigpe1xuICAgICAgJHNjb3BlLnBvc3QuZ2lzdHMucG9wKCk7XG4gICAgfTtcblxuICAgICRzY29wZS5wb3N0LmRhdGEgPSB7XG4gICAgICAgIF9pZDogJHNjb3BlLnBvc3QuX2lkLFxuICAgICAgICB0aXRsZSA6ICRzY29wZS5wb3N0LnRpdGxlLFxuICAgICAgICBzbHVnOiAkc2NvcGUucG9zdC5zbHVnLFxuICAgICAgICBjYXRlZ29yaWVzIDogJHNjb3BlLnBvc3QuY2F0ZWdvcmllcyxcbiAgICAgICAgZXhjZXJwdCA6ICRzY29wZS5wb3N0LmV4Y2VycHQsXG4gICAgICAgIGJvZHkgOiAkc2NvcGUucG9zdC5ib2R5LFxuICAgICAgICBhdXRob3I6ICRzY29wZS5wb3N0LmF1dGhvcixcbiAgICAgICAgcG9zdGVkRGF0ZTogRGF0ZS5ub3coKSxcbiAgICAgICAgZ2lzdHM6ICRzY29wZS5wb3N0Lmdpc3RzXG4gICAgfTtcblxuICAgICRzY29wZS51cGRhdGVQb3N0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJHNjb3BlLnBvc3QuJHVwZGF0ZSggeyBzbHVnOiAkc2NvcGUucG9zdC5zbHVnIH0sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgbm90aWZpZXIubm90aWZ5KCdQb3N0IGhhcyBiZWVuIHVwZGF0ZWQnKTtcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3Bvc3RzJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgICAgICAgIG5vdGlmaWVyLmVycm9yKG1lc3NhZ2UuZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlUG9zdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAkc2NvcGUucG9zdC4kZGVsZXRlKGZ1bmN0aW9uKCkge1xuICAgICAgICBub3RpZmllci5ub3RpZnkoJ1Bvc3QgaGFzIGJlZW4gZGVsZXRlZCcpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3Bvc3RzJyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZUNvbW1lbnQgPSBmdW5jdGlvbihjb21tZW50KXtcbiAgICAgIHZhciBzbHVnID0gJHN0YXRlUGFyYW1zLnNsdWc7XG4gICAgICBDb21tZW50U2VydmljZS5kZWxldGVDb21tZW50KGNvbW1lbnQsIHNsdWcpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgJHNjb3BlLnBvc3QuY29tbWVudHMucG9wKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpe1xuICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wb3N0cycpO1xuICAgIH07XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0Lm5ldycsIFtdKS5jb250cm9sbGVyKCdOZXdQb3N0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ05vdGlmaWVyU2VydmljZScsICdQb3N0U2VydmljZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsIG5vdGlmaWVyLCBQb3N0U2VydmljZSwgJGxvY2F0aW9uKXtcblxuICAkc2NvcGUucG9zdCA9IG5ldyBQb3N0U2VydmljZSgpO1xuXG4gICRzY29wZS5jcmVhdGVOZXdQb3N0ID0gZnVuY3Rpb24oKXtcbiAgICAkc2NvcGUucG9zdC4kc2F2ZShmdW5jdGlvbigpe1xuICAgICAgICBub3RpZmllci5ub3RpZnkoJ05ldyBQb3N0IENyZWF0ZWQnKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wb3N0cycpO1xuICAgIH0pO1xuICB9XG5cbiAgJHNjb3BlLnBvc3QuZ2lzdHMgPSBbXTtcbiAgJHNjb3BlLmFkZEdpc3QgPSBmdW5jdGlvbihuZXdHaXN0KXtcbiAgICAkc2NvcGUucG9zdC5naXN0cy5wdXNoKG5ld0dpc3QpO1xuICB9XG5cbiAgJHNjb3BlLnJlbW92ZUdpc3QgPSBmdW5jdGlvbihuZXdHaXN0KXtcbiAgICAkc2NvcGUucG9zdC5naXN0cy5wb3AoKTtcbiAgfVxuXG4gICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpe1xuICAgICRsb2NhdGlvbi5wYXRoKCcvYmxvZycpO1xuICB9XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0JywgWydwb3N0LmRldGFpbCcsICdwb3N0LnNlcnZpY2UnLCAncG9zdC5uZXcnLCAncG9zdC5lZGl0JywgJ3Bvc3QuY2FjaGUnLCAncG9zdC5saXN0JywgJ3Bvc3QuY29tbWVudHMnLCAncG9zdC5jb21tZW50RGlycyddKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LnNlcnZpY2UnLCBbJ25nUmVzb3VyY2UnXSkuZmFjdG9yeSgnUG9zdFNlcnZpY2UnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XG5cbiAgdmFyIFBvc3RSZXNvdXJjZSA9ICRyZXNvdXJjZSgnL2FwaS9wb3N0cy86c2x1ZycsIHtzbHVnOiAnQHNsdWcnfSwge1xuICAgIHVwZGF0ZSA6IHtcbiAgICAgIG1ldGhvZDogJ1BVVCdcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBQb3N0UmVzb3VyY2U7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmRldGFpbCcsIFtdKS5jb250cm9sbGVyKCdQb3N0RGV0YWlsQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0NhY2hlZFBvc3RTZXJ2aWNlJywgJ1Bvc3RTZXJ2aWNlJywgJyRzdGF0ZVBhcmFtcycsICdNZXRhJywgJ05vdGlmaWVyU2VydmljZScsICdDb21tZW50U2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgQ2FjaGVkUG9zdFNlcnZpY2UsIFBvc3RTZXJ2aWNlLCAkc3RhdGVQYXJhbXMsIE1ldGEsIG5vdGlmaWVyLCBDb21tZW50U2VydmljZSl7XG5cbiAgQ2FjaGVkUG9zdFNlcnZpY2UucXVlcnkoKS4kcHJvbWlzZS50aGVuKGZ1bmN0aW9uKGNvbGxlY3Rpb24pe1xuICAgIGNvbGxlY3Rpb24uZm9yRWFjaChmdW5jdGlvbihwb3N0KXtcbiAgICAgIGlmKHBvc3Quc2x1ZyA9PT0gJHN0YXRlUGFyYW1zLnNsdWcpe1xuICAgICAgICAkc2NvcGUucG9zdCA9IHBvc3Q7XG4gICAgICAgIHZhciB0aXRsZSA9ICRzY29wZS5wb3N0LnRpdGxlLFxuICAgICAgICAgICAgZGVzYyA9ICRzY29wZS5wb3N0LmV4Y2VycHQ7XG4gICAgICAgIE1ldGEuc2V0VGl0bGUodGl0bGUpO1xuICAgICAgICBNZXRhLnNldERlc2MoZGVzYyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gICRzY29wZS5zdWJtaXRDb21tZW50ID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgY29tbWVudCA9IHtcbiAgICAgICdjb250ZW50JzogJHNjb3BlLmNvbW1lbnQuY29udGVudCxcbiAgICAgICdkYXRlJzogRGF0ZS5ub3coKSxcbiAgICAgICdmaXJzdE5hbWUnOiAkc2NvcGUuY29tbWVudC5maXJzdE5hbWUsXG4gICAgICAnbGFzdE5hbWUnOiAkc2NvcGUuY29tbWVudC5sYXN0TmFtZSxcbiAgICB9O1xuICAgIHZhciBzbHVnID0gJHN0YXRlUGFyYW1zLnNsdWc7XG4gICAgQ29tbWVudFNlcnZpY2UucG9zdENvbW1lbnQoY29tbWVudCwgc2x1ZylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICRzY29wZS5wb3N0LmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgICRzY29wZS5jb21tZW50LmNvbnRlbnQ9IFwiXCI7XG4gICAgICAgICRzY29wZS5jb21tZW50LmZpcnN0TmFtZT0gXCJcIjtcbiAgICAgICAgJHNjb3BlLmNvbW1lbnQubGFzdE5hbWU9IFwiXCI7XG4gICAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgfSk7XG4gIH07XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0Lmxpc3QnLCBbXSkuY29udHJvbGxlcignUG9zdExpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnUG9zdFNlcnZpY2UnLCAgZnVuY3Rpb24oJHNjb3BlLCBQb3N0U2VydmljZSl7XG5cbiAgLy9NZXRhLnNldFRpdGxlKCdQb3N0cycpO1xuXG4gICRzY29wZS5wb3N0cyA9IFBvc3RTZXJ2aWNlLnF1ZXJ5KCk7XG5cbiAgLy8kc2NvcGUuaWRlbnRpdHkgPSBpZGVudGl0eTtcblxuICAkc2NvcGUuc29ydE9wdGlvbnM9IFtcbiAgICB7dmFsdWU6ICdwdWJsaXNoZWQnLCB0ZXh0OiAnUHVibGlzaGVkIERhdGUnfSxcbiAgICB7dmFsdWU6ICd0aXRsZScsIHRleHQ6ICdTb3J0IGJ5IFRpdGxlJ31cbiAgXVxuXG4gICRzY29wZS5zb3J0T3JkZXIgPSAkc2NvcGUuc29ydE9wdGlvbnNbMF0udmFsdWU7XG59XSk7XG4iXX0=
