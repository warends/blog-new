angular.module('willsBlog', ['users', 'post', 'common', 'ngResource', 'ngSanitize', 'ui.router', 'duScroll', 'gist', 'ngScrollReveal']);

angular.module('willsBlog').config(['$locationProvider', '$stateProvider', '$urlRouterProvider', function($locationProvider, $stateProvider, $urlRouterProvider){

    var routeRoleChecks = {
      admin: function(AuthService){
          return AuthService.authorizeCurrentUserForRoute('admin');
      },
      user: function(AuthService){
          return AuthService.authorizeAutheticatedUserForRoute();
      }
    }

    $urlRouterProvider.otherwise('/');

    $locationProvider.html5Mode(true);

    $stateProvider
    .state('home', {
      url: '/',
      templateUrl: '/partials/main/main',
      controller: 'MainController'
    })
    .state('account', {
      url: '/account',
      templateUrl: '/partials/login/login',
      controller: 'LoginController'
    })
    .state('posts', {
      url: '/posts',
      templateUrl: '/partials/posts/post-list',
      controller: 'PostListController'
    })
    .state('profile', {
      url: '/profile',
      templateUrl: '/partials/admin/profile',
      controller: 'ProfileController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeAutheticatedUserForRoute();
        }
      ]}
    })
    .state('postDetail', {
      url: '/posts/:slug',
      templateUrl: '/partials/posts/post-detail',
      controller: 'PostDetailController'
    })
    .state('newPost', {
      url: '/admin/new-post',
      templateUrl: '/partials/posts/new-post',
      controller: 'NewPostController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('editPost', {
      url: '/admin/:slug/edit',
      templateUrl: '/partials/posts/edit-post',
      controller: 'EditPostController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    })
    .state('users', {
      url: '/admin/users',
      templateUrl: '/partials/admin/users-list',
      controller: 'UserListController',
      resolve: {
        routeRoleCheck: ['AuthService', function(AuthService){
            return AuthService.authorizeCurrentUserForRoute('admin');
        }
      ]}
    });

}]);//end config


angular.module('willsBlog').run(['$rootScope', '$location', '$anchorScroll', function($rootScope, $location, $anchorScroll){

  $anchorScroll.yOffset = 60;

  $rootScope.$on('$routeChangeError', function(evt, current, previous, rejection) {
      if(rejection === 'not authorized') {
        $location.path('/');
      }
  });

  $rootScope.$on("$stateChangeSuccess", function (event, currentRoute, previousRoute) {
    window.scrollTo(0, 0);
  });

}]);

angular.module('willsBlog').controller('ProfileController', ['$scope', 'AuthService', 'IdentityService', 'NotifierService', function($scope, AuthService, identity, notifier){
  $scope.username = identity.currentUser.username;
  $scope.fName = identity.currentUser.firstName;
  $scope.lName = identity.currentUser.lastName;

  $scope.update = function(){
      var newUserData = {
        username: $scope.username,
        firstName: $scope.fName,
        lastName: $scope.lName
      }

      if($scope.password && $scope.password.length > 0) {
       newUserData.password = $scope.password;
      }

      AuthService.updateCurrentUser(newUserData)
        .then(function(){
          notifier.notify('Your information has been updated');
        }, function(reason){
          notifier.error(reason);
        });
  }

}]);

angular.module('willsBlog').controller('UserListController', ['$scope', 'UserService', function($scope, UserService){
  $scope.users = UserService.query();
}]);

angular.module('common', ['common.meta', 'common.notifier', 'common.modal']);

angular.module('common.meta', []).factory('Meta', function(){
  var title = 'Web Development, Seattle, WA';
  var desc = 'I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.';
  return {
    title: function() {return title;},
    setTitle: function(newTitle) { title = newTitle },
    description: function() { return desc;},
    setDesc : function(newDesc) { desc = newDesc}
  }
})
.controller('MetaController', ['$scope', 'Meta', function($scope, Meta){
  $scope.Meta = Meta;
  $scope.metaDesc = Meta;
}]);

angular.module('common.modal', []).directive('globalModal', function(){
  return{
    restrict: 'E',
    scope: {
      show: '='
    },
    replace: true,
    transclude: true,
    link : function(scope, element, attrs){
      scope.dialogStyle = {};
      if(attrs.width)
        scope.dialogStyle.width = attrs.width;
      if (attrs.height)
        scope.dialogStyle.height = attrs.height;

      scope.hideModal = function(){
        scope.show = false;
      };
    },
    templateUrl: '/partials/common/modal'
  }
});

angular.module('willsBlog').value('notific8', notific8);

angular.module('common.notifier', []).factory('NotifierService', ['notific8', function(notific8){

  notific8('configure', {
    life: 3000,
    theme: 'atomic',
    zindex: 9999,
    verticalEdge: 'right',
    horizontalEdge: 'top',
    closeText: 'X'
  });

  return {
    notify: function(message){
      notific8(message, {color: 'pear'});
      console.log(message);
    },
    error: function(message){
      notific8(message, {color: 'tomato'});
      console.log(message);
    }
  }
}]);

angular.module('willsBlog').factory('TwitterService', ['$http', '$q', function($http, $q){

  var getUser = function(username){
    var d = $q.defer();

    $http.post('/twitter/user', {username : username})
      .success(function(data){
        return d.resolve(data);
      })
      .error(function(error){
        return d.reject(error);
      });
      return d.promise;
    };

    return {
      getUser : getUser
    }
}]);


angular.module('users.auth', []).factory('AuthService', ['$http', 'IdentityService', '$q', 'UserService', function($http, identity, $q, UserService){

  return {
    // this thing working
    authenticateUser: function(username, password){
      var deferred = $q.defer();

      $http.post('/login', {
        username: username,
        password: password
      }).then(function(response){
        if (response.data.success){

          var user = new UserService();
          angular.extend(user, response.data.user);
          identity.currentUser = user;
          deferred.resolve(true);
        } else {
          deferred.resolve(false);
        }
      });

      return deferred.promise;
    },

    logoutUser: function() {
      var deferred = $q.defer();

      $http.post('/logout', {logout: true}).then(function(){
        identity.currentUser = undefined;
        deferred.resolve();
      });

      return deferred.promise;

    },

    authorizeCurrentUserForRoute: function(role){
      if (identity.isAuthorized('admin')){
        return true;
      } else {
        return $q.reject('not authorized');
      }
    },

    authorizeAutheticatedUserForRoute: function(){
      if (identity.isAuthenticated()){
        return true;
      } else {
        return $q.reject('not a current user');
      }
    },

    createUser : function(newUserData) {
       var newUser = new UserService(newUserData);
       var deferred = $q.defer();

       newUser.$save().then(function(){
         identity.currentUser = newUser;
         deferred.resolve();
       }, function(response){
         deferred.reject(response.data.reason);
       });

       return deferred.promise;
    },

    updateCurrentUser: function(newUserData){
        var deferred = $q.defer();
        var clone = angular.copy(identity.currentUser);
        angular.extend(clone, newUserData);
        clone.$update().then(function(){
          identity.currentUser = clone;
          deferred.resolve();
        }, function(response){
          deferred.reject(response.data.reason);
        });
        return deferred.promise;
    }

  }// return

}]);

angular.module('users.identity', []).factory('IdentityService', ['$window', 'UserService', function($window, UserService){

  var currentUser;
  if(!!$window.bootstrappedUserObject) {
    currentUser = new UserService();
    angular.extend(currentUser, $window.bootstrappedUserObject);
  }
  return {
    currentUser: currentUser,
    isAuthenticated: function(){
      return !!this.currentUser;
    },

    isAuthorized: function(role){
      return !!this.currentUser && this.currentUser.roles.indexOf(role) > -1;
    }

  }

}]);

angular.module('users.login', []).controller('LoginController', ['$scope', 'IdentityService', 'NotifierService', 'AuthService', '$location', 'Meta', function($scope, identity, notifier, AuthService, $location, Meta){

    Meta.setTitle('Account');

    $scope.identity = identity;

    $scope.signIn = function(username, password){
      AuthService.authenticateUser(username, password).then(function(success){
        if(success){
          notifier.notify('You have signed in');
          $location.url('/account');
          $scope.actShown = false;
        } else {
          notifier.error('Username/Password Incorrect');
        }
      });
    };

    $scope.signOut = function(){
      AuthService.logoutUser().then(function() {
        $scope.username = '';
        $scope.password = '';
        notifier.notify('You have logged out');
        $location.path('/');
      });
    };

    $scope.signup = function(firstName, lastName, username, password){
      var newUserData = {
        'username': username,
        'firstName': firstName,
        'lastName': lastName,
        'password': password
      };
      AuthService.createUser(newUserData)
        .then(function(){
          notifier.notify('User Account Created');
          $location.path('/');
      }, function(message){
        notifier.error(message);
      });
    };
    $scope.cancel = function(){
      $location.path('/');
    };

    $scope.actShown = false;
    $scope.toggleAccount = function() {
      if(identity.isAuthenticated()){
        $location.path('/account');
      } else {
        $scope.actShown = !$scope.actShown;
      }
    };

    $scope.signupShown = false;
    $scope.toggleSignup = function() {
      $scope.signupShown = !$scope.signupShown;
    };


}]);

angular.module('users.service', ['ngResource']).factory('UserService', ['$resource', function($resource){

  var UserResource = $resource('/api/users/:id', {_id : '@id'}, {
    update: {method: 'PUT', isArray: false}
  });

  UserResource.prototype.isAdmin = function(){
    return this.roles && this.roles.indexOf('admin') > -1;
  }

  return UserResource;

}]);

angular.module('users', ['users.service', 'users.login', 'users.identity', 'users.auth']);

angular.module('willsBlog').controller('CarouselController', ['$scope', function($scope){
  $scope.slides = [
    { name: 'Mobile',
    svg: 'mobile-svg',
    desc: 'Is your website up to date with the most current mobile design trends? If not, you are loosing valuable business. Ensure that your customers can reach your business from anywhere and receive the best user experience. By building with responsive design in mind, your customers will get a pixel perfect look from mobile to tablet or desktop.' },

    { name: 'ECommerce',
    svg: 'ecomm-svg',
    desc: 'Do you have a new product you are looking to bring to market and need an e-commerce site or just looking for more modern feel to an existing site?  By utilizing robust ecommerce platforms, I can design and develop a site that will scale with your business and needs all in time to meet your busy deadlines. ' },

    { name: 'SEO',
    svg: 'seo-svg',
    desc: 'Having a modern design and user friendly website is great, but if customers can`t find your business, it wont matter much.  I design and develop every aspect of the website with search engine optimization in mind and so your customers can find you among the competition.  Also through research and analytics I can develop, plan and deploy the best SEO and marketing practices to increase conversions and retention.' }
  ];

  $scope.currentIndex = 0;
  $scope.setCurrentSlideIndex = function(index){
    $scope.currentIndex = index;
  }
  $scope.isCurrentSlideIndex = function(index){
    return $scope.currentIndex === index;
  }
}]);

angular.module('willsBlog').controller('MainController', ['$scope', '$location', 'CachedPostService', 'NotifierService' ,'$window', '$http', 'Meta',  function($scope, $location, CachedPostService, notifier, $window, $http, Meta){

  $(window).scroll(function() {
      var $bgobj = $('#home');
      var windowSize = $window.innerWidth;
      var xPos = (windowSize > 768) ? xPos = '50' : xPos = '20';
      var yPos = -( $(window).scrollTop() / $bgobj.data('speed'));
      var coords = xPos + '% '+ yPos + 'px';
      $bgobj.css({ backgroundPosition: coords });
  });

  $scope.aboutOptions = {
    origin: 'top',
    distance: '150px',
    easing: 'ease-in-out',
    delay: 30,
    scale: 1,
    duration: 1000,
    // reset: true,
    sequence: {
       selector: '.services-web',
       interval: 300
     }
  };

  Meta.setTitle('Home');
  Meta.setDesc('I enjoy all things web development and am always actively learning the newest techniques and langauges. If you have a web design or development project, give me a shout, I would love to talk about it.');

  $scope.services = [
    { name: 'Development',
    svg: 'dev-logo',
    description: 'Customized and reusable code using the most up to date HTML5, CSS3 and Javascript framworks. Options range from static sites, content managed sites, and ecommerce stores.',
    more: 'Development Skills include HTML5, CSS, Javascript, Angular, Backbone, Node, Express, Boostrap and more.' },

    { name: 'Web Design',
    svg: 'design-logo',
    description: 'Creating an excellent user experience through clean, simple and thoroughly crafted design. Collaboration with clients during design process ensures a superb finished project.',
    more: 'Services include wire frames, photoshop mockups, logo design, and company branding.' },

    { name: 'Support',
    svg: 'sup-logo',
    description: 'Support is readily available for clients when anything comes up along the development process. Also available are personal instruction on how to maintain or update your own site.',
    more: 'Have a new product or feature you want to implement? Plans for continued support and maintenance are available.' }

  ];

  $scope.posts = CachedPostService.query();

  $scope.form = {};

  $scope.sendMail = function(){
    var data =({
      contactName : this.contactName,
      contactCompany : this.contactCompany,
      contactEmail : this.contactEmail,
      contactMessage : this.contactMessage
    });

    $http.post('/contact-form', data)
      .then(function(message, status, headers, config){
        notifier.notify('Thank you for your message ' + message.data.contactName);
           $scope.form.contactForm.$setPristine();
           $scope.form.contactForm.$setUntouched();
      }, function(message, status, headers, config){
        notifier.notify('There was an error processing your request. Please try again');
      });
      this.contactName = null;
      this.contactCompany = null;
      this.contactEmail = null;
      this.contactMessage = null;

  }

  $scope.getUser = function(username){
		TwitterService.getUser(username)
		    .then(function(data){
		        $scope.twitterErrors = undefined;
	        	$scope.tweets = JSON.parse(data.result.userData);
						// console.log($scope.tweets);
		    })
		    .catch(function(error){
		        console.error('there was an error retrieving data: ', error);
		        $scope.twitterErrors = error.error;
		    })
	};

  //$scope.getUser();

}]);

angular.module('willsBlog').controller('NavCtrl', ['$scope', '$location', '$document', function($scope, $location, $document){
  $scope.showMenu = function(){
      angular.element(document.getElementsByClassName('collapse')).toggleClass('in');
      angular.element(document.getElementsByClassName('navbar-toggle')).toggleClass('open');
  };

  $scope.scrollTop = function(){
    $document.scrollTopAnimated(0);
  };

  $scope.linkTo = function(id){

      var route = $location.url();
      var offset = 60;
      var duration = 800;
      var element = angular.element(document.getElementById(id));

      if(route !== '/'){
        $location.url('/', function(){
          $document.scrollToElement(element, offset, duration);
        });

      } else {
        $document.scrollToElement(element, offset, duration);
      }
    };

}]);

angular.module('willsBlog').controller('WorkController', ['$scope', function($scope){

  $scope.options = {
    origin: 'left',
    distance: '150px',
    easing: 'ease-in-out',
    delay: 30,
    scale: 1,
    duration: 1000,
    // reset: true,
    afterReveal: function (domEl) {
      document.getElementById("gallery").style.visibility = "visible";
    },
    sequence: {
       selector: '.gallery-inner',
       interval: 300
     }
  };

  $scope.projects = [
    {
      name: 'Tendril Inc.',
      link: 'https://www.tendrilinc.com',
      clickFunc: toggleTendril = function(){
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/tendril.png',
      modal: false,
      modalImg: 'img/gallery/tendril-mockup.png',
      noLink: false
    },
    {
      name: 'Hayley Bagwell Interior Design',
      link: 'http://www.hbedesign.com/',
      clickFunc: toggleHB = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/hbe-design.png',
      modal: false,
      modalImg: 'img/gallery/hbe-design-responsive.png',
      noLink: false
    },
    {
      name: 'Colorado Broadband Portal',
      link: 'http://broadband.co.gov',
      clickFunc: toggleBroad = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/wires.png',
      modal: false,
      modalImg: 'img/gallery/broadband.png',
      noLink: false
    },
    {
      name: 'adidas adiPlayer',
      link: '',
      clickFunc: toggleAdi = function() {
        this.modal = !this.modal;
      },
      backgroundImg: 'img/gallery/adiplayer.png',
      modal: false,
      modalImg: 'img/gallery/adiplayer_mockup.png',
      noLink: true
    }
  ]

}]);

angular.module('post.cache', []).factory('CachedPostService', ['PostService', function(PostService){
  var postList;

  return {
    query: function(){
      if(!postList){
        postList = PostService.query();
      }
      return postList;
    }
  }

}]);

angular.module('post.commentDirs', []).directive('commentForm', [function(){
  return{
    restrict: 'E',
    templateUrl: '/partials/posts/comment-form'
  }
}])

.directive('commentList', [function(){
  return{
    restrict: 'E',
    templateUrl: '/partials/posts/comment-list'
  }
}]);

angular.module('post.comments', []).service('CommentService', ['$http', 'NotifierService', function($http, notifier){

  this.postComment = function(data, slug){
    return $http.post('/api/posts/comments/' + slug, data)
      .then(function(response){
        notifier.notify('Thanks for submitting your comment ' + response.data.message);
      }, function(err){
        console.log(err);
        notifier.error('There was a problem submitting your comment.');
      });
  };

  this.deleteComment = function(data, slug){
    return $http.put('/api/posts/comments/' + slug, data)
      .then(function(response){
        notifier.notify('Comment number ' + response.data.message + ' has been deleted!');
      }, function(err){
        console.log(err);
        notifier.error('There was a problem deleting your comment.');
      });
  };

}]);

 angular.module('post.edit', []).controller('EditPostController', [ '$scope', '$location', '$stateParams', 'NotifierService', 'PostService', 'IdentityService', 'CommentService', 'Meta', function($scope, $location, $stateParams, notifier, PostService, identity, CommentService, Meta){

    Meta.setTitle('Edit Post');

    $scope.identity = identity;

    $scope.post = PostService.get({ slug: $stateParams.slug }, function(){
      //$scope.gistList = $scope.post.gists;
    });

    $scope.addGist = function(newGist){
      $scope.post.gists.push(newGist);
    };
    $scope.removeGist = function(){
      $scope.post.gists.pop();
    };

    $scope.post.data = {
        _id: $scope.post._id,
        title : $scope.post.title,
        slug: $scope.post.slug,
        categories : $scope.post.categories,
        excerpt : $scope.post.excerpt,
        body : $scope.post.body,
        author: $scope.post.author,
        postedDate: Date.now(),
        gists: $scope.post.gists
    };

    $scope.updatePost = function(){
        $scope.post.$update( { slug: $scope.post.slug }, function(){
          notifier.notify('Post has been updated');
          $location.path('/posts');
        }, function(message){
          notifier.error(message.data);
        });
    };

    $scope.deletePost = function(){
      $scope.post.$delete(function() {
        notifier.notify('Post has been deleted');
        $location.path('/posts');
      });
    };

    $scope.deleteComment = function(comment){
      var slug = $stateParams.slug;
      CommentService.deleteComment(comment, slug)
        .then(function(){
          $scope.post.comments.pop();
        }, function(){

        });
    };

    $scope.cancel = function(){
      $location.path('/posts');
    };

}]);

angular.module('post.new', []).controller('NewPostController', ['$scope', 'NotifierService', 'PostService', '$location', function($scope, notifier, PostService, $location){

  $scope.post = new PostService();

  $scope.createNewPost = function(){
    $scope.post.$save(function(){
        notifier.notify('New Post Created');
        $location.path('/posts');
    });
  }

  $scope.post.gists = [];
  $scope.addGist = function(newGist){
    $scope.post.gists.push(newGist);
  }

  $scope.removeGist = function(newGist){
    $scope.post.gists.pop();
  }

  $scope.cancel = function(){
    $location.path('/blog');
  }

}]);

angular.module('post', ['post.detail', 'post.service', 'post.new', 'post.edit', 'post.cache', 'post.list', 'post.comments', 'post.commentDirs']);

angular.module('post.service', ['ngResource']).factory('PostService', ['$resource', function($resource){

  var PostResource = $resource('/api/posts/:slug', {slug: '@slug'}, {
    update : { method: 'PUT' }
  });

  PostResource.getPost = function(slug){
    return PostResource.get({slug: slug}).$promise.then(function(response){
      return response;
    });
  };

  return PostResource;

}]);

angular.module('post.detail', []).controller('PostDetailController', ['$scope', '$stateParams', 'CachedPostService', 'Meta', 'CommentService', function($scope, $stateParams, CachedPostService, Meta, CommentService){

  // PostService.getPost($stateParams.slug).then(function(response){
  //   $scope.post = response;
  //   console.log($scope.post);
  // });

  CachedPostService.query().$promise.then(function(collection){
    collection.forEach(function(post){
      if(post.slug === $stateParams.slug){
        $scope.post = post;
        var title = $scope.post.title,
            desc = $scope.post.excerpt;
        Meta.setTitle(title);
        Meta.setDesc(desc);
      }
    });
  });

  $scope.submitComment = function(){
    var comment = {
      'content': $scope.comment.content,
      'date': Date.now(),
      'firstName': $scope.comment.firstName,
      'lastName': $scope.comment.lastName,
    };
    var slug = $stateParams.slug;
    CommentService.postComment(comment, slug)
      .then(function(){
        $scope.post.comments.push(comment);
        $scope.comment.content= "";
        $scope.comment.firstName= "";
        $scope.comment.lastName= "";
      }, function(){
      });
  };

}]);

angular.module('post.list', []).controller('PostListController', ['$scope', 'CachedPostService', 'IdentityService', '$location', 'Meta',  function($scope, CachedPostService, identity, $location, Meta){

  Meta.setTitle('Posts');

  $scope.posts = CachedPostService.query();

  $scope.identity = identity;

  $scope.sortOptions= [
    {value: 'published', text: 'Published Date'},
    {value: 'title', text: 'Sort by Title'}
  ]

  $scope.sortOrder = $scope.sortOptions[0].value;
}]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFkbWluL3Byb2ZpbGUuY29udHJvbGxlci5qcyIsImFkbWluL3VzZXJMaXN0LmNvbnRyb2xsZXIuanMiLCJjb21tb24vY29tbW9uLm1vZHVsZS5qcyIsImNvbW1vbi9tZXRhLmNvbnRyb2xsZXIuanMiLCJjb21tb24vbW9kYWwuZGlyZWN0aXZlLmpzIiwiY29tbW9uL25vdGlmaWVyLnNlcnZpY2UuanMiLCJjb21tb24vdHdpdHRlci5qcyIsImxvZ2luL2F1dGguc2VydmljZS5qcyIsImxvZ2luL2lkZW50aXR5LnNlcnZpY2UuanMiLCJsb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwibG9naW4vdXNlci5zZXJ2aWNlLmpzIiwibG9naW4vdXNlcnMubW9kdWxlLmpzIiwibWFpbi9jYXJvdXNlbC5jb250cm9sbGVyLmpzIiwibWFpbi9tYWluLmNvbnRyb2xsZXIuanMiLCJtYWluL25hdi5jb250cm9sbGVyLmpzIiwibWFpbi93b3JrLmNvbnRyb2xsZXIuanMiLCJwb3N0cy9jaGFjaGVkUG9zdC5zZXJ2aWNlLmpzIiwicG9zdHMvY29tbWVudC5kaXJlY3RpdmUuanMiLCJwb3N0cy9jb21tZW50LnNlcnZpY2UuanMiLCJwb3N0cy9lZGl0UG9zdC5jb250cm9sbGVyLmpzIiwicG9zdHMvbmV3UG9zdC5jb250cm9sbGVyLmpzIiwicG9zdHMvcG9zdC5tb2R1bGUuanMiLCJwb3N0cy9wb3N0LnNlcnZpY2UuanMiLCJwb3N0cy9wb3N0RGV0YWlsLmNvbnRyb2xsZXIuanMiLCJwb3N0cy9wb3N0TGlzdC5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQ0hBO0FBQ0E7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycsIFsndXNlcnMnLCAncG9zdCcsICdjb21tb24nLCAnbmdSZXNvdXJjZScsICduZ1Nhbml0aXplJywgJ3VpLnJvdXRlcicsICdkdVNjcm9sbCcsICdnaXN0JywgJ25nU2Nyb2xsUmV2ZWFsJ10pO1xuXG5hbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29uZmlnKFsnJGxvY2F0aW9uUHJvdmlkZXInLCAnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpe1xuXG4gICAgdmFyIHJvdXRlUm9sZUNoZWNrcyA9IHtcbiAgICAgIGFkbWluOiBmdW5jdGlvbihBdXRoU2VydmljZSl7XG4gICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICB9LFxuICAgICAgdXNlcjogZnVuY3Rpb24oQXV0aFNlcnZpY2Upe1xuICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5hdXRob3JpemVBdXRoZXRpY2F0ZWRVc2VyRm9yUm91dGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG5cbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnaG9tZScsIHtcbiAgICAgIHVybDogJy8nLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvbWFpbi9tYWluJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdNYWluQ29udHJvbGxlcidcbiAgICB9KVxuICAgIC5zdGF0ZSgnYWNjb3VudCcsIHtcbiAgICAgIHVybDogJy9hY2NvdW50JyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2xvZ2luL2xvZ2luJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInXG4gICAgfSlcbiAgICAuc3RhdGUoJ3Bvc3RzJywge1xuICAgICAgdXJsOiAnL3Bvc3RzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL3Bvc3RzL3Bvc3QtbGlzdCcsXG4gICAgICBjb250cm9sbGVyOiAnUG9zdExpc3RDb250cm9sbGVyJ1xuICAgIH0pXG4gICAgLnN0YXRlKCdwcm9maWxlJywge1xuICAgICAgdXJsOiAnL3Byb2ZpbGUnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vcHJvZmlsZScsXG4gICAgICBjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXInLFxuICAgICAgcmVzb2x2ZToge1xuICAgICAgICByb3V0ZVJvbGVDaGVjazogWydBdXRoU2VydmljZScsIGZ1bmN0aW9uKEF1dGhTZXJ2aWNlKXtcbiAgICAgICAgICAgIHJldHVybiBBdXRoU2VydmljZS5hdXRob3JpemVBdXRoZXRpY2F0ZWRVc2VyRm9yUm91dGUoKTtcbiAgICAgICAgfVxuICAgICAgXX1cbiAgICB9KVxuICAgIC5zdGF0ZSgncG9zdERldGFpbCcsIHtcbiAgICAgIHVybDogJy9wb3N0cy86c2x1ZycsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9wb3N0cy9wb3N0LWRldGFpbCcsXG4gICAgICBjb250cm9sbGVyOiAnUG9zdERldGFpbENvbnRyb2xsZXInXG4gICAgfSlcbiAgICAuc3RhdGUoJ25ld1Bvc3QnLCB7XG4gICAgICB1cmw6ICcvYWRtaW4vbmV3LXBvc3QnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvbmV3LXBvc3QnLFxuICAgICAgY29udHJvbGxlcjogJ05ld1Bvc3RDb250cm9sbGVyJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgcm91dGVSb2xlQ2hlY2s6IFsnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbihBdXRoU2VydmljZSl7XG4gICAgICAgICAgICByZXR1cm4gQXV0aFNlcnZpY2UuYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSgnYWRtaW4nKTtcbiAgICAgICAgfVxuICAgICAgXX1cbiAgICB9KVxuICAgIC5zdGF0ZSgnZWRpdFBvc3QnLCB7XG4gICAgICB1cmw6ICcvYWRtaW4vOnNsdWcvZWRpdCcsXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9wb3N0cy9lZGl0LXBvc3QnLFxuICAgICAgY29udHJvbGxlcjogJ0VkaXRQb3N0Q29udHJvbGxlcicsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHJvdXRlUm9sZUNoZWNrOiBbJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oQXV0aFNlcnZpY2Upe1xuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSlcbiAgICAuc3RhdGUoJ3VzZXJzJywge1xuICAgICAgdXJsOiAnL2FkbWluL3VzZXJzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3VzZXJzLWxpc3QnLFxuICAgICAgY29udHJvbGxlcjogJ1VzZXJMaXN0Q29udHJvbGxlcicsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHJvdXRlUm9sZUNoZWNrOiBbJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oQXV0aFNlcnZpY2Upe1xuICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGUoJ2FkbWluJyk7XG4gICAgICAgIH1cbiAgICAgIF19XG4gICAgfSk7XG5cbn1dKTsvL2VuZCBjb25maWdcblxuXG5hbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykucnVuKFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGFuY2hvclNjcm9sbCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJGFuY2hvclNjcm9sbCl7XG5cbiAgJGFuY2hvclNjcm9sbC55T2Zmc2V0ID0gNjA7XG5cbiAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZ0LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XG4gICAgICBpZihyZWplY3Rpb24gPT09ICdub3QgYXV0aG9yaXplZCcpIHtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgIH1cbiAgfSk7XG5cbiAgJHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdWNjZXNzXCIsIGZ1bmN0aW9uIChldmVudCwgY3VycmVudFJvdXRlLCBwcmV2aW91c1JvdXRlKSB7XG4gICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICB9KTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnQXV0aFNlcnZpY2UnLCAnSWRlbnRpdHlTZXJ2aWNlJywgJ05vdGlmaWVyU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgQXV0aFNlcnZpY2UsIGlkZW50aXR5LCBub3RpZmllcil7XG4gICRzY29wZS51c2VybmFtZSA9IGlkZW50aXR5LmN1cnJlbnRVc2VyLnVzZXJuYW1lO1xuICAkc2NvcGUuZk5hbWUgPSBpZGVudGl0eS5jdXJyZW50VXNlci5maXJzdE5hbWU7XG4gICRzY29wZS5sTmFtZSA9IGlkZW50aXR5LmN1cnJlbnRVc2VyLmxhc3ROYW1lO1xuXG4gICRzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpe1xuICAgICAgdmFyIG5ld1VzZXJEYXRhID0ge1xuICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXJuYW1lLFxuICAgICAgICBmaXJzdE5hbWU6ICRzY29wZS5mTmFtZSxcbiAgICAgICAgbGFzdE5hbWU6ICRzY29wZS5sTmFtZVxuICAgICAgfVxuXG4gICAgICBpZigkc2NvcGUucGFzc3dvcmQgJiYgJHNjb3BlLnBhc3N3b3JkLmxlbmd0aCA+IDApIHtcbiAgICAgICBuZXdVc2VyRGF0YS5wYXNzd29yZCA9ICRzY29wZS5wYXNzd29yZDtcbiAgICAgIH1cblxuICAgICAgQXV0aFNlcnZpY2UudXBkYXRlQ3VycmVudFVzZXIobmV3VXNlckRhdGEpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgbm90aWZpZXIubm90aWZ5KCdZb3VyIGluZm9ybWF0aW9uIGhhcyBiZWVuIHVwZGF0ZWQnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKXtcbiAgICAgICAgICBub3RpZmllci5lcnJvcihyZWFzb24pO1xuICAgICAgICB9KTtcbiAgfVxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignVXNlckxpc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTZXJ2aWNlKXtcbiAgJHNjb3BlLnVzZXJzID0gVXNlclNlcnZpY2UucXVlcnkoKTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdjb21tb24nLCBbJ2NvbW1vbi5tZXRhJywgJ2NvbW1vbi5ub3RpZmllcicsICdjb21tb24ubW9kYWwnXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY29tbW9uLm1ldGEnLCBbXSkuZmFjdG9yeSgnTWV0YScsIGZ1bmN0aW9uKCl7XG4gIHZhciB0aXRsZSA9ICdXZWIgRGV2ZWxvcG1lbnQsIFNlYXR0bGUsIFdBJztcbiAgdmFyIGRlc2MgPSAnSSBlbmpveSBhbGwgdGhpbmdzIHdlYiBkZXZlbG9wbWVudCBhbmQgYW0gYWx3YXlzIGFjdGl2ZWx5IGxlYXJuaW5nIHRoZSBuZXdlc3QgdGVjaG5pcXVlcyBhbmQgbGFuZ2F1Z2VzLiBJZiB5b3UgaGF2ZSBhIHdlYiBkZXNpZ24gb3IgZGV2ZWxvcG1lbnQgcHJvamVjdCwgZ2l2ZSBtZSBhIHNob3V0LCBJIHdvdWxkIGxvdmUgdG8gdGFsayBhYm91dCBpdC4nO1xuICByZXR1cm4ge1xuICAgIHRpdGxlOiBmdW5jdGlvbigpIHtyZXR1cm4gdGl0bGU7fSxcbiAgICBzZXRUaXRsZTogZnVuY3Rpb24obmV3VGl0bGUpIHsgdGl0bGUgPSBuZXdUaXRsZSB9LFxuICAgIGRlc2NyaXB0aW9uOiBmdW5jdGlvbigpIHsgcmV0dXJuIGRlc2M7fSxcbiAgICBzZXREZXNjIDogZnVuY3Rpb24obmV3RGVzYykgeyBkZXNjID0gbmV3RGVzY31cbiAgfVxufSlcbi5jb250cm9sbGVyKCdNZXRhQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ01ldGEnLCBmdW5jdGlvbigkc2NvcGUsIE1ldGEpe1xuICAkc2NvcGUuTWV0YSA9IE1ldGE7XG4gICRzY29wZS5tZXRhRGVzYyA9IE1ldGE7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnY29tbW9uLm1vZGFsJywgW10pLmRpcmVjdGl2ZSgnZ2xvYmFsTW9kYWwnLCBmdW5jdGlvbigpe1xuICByZXR1cm57XG4gICAgcmVzdHJpY3Q6ICdFJyxcbiAgICBzY29wZToge1xuICAgICAgc2hvdzogJz0nXG4gICAgfSxcbiAgICByZXBsYWNlOiB0cnVlLFxuICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgbGluayA6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycyl7XG4gICAgICBzY29wZS5kaWFsb2dTdHlsZSA9IHt9O1xuICAgICAgaWYoYXR0cnMud2lkdGgpXG4gICAgICAgIHNjb3BlLmRpYWxvZ1N0eWxlLndpZHRoID0gYXR0cnMud2lkdGg7XG4gICAgICBpZiAoYXR0cnMuaGVpZ2h0KVxuICAgICAgICBzY29wZS5kaWFsb2dTdHlsZS5oZWlnaHQgPSBhdHRycy5oZWlnaHQ7XG5cbiAgICAgIHNjb3BlLmhpZGVNb2RhbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIHNjb3BlLnNob3cgPSBmYWxzZTtcbiAgICAgIH07XG4gICAgfSxcbiAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9jb21tb24vbW9kYWwnXG4gIH1cbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLnZhbHVlKCdub3RpZmljOCcsIG5vdGlmaWM4KTtcblxuYW5ndWxhci5tb2R1bGUoJ2NvbW1vbi5ub3RpZmllcicsIFtdKS5mYWN0b3J5KCdOb3RpZmllclNlcnZpY2UnLCBbJ25vdGlmaWM4JywgZnVuY3Rpb24obm90aWZpYzgpe1xuXG4gIG5vdGlmaWM4KCdjb25maWd1cmUnLCB7XG4gICAgbGlmZTogMzAwMCxcbiAgICB0aGVtZTogJ2F0b21pYycsXG4gICAgemluZGV4OiA5OTk5LFxuICAgIHZlcnRpY2FsRWRnZTogJ3JpZ2h0JyxcbiAgICBob3Jpem9udGFsRWRnZTogJ3RvcCcsXG4gICAgY2xvc2VUZXh0OiAnWCdcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBub3RpZnk6IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgICAgbm90aWZpYzgobWVzc2FnZSwge2NvbG9yOiAncGVhcid9KTtcbiAgICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgIH0sXG4gICAgZXJyb3I6IGZ1bmN0aW9uKG1lc3NhZ2Upe1xuICAgICAgbm90aWZpYzgobWVzc2FnZSwge2NvbG9yOiAndG9tYXRvJ30pO1xuICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgfVxuICB9XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuZmFjdG9yeSgnVHdpdHRlclNlcnZpY2UnLCBbJyRodHRwJywgJyRxJywgZnVuY3Rpb24oJGh0dHAsICRxKXtcblxuICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKHVzZXJuYW1lKXtcbiAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAkaHR0cC5wb3N0KCcvdHdpdHRlci91c2VyJywge3VzZXJuYW1lIDogdXNlcm5hbWV9KVxuICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHJldHVybiBkLnJlc29sdmUoZGF0YSk7XG4gICAgICB9KVxuICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgcmV0dXJuIGQucmVqZWN0KGVycm9yKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGdldFVzZXIgOiBnZXRVc2VyXG4gICAgfVxufV0pO1xuIiwiXG5hbmd1bGFyLm1vZHVsZSgndXNlcnMuYXV0aCcsIFtdKS5mYWN0b3J5KCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAnSWRlbnRpdHlTZXJ2aWNlJywgJyRxJywgJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsIGlkZW50aXR5LCAkcSwgVXNlclNlcnZpY2Upe1xuXG4gIHJldHVybiB7XG4gICAgLy8gdGhpcyB0aGluZyB3b3JraW5nXG4gICAgYXV0aGVudGljYXRlVXNlcjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwLnBvc3QoJy9sb2dpbicsIHtcbiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdWNjZXNzKXtcblxuICAgICAgICAgIHZhciB1c2VyID0gbmV3IFVzZXJTZXJ2aWNlKCk7XG4gICAgICAgICAgYW5ndWxhci5leHRlbmQodXNlciwgcmVzcG9uc2UuZGF0YS51c2VyKTtcbiAgICAgICAgICBpZGVudGl0eS5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBsb2dvdXRVc2VyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwLnBvc3QoJy9sb2dvdXQnLCB7bG9nb3V0OiB0cnVlfSkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICBpZGVudGl0eS5jdXJyZW50VXNlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgfSxcblxuICAgIGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGU6IGZ1bmN0aW9uKHJvbGUpe1xuICAgICAgaWYgKGlkZW50aXR5LmlzQXV0aG9yaXplZCgnYWRtaW4nKSl7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICRxLnJlamVjdCgnbm90IGF1dGhvcml6ZWQnKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYXV0aG9yaXplQXV0aGV0aWNhdGVkVXNlckZvclJvdXRlOiBmdW5jdGlvbigpe1xuICAgICAgaWYgKGlkZW50aXR5LmlzQXV0aGVudGljYXRlZCgpKXtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJHEucmVqZWN0KCdub3QgYSBjdXJyZW50IHVzZXInKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY3JlYXRlVXNlciA6IGZ1bmN0aW9uKG5ld1VzZXJEYXRhKSB7XG4gICAgICAgdmFyIG5ld1VzZXIgPSBuZXcgVXNlclNlcnZpY2UobmV3VXNlckRhdGEpO1xuICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICBuZXdVc2VyLiRzYXZlKCkudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgaWRlbnRpdHkuY3VycmVudFVzZXIgPSBuZXdVc2VyO1xuICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZS5kYXRhLnJlYXNvbik7XG4gICAgICAgfSk7XG5cbiAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgdXBkYXRlQ3VycmVudFVzZXI6IGZ1bmN0aW9uKG5ld1VzZXJEYXRhKXtcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgdmFyIGNsb25lID0gYW5ndWxhci5jb3B5KGlkZW50aXR5LmN1cnJlbnRVc2VyKTtcbiAgICAgICAgYW5ndWxhci5leHRlbmQoY2xvbmUsIG5ld1VzZXJEYXRhKTtcbiAgICAgICAgY2xvbmUuJHVwZGF0ZSgpLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICBpZGVudGl0eS5jdXJyZW50VXNlciA9IGNsb25lO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZS5kYXRhLnJlYXNvbik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgfS8vIHJldHVyblxuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndXNlcnMuaWRlbnRpdHknLCBbXSkuZmFjdG9yeSgnSWRlbnRpdHlTZXJ2aWNlJywgWyckd2luZG93JywgJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJHdpbmRvdywgVXNlclNlcnZpY2Upe1xuXG4gIHZhciBjdXJyZW50VXNlcjtcbiAgaWYoISEkd2luZG93LmJvb3RzdHJhcHBlZFVzZXJPYmplY3QpIHtcbiAgICBjdXJyZW50VXNlciA9IG5ldyBVc2VyU2VydmljZSgpO1xuICAgIGFuZ3VsYXIuZXh0ZW5kKGN1cnJlbnRVc2VyLCAkd2luZG93LmJvb3RzdHJhcHBlZFVzZXJPYmplY3QpO1xuICB9XG4gIHJldHVybiB7XG4gICAgY3VycmVudFVzZXI6IGN1cnJlbnRVc2VyLFxuICAgIGlzQXV0aGVudGljYXRlZDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiAhIXRoaXMuY3VycmVudFVzZXI7XG4gICAgfSxcblxuICAgIGlzQXV0aG9yaXplZDogZnVuY3Rpb24ocm9sZSl7XG4gICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIucm9sZXMuaW5kZXhPZihyb2xlKSA+IC0xO1xuICAgIH1cblxuICB9XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd1c2Vycy5sb2dpbicsIFtdKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICdJZGVudGl0eVNlcnZpY2UnLCAnTm90aWZpZXJTZXJ2aWNlJywgJ0F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsICdNZXRhJywgZnVuY3Rpb24oJHNjb3BlLCBpZGVudGl0eSwgbm90aWZpZXIsIEF1dGhTZXJ2aWNlLCAkbG9jYXRpb24sIE1ldGEpe1xuXG4gICAgTWV0YS5zZXRUaXRsZSgnQWNjb3VudCcpO1xuXG4gICAgJHNjb3BlLmlkZW50aXR5ID0gaWRlbnRpdHk7XG5cbiAgICAkc2NvcGUuc2lnbkluID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcbiAgICAgIEF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKHN1Y2Nlc3Mpe1xuICAgICAgICBpZihzdWNjZXNzKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1lvdSBoYXZlIHNpZ25lZCBpbicpO1xuICAgICAgICAgICRsb2NhdGlvbi51cmwoJy9hY2NvdW50Jyk7XG4gICAgICAgICAgJHNjb3BlLmFjdFNob3duID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IoJ1VzZXJuYW1lL1Bhc3N3b3JkIEluY29ycmVjdCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNpZ25PdXQgPSBmdW5jdGlvbigpe1xuICAgICAgQXV0aFNlcnZpY2UubG9nb3V0VXNlcigpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS51c2VybmFtZSA9ICcnO1xuICAgICAgICAkc2NvcGUucGFzc3dvcmQgPSAnJztcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdZb3UgaGF2ZSBsb2dnZWQgb3V0Jyk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNpZ251cCA9IGZ1bmN0aW9uKGZpcnN0TmFtZSwgbGFzdE5hbWUsIHVzZXJuYW1lLCBwYXNzd29yZCl7XG4gICAgICB2YXIgbmV3VXNlckRhdGEgPSB7XG4gICAgICAgICd1c2VybmFtZSc6IHVzZXJuYW1lLFxuICAgICAgICAnZmlyc3ROYW1lJzogZmlyc3ROYW1lLFxuICAgICAgICAnbGFzdE5hbWUnOiBsYXN0TmFtZSxcbiAgICAgICAgJ3Bhc3N3b3JkJzogcGFzc3dvcmRcbiAgICAgIH07XG4gICAgICBBdXRoU2VydmljZS5jcmVhdGVVc2VyKG5ld1VzZXJEYXRhKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVXNlciBBY2NvdW50IENyZWF0ZWQnKTtcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7XG4gICAgICAgIG5vdGlmaWVyLmVycm9yKG1lc3NhZ2UpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKXtcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfTtcblxuICAgICRzY29wZS5hY3RTaG93biA9IGZhbHNlO1xuICAgICRzY29wZS50b2dnbGVBY2NvdW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZihpZGVudGl0eS5pc0F1dGhlbnRpY2F0ZWQoKSl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWNjb3VudCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmFjdFNob3duID0gISRzY29wZS5hY3RTaG93bjtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLnNpZ251cFNob3duID0gZmFsc2U7XG4gICAgJHNjb3BlLnRvZ2dsZVNpZ251cCA9IGZ1bmN0aW9uKCkge1xuICAgICAgJHNjb3BlLnNpZ251cFNob3duID0gISRzY29wZS5zaWdudXBTaG93bjtcbiAgICB9O1xuXG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd1c2Vycy5zZXJ2aWNlJywgWyduZ1Jlc291cmNlJ10pLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbigkcmVzb3VyY2Upe1xuXG4gIHZhciBVc2VyUmVzb3VyY2UgPSAkcmVzb3VyY2UoJy9hcGkvdXNlcnMvOmlkJywge19pZCA6ICdAaWQnfSwge1xuICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCcsIGlzQXJyYXk6IGZhbHNlfVxuICB9KTtcblxuICBVc2VyUmVzb3VyY2UucHJvdG90eXBlLmlzQWRtaW4gPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLnJvbGVzICYmIHRoaXMucm9sZXMuaW5kZXhPZignYWRtaW4nKSA+IC0xO1xuICB9XG5cbiAgcmV0dXJuIFVzZXJSZXNvdXJjZTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3VzZXJzJywgWyd1c2Vycy5zZXJ2aWNlJywgJ3VzZXJzLmxvZ2luJywgJ3VzZXJzLmlkZW50aXR5JywgJ3VzZXJzLmF1dGgnXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignQ2Fyb3VzZWxDb250cm9sbGVyJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuICAkc2NvcGUuc2xpZGVzID0gW1xuICAgIHsgbmFtZTogJ01vYmlsZScsXG4gICAgc3ZnOiAnbW9iaWxlLXN2ZycsXG4gICAgZGVzYzogJ0lzIHlvdXIgd2Vic2l0ZSB1cCB0byBkYXRlIHdpdGggdGhlIG1vc3QgY3VycmVudCBtb2JpbGUgZGVzaWduIHRyZW5kcz8gSWYgbm90LCB5b3UgYXJlIGxvb3NpbmcgdmFsdWFibGUgYnVzaW5lc3MuIEVuc3VyZSB0aGF0IHlvdXIgY3VzdG9tZXJzIGNhbiByZWFjaCB5b3VyIGJ1c2luZXNzIGZyb20gYW55d2hlcmUgYW5kIHJlY2VpdmUgdGhlIGJlc3QgdXNlciBleHBlcmllbmNlLiBCeSBidWlsZGluZyB3aXRoIHJlc3BvbnNpdmUgZGVzaWduIGluIG1pbmQsIHlvdXIgY3VzdG9tZXJzIHdpbGwgZ2V0IGEgcGl4ZWwgcGVyZmVjdCBsb29rIGZyb20gbW9iaWxlIHRvIHRhYmxldCBvciBkZXNrdG9wLicgfSxcblxuICAgIHsgbmFtZTogJ0VDb21tZXJjZScsXG4gICAgc3ZnOiAnZWNvbW0tc3ZnJyxcbiAgICBkZXNjOiAnRG8geW91IGhhdmUgYSBuZXcgcHJvZHVjdCB5b3UgYXJlIGxvb2tpbmcgdG8gYnJpbmcgdG8gbWFya2V0IGFuZCBuZWVkIGFuIGUtY29tbWVyY2Ugc2l0ZSBvciBqdXN0IGxvb2tpbmcgZm9yIG1vcmUgbW9kZXJuIGZlZWwgdG8gYW4gZXhpc3Rpbmcgc2l0ZT8gIEJ5IHV0aWxpemluZyByb2J1c3QgZWNvbW1lcmNlIHBsYXRmb3JtcywgSSBjYW4gZGVzaWduIGFuZCBkZXZlbG9wIGEgc2l0ZSB0aGF0IHdpbGwgc2NhbGUgd2l0aCB5b3VyIGJ1c2luZXNzIGFuZCBuZWVkcyBhbGwgaW4gdGltZSB0byBtZWV0IHlvdXIgYnVzeSBkZWFkbGluZXMuICcgfSxcblxuICAgIHsgbmFtZTogJ1NFTycsXG4gICAgc3ZnOiAnc2VvLXN2ZycsXG4gICAgZGVzYzogJ0hhdmluZyBhIG1vZGVybiBkZXNpZ24gYW5kIHVzZXIgZnJpZW5kbHkgd2Vic2l0ZSBpcyBncmVhdCwgYnV0IGlmIGN1c3RvbWVycyBjYW5gdCBmaW5kIHlvdXIgYnVzaW5lc3MsIGl0IHdvbnQgbWF0dGVyIG11Y2guICBJIGRlc2lnbiBhbmQgZGV2ZWxvcCBldmVyeSBhc3BlY3Qgb2YgdGhlIHdlYnNpdGUgd2l0aCBzZWFyY2ggZW5naW5lIG9wdGltaXphdGlvbiBpbiBtaW5kIGFuZCBzbyB5b3VyIGN1c3RvbWVycyBjYW4gZmluZCB5b3UgYW1vbmcgdGhlIGNvbXBldGl0aW9uLiAgQWxzbyB0aHJvdWdoIHJlc2VhcmNoIGFuZCBhbmFseXRpY3MgSSBjYW4gZGV2ZWxvcCwgcGxhbiBhbmQgZGVwbG95IHRoZSBiZXN0IFNFTyBhbmQgbWFya2V0aW5nIHByYWN0aWNlcyB0byBpbmNyZWFzZSBjb252ZXJzaW9ucyBhbmQgcmV0ZW50aW9uLicgfVxuICBdO1xuXG4gICRzY29wZS5jdXJyZW50SW5kZXggPSAwO1xuICAkc2NvcGUuc2V0Q3VycmVudFNsaWRlSW5kZXggPSBmdW5jdGlvbihpbmRleCl7XG4gICAgJHNjb3BlLmN1cnJlbnRJbmRleCA9IGluZGV4O1xuICB9XG4gICRzY29wZS5pc0N1cnJlbnRTbGlkZUluZGV4ID0gZnVuY3Rpb24oaW5kZXgpe1xuICAgIHJldHVybiAkc2NvcGUuY3VycmVudEluZGV4ID09PSBpbmRleDtcbiAgfVxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3dpbGxzQmxvZycpLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ0NhY2hlZFBvc3RTZXJ2aWNlJywgJ05vdGlmaWVyU2VydmljZScgLCckd2luZG93JywgJyRodHRwJywgJ01ldGEnLCAgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIENhY2hlZFBvc3RTZXJ2aWNlLCBub3RpZmllciwgJHdpbmRvdywgJGh0dHAsIE1ldGEpe1xuXG4gICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgJGJnb2JqID0gJCgnI2hvbWUnKTtcbiAgICAgIHZhciB3aW5kb3dTaXplID0gJHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgdmFyIHhQb3MgPSAod2luZG93U2l6ZSA+IDc2OCkgPyB4UG9zID0gJzUwJyA6IHhQb3MgPSAnMjAnO1xuICAgICAgdmFyIHlQb3MgPSAtKCAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgLyAkYmdvYmouZGF0YSgnc3BlZWQnKSk7XG4gICAgICB2YXIgY29vcmRzID0geFBvcyArICclICcrIHlQb3MgKyAncHgnO1xuICAgICAgJGJnb2JqLmNzcyh7IGJhY2tncm91bmRQb3NpdGlvbjogY29vcmRzIH0pO1xuICB9KTtcblxuICAkc2NvcGUuYWJvdXRPcHRpb25zID0ge1xuICAgIG9yaWdpbjogJ3RvcCcsXG4gICAgZGlzdGFuY2U6ICcxNTBweCcsXG4gICAgZWFzaW5nOiAnZWFzZS1pbi1vdXQnLFxuICAgIGRlbGF5OiAzMCxcbiAgICBzY2FsZTogMSxcbiAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAvLyByZXNldDogdHJ1ZSxcbiAgICBzZXF1ZW5jZToge1xuICAgICAgIHNlbGVjdG9yOiAnLnNlcnZpY2VzLXdlYicsXG4gICAgICAgaW50ZXJ2YWw6IDMwMFxuICAgICB9XG4gIH07XG5cbiAgTWV0YS5zZXRUaXRsZSgnSG9tZScpO1xuICBNZXRhLnNldERlc2MoJ0kgZW5qb3kgYWxsIHRoaW5ncyB3ZWIgZGV2ZWxvcG1lbnQgYW5kIGFtIGFsd2F5cyBhY3RpdmVseSBsZWFybmluZyB0aGUgbmV3ZXN0IHRlY2huaXF1ZXMgYW5kIGxhbmdhdWdlcy4gSWYgeW91IGhhdmUgYSB3ZWIgZGVzaWduIG9yIGRldmVsb3BtZW50IHByb2plY3QsIGdpdmUgbWUgYSBzaG91dCwgSSB3b3VsZCBsb3ZlIHRvIHRhbGsgYWJvdXQgaXQuJyk7XG5cbiAgJHNjb3BlLnNlcnZpY2VzID0gW1xuICAgIHsgbmFtZTogJ0RldmVsb3BtZW50JyxcbiAgICBzdmc6ICdkZXYtbG9nbycsXG4gICAgZGVzY3JpcHRpb246ICdDdXN0b21pemVkIGFuZCByZXVzYWJsZSBjb2RlIHVzaW5nIHRoZSBtb3N0IHVwIHRvIGRhdGUgSFRNTDUsIENTUzMgYW5kIEphdmFzY3JpcHQgZnJhbXdvcmtzLiBPcHRpb25zIHJhbmdlIGZyb20gc3RhdGljIHNpdGVzLCBjb250ZW50IG1hbmFnZWQgc2l0ZXMsIGFuZCBlY29tbWVyY2Ugc3RvcmVzLicsXG4gICAgbW9yZTogJ0RldmVsb3BtZW50IFNraWxscyBpbmNsdWRlIEhUTUw1LCBDU1MsIEphdmFzY3JpcHQsIEFuZ3VsYXIsIEJhY2tib25lLCBOb2RlLCBFeHByZXNzLCBCb29zdHJhcCBhbmQgbW9yZS4nIH0sXG5cbiAgICB7IG5hbWU6ICdXZWIgRGVzaWduJyxcbiAgICBzdmc6ICdkZXNpZ24tbG9nbycsXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGluZyBhbiBleGNlbGxlbnQgdXNlciBleHBlcmllbmNlIHRocm91Z2ggY2xlYW4sIHNpbXBsZSBhbmQgdGhvcm91Z2hseSBjcmFmdGVkIGRlc2lnbi4gQ29sbGFib3JhdGlvbiB3aXRoIGNsaWVudHMgZHVyaW5nIGRlc2lnbiBwcm9jZXNzIGVuc3VyZXMgYSBzdXBlcmIgZmluaXNoZWQgcHJvamVjdC4nLFxuICAgIG1vcmU6ICdTZXJ2aWNlcyBpbmNsdWRlIHdpcmUgZnJhbWVzLCBwaG90b3Nob3AgbW9ja3VwcywgbG9nbyBkZXNpZ24sIGFuZCBjb21wYW55IGJyYW5kaW5nLicgfSxcblxuICAgIHsgbmFtZTogJ1N1cHBvcnQnLFxuICAgIHN2ZzogJ3N1cC1sb2dvJyxcbiAgICBkZXNjcmlwdGlvbjogJ1N1cHBvcnQgaXMgcmVhZGlseSBhdmFpbGFibGUgZm9yIGNsaWVudHMgd2hlbiBhbnl0aGluZyBjb21lcyB1cCBhbG9uZyB0aGUgZGV2ZWxvcG1lbnQgcHJvY2Vzcy4gQWxzbyBhdmFpbGFibGUgYXJlIHBlcnNvbmFsIGluc3RydWN0aW9uIG9uIGhvdyB0byBtYWludGFpbiBvciB1cGRhdGUgeW91ciBvd24gc2l0ZS4nLFxuICAgIG1vcmU6ICdIYXZlIGEgbmV3IHByb2R1Y3Qgb3IgZmVhdHVyZSB5b3Ugd2FudCB0byBpbXBsZW1lbnQ/IFBsYW5zIGZvciBjb250aW51ZWQgc3VwcG9ydCBhbmQgbWFpbnRlbmFuY2UgYXJlIGF2YWlsYWJsZS4nIH1cblxuICBdO1xuXG4gICRzY29wZS5wb3N0cyA9IENhY2hlZFBvc3RTZXJ2aWNlLnF1ZXJ5KCk7XG5cbiAgJHNjb3BlLmZvcm0gPSB7fTtcblxuICAkc2NvcGUuc2VuZE1haWwgPSBmdW5jdGlvbigpe1xuICAgIHZhciBkYXRhID0oe1xuICAgICAgY29udGFjdE5hbWUgOiB0aGlzLmNvbnRhY3ROYW1lLFxuICAgICAgY29udGFjdENvbXBhbnkgOiB0aGlzLmNvbnRhY3RDb21wYW55LFxuICAgICAgY29udGFjdEVtYWlsIDogdGhpcy5jb250YWN0RW1haWwsXG4gICAgICBjb250YWN0TWVzc2FnZSA6IHRoaXMuY29udGFjdE1lc3NhZ2VcbiAgICB9KTtcblxuICAgICRodHRwLnBvc3QoJy9jb250YWN0LWZvcm0nLCBkYXRhKVxuICAgICAgLnRoZW4oZnVuY3Rpb24obWVzc2FnZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpe1xuICAgICAgICBub3RpZmllci5ub3RpZnkoJ1RoYW5rIHlvdSBmb3IgeW91ciBtZXNzYWdlICcgKyBtZXNzYWdlLmRhdGEuY29udGFjdE5hbWUpO1xuICAgICAgICAgICAkc2NvcGUuZm9ybS5jb250YWN0Rm9ybS4kc2V0UHJpc3RpbmUoKTtcbiAgICAgICAgICAgJHNjb3BlLmZvcm0uY29udGFjdEZvcm0uJHNldFVudG91Y2hlZCgpO1xuICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpe1xuICAgICAgICBub3RpZmllci5ub3RpZnkoJ1RoZXJlIHdhcyBhbiBlcnJvciBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2FpbicpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNvbnRhY3ROYW1lID0gbnVsbDtcbiAgICAgIHRoaXMuY29udGFjdENvbXBhbnkgPSBudWxsO1xuICAgICAgdGhpcy5jb250YWN0RW1haWwgPSBudWxsO1xuICAgICAgdGhpcy5jb250YWN0TWVzc2FnZSA9IG51bGw7XG5cbiAgfVxuXG4gICRzY29wZS5nZXRVc2VyID0gZnVuY3Rpb24odXNlcm5hbWUpe1xuXHRcdFR3aXR0ZXJTZXJ2aWNlLmdldFVzZXIodXNlcm5hbWUpXG5cdFx0ICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdCAgICAgICAgJHNjb3BlLnR3aXR0ZXJFcnJvcnMgPSB1bmRlZmluZWQ7XG5cdCAgICAgICAgXHQkc2NvcGUudHdlZXRzID0gSlNPTi5wYXJzZShkYXRhLnJlc3VsdC51c2VyRGF0YSk7XG5cdFx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZygkc2NvcGUudHdlZXRzKTtcblx0XHQgICAgfSlcblx0XHQgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcblx0XHQgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RoZXJlIHdhcyBhbiBlcnJvciByZXRyaWV2aW5nIGRhdGE6ICcsIGVycm9yKTtcblx0XHQgICAgICAgICRzY29wZS50d2l0dGVyRXJyb3JzID0gZXJyb3IuZXJyb3I7XG5cdFx0ICAgIH0pXG5cdH07XG5cbiAgLy8kc2NvcGUuZ2V0VXNlcigpO1xuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignTmF2Q3RybCcsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICckZG9jdW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJGRvY3VtZW50KXtcbiAgJHNjb3BlLnNob3dNZW51ID0gZnVuY3Rpb24oKXtcbiAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2xsYXBzZScpKS50b2dnbGVDbGFzcygnaW4nKTtcbiAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCduYXZiYXItdG9nZ2xlJykpLnRvZ2dsZUNsYXNzKCdvcGVuJyk7XG4gIH07XG5cbiAgJHNjb3BlLnNjcm9sbFRvcCA9IGZ1bmN0aW9uKCl7XG4gICAgJGRvY3VtZW50LnNjcm9sbFRvcEFuaW1hdGVkKDApO1xuICB9O1xuXG4gICRzY29wZS5saW5rVG8gPSBmdW5jdGlvbihpZCl7XG5cbiAgICAgIHZhciByb3V0ZSA9ICRsb2NhdGlvbi51cmwoKTtcbiAgICAgIHZhciBvZmZzZXQgPSA2MDtcbiAgICAgIHZhciBkdXJhdGlvbiA9IDgwMDtcbiAgICAgIHZhciBlbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSk7XG5cbiAgICAgIGlmKHJvdXRlICE9PSAnLycpe1xuICAgICAgICAkbG9jYXRpb24udXJsKCcvJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAkZG9jdW1lbnQuc2Nyb2xsVG9FbGVtZW50KGVsZW1lbnQsIG9mZnNldCwgZHVyYXRpb24pO1xuICAgICAgICB9KTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGRvY3VtZW50LnNjcm9sbFRvRWxlbWVudChlbGVtZW50LCBvZmZzZXQsIGR1cmF0aW9uKTtcbiAgICAgIH1cbiAgICB9O1xuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnd2lsbHNCbG9nJykuY29udHJvbGxlcignV29ya0NvbnRyb2xsZXInLCBbJyRzY29wZScsIGZ1bmN0aW9uKCRzY29wZSl7XG5cbiAgJHNjb3BlLm9wdGlvbnMgPSB7XG4gICAgb3JpZ2luOiAnbGVmdCcsXG4gICAgZGlzdGFuY2U6ICcxNTBweCcsXG4gICAgZWFzaW5nOiAnZWFzZS1pbi1vdXQnLFxuICAgIGRlbGF5OiAzMCxcbiAgICBzY2FsZTogMSxcbiAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAvLyByZXNldDogdHJ1ZSxcbiAgICBhZnRlclJldmVhbDogZnVuY3Rpb24gKGRvbUVsKSB7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbGxlcnlcIikuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgIH0sXG4gICAgc2VxdWVuY2U6IHtcbiAgICAgICBzZWxlY3RvcjogJy5nYWxsZXJ5LWlubmVyJyxcbiAgICAgICBpbnRlcnZhbDogMzAwXG4gICAgIH1cbiAgfTtcblxuICAkc2NvcGUucHJvamVjdHMgPSBbXG4gICAge1xuICAgICAgbmFtZTogJ1RlbmRyaWwgSW5jLicsXG4gICAgICBsaW5rOiAnaHR0cHM6Ly93d3cudGVuZHJpbGluYy5jb20nLFxuICAgICAgY2xpY2tGdW5jOiB0b2dnbGVUZW5kcmlsID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS90ZW5kcmlsLnBuZycsXG4gICAgICBtb2RhbDogZmFsc2UsXG4gICAgICBtb2RhbEltZzogJ2ltZy9nYWxsZXJ5L3RlbmRyaWwtbW9ja3VwLnBuZycsXG4gICAgICBub0xpbms6IGZhbHNlXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnSGF5bGV5IEJhZ3dlbGwgSW50ZXJpb3IgRGVzaWduJyxcbiAgICAgIGxpbms6ICdodHRwOi8vd3d3LmhiZWRlc2lnbi5jb20vJyxcbiAgICAgIGNsaWNrRnVuYzogdG9nZ2xlSEIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS9oYmUtZGVzaWduLnBuZycsXG4gICAgICBtb2RhbDogZmFsc2UsXG4gICAgICBtb2RhbEltZzogJ2ltZy9nYWxsZXJ5L2hiZS1kZXNpZ24tcmVzcG9uc2l2ZS5wbmcnLFxuICAgICAgbm9MaW5rOiBmYWxzZVxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ0NvbG9yYWRvIEJyb2FkYmFuZCBQb3J0YWwnLFxuICAgICAgbGluazogJ2h0dHA6Ly9icm9hZGJhbmQuY28uZ292JyxcbiAgICAgIGNsaWNrRnVuYzogdG9nZ2xlQnJvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS93aXJlcy5wbmcnLFxuICAgICAgbW9kYWw6IGZhbHNlLFxuICAgICAgbW9kYWxJbWc6ICdpbWcvZ2FsbGVyeS9icm9hZGJhbmQucG5nJyxcbiAgICAgIG5vTGluazogZmFsc2VcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdhZGlkYXMgYWRpUGxheWVyJyxcbiAgICAgIGxpbms6ICcnLFxuICAgICAgY2xpY2tGdW5jOiB0b2dnbGVBZGkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tb2RhbCA9ICF0aGlzLm1vZGFsO1xuICAgICAgfSxcbiAgICAgIGJhY2tncm91bmRJbWc6ICdpbWcvZ2FsbGVyeS9hZGlwbGF5ZXIucG5nJyxcbiAgICAgIG1vZGFsOiBmYWxzZSxcbiAgICAgIG1vZGFsSW1nOiAnaW1nL2dhbGxlcnkvYWRpcGxheWVyX21vY2t1cC5wbmcnLFxuICAgICAgbm9MaW5rOiB0cnVlXG4gICAgfVxuICBdXG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmNhY2hlJywgW10pLmZhY3RvcnkoJ0NhY2hlZFBvc3RTZXJ2aWNlJywgWydQb3N0U2VydmljZScsIGZ1bmN0aW9uKFBvc3RTZXJ2aWNlKXtcbiAgdmFyIHBvc3RMaXN0O1xuXG4gIHJldHVybiB7XG4gICAgcXVlcnk6IGZ1bmN0aW9uKCl7XG4gICAgICBpZighcG9zdExpc3Qpe1xuICAgICAgICBwb3N0TGlzdCA9IFBvc3RTZXJ2aWNlLnF1ZXJ5KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcG9zdExpc3Q7XG4gICAgfVxuICB9XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmNvbW1lbnREaXJzJywgW10pLmRpcmVjdGl2ZSgnY29tbWVudEZvcm0nLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvY29tbWVudC1mb3JtJ1xuICB9XG59XSlcblxuLmRpcmVjdGl2ZSgnY29tbWVudExpc3QnLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJue1xuICAgIHJlc3RyaWN0OiAnRScsXG4gICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcG9zdHMvY29tbWVudC1saXN0J1xuICB9XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgncG9zdC5jb21tZW50cycsIFtdKS5zZXJ2aWNlKCdDb21tZW50U2VydmljZScsIFsnJGh0dHAnLCAnTm90aWZpZXJTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsIG5vdGlmaWVyKXtcblxuICB0aGlzLnBvc3RDb21tZW50ID0gZnVuY3Rpb24oZGF0YSwgc2x1Zyl7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvcG9zdHMvY29tbWVudHMvJyArIHNsdWcsIGRhdGEpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnVGhhbmtzIGZvciBzdWJtaXR0aW5nIHlvdXIgY29tbWVudCAnICsgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIG5vdGlmaWVyLmVycm9yKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHN1Ym1pdHRpbmcgeW91ciBjb21tZW50LicpO1xuICAgICAgfSk7XG4gIH07XG5cbiAgdGhpcy5kZWxldGVDb21tZW50ID0gZnVuY3Rpb24oZGF0YSwgc2x1Zyl7XG4gICAgcmV0dXJuICRodHRwLnB1dCgnL2FwaS9wb3N0cy9jb21tZW50cy8nICsgc2x1ZywgZGF0YSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5KCdDb21tZW50IG51bWJlciAnICsgcmVzcG9uc2UuZGF0YS5tZXNzYWdlICsgJyBoYXMgYmVlbiBkZWxldGVkIScpO1xuICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgbm90aWZpZXIuZXJyb3IoJ1RoZXJlIHdhcyBhIHByb2JsZW0gZGVsZXRpbmcgeW91ciBjb21tZW50LicpO1xuICAgICAgfSk7XG4gIH07XG5cbn1dKTtcbiIsIiBhbmd1bGFyLm1vZHVsZSgncG9zdC5lZGl0JywgW10pLmNvbnRyb2xsZXIoJ0VkaXRQb3N0Q29udHJvbGxlcicsIFsgJyRzY29wZScsICckbG9jYXRpb24nLCAnJHN0YXRlUGFyYW1zJywgJ05vdGlmaWVyU2VydmljZScsICdQb3N0U2VydmljZScsICdJZGVudGl0eVNlcnZpY2UnLCAnQ29tbWVudFNlcnZpY2UnLCAnTWV0YScsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsIG5vdGlmaWVyLCBQb3N0U2VydmljZSwgaWRlbnRpdHksIENvbW1lbnRTZXJ2aWNlLCBNZXRhKXtcblxuICAgIE1ldGEuc2V0VGl0bGUoJ0VkaXQgUG9zdCcpO1xuXG4gICAgJHNjb3BlLmlkZW50aXR5ID0gaWRlbnRpdHk7XG5cbiAgICAkc2NvcGUucG9zdCA9IFBvc3RTZXJ2aWNlLmdldCh7IHNsdWc6ICRzdGF0ZVBhcmFtcy5zbHVnIH0sIGZ1bmN0aW9uKCl7XG4gICAgICAvLyRzY29wZS5naXN0TGlzdCA9ICRzY29wZS5wb3N0Lmdpc3RzO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLmFkZEdpc3QgPSBmdW5jdGlvbihuZXdHaXN0KXtcbiAgICAgICRzY29wZS5wb3N0Lmdpc3RzLnB1c2gobmV3R2lzdCk7XG4gICAgfTtcbiAgICAkc2NvcGUucmVtb3ZlR2lzdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAkc2NvcGUucG9zdC5naXN0cy5wb3AoKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnBvc3QuZGF0YSA9IHtcbiAgICAgICAgX2lkOiAkc2NvcGUucG9zdC5faWQsXG4gICAgICAgIHRpdGxlIDogJHNjb3BlLnBvc3QudGl0bGUsXG4gICAgICAgIHNsdWc6ICRzY29wZS5wb3N0LnNsdWcsXG4gICAgICAgIGNhdGVnb3JpZXMgOiAkc2NvcGUucG9zdC5jYXRlZ29yaWVzLFxuICAgICAgICBleGNlcnB0IDogJHNjb3BlLnBvc3QuZXhjZXJwdCxcbiAgICAgICAgYm9keSA6ICRzY29wZS5wb3N0LmJvZHksXG4gICAgICAgIGF1dGhvcjogJHNjb3BlLnBvc3QuYXV0aG9yLFxuICAgICAgICBwb3N0ZWREYXRlOiBEYXRlLm5vdygpLFxuICAgICAgICBnaXN0czogJHNjb3BlLnBvc3QuZ2lzdHNcbiAgICB9O1xuXG4gICAgJHNjb3BlLnVwZGF0ZVBvc3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAkc2NvcGUucG9zdC4kdXBkYXRlKCB7IHNsdWc6ICRzY29wZS5wb3N0LnNsdWcgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnkoJ1Bvc3QgaGFzIGJlZW4gdXBkYXRlZCcpO1xuICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcG9zdHMnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7XG4gICAgICAgICAgbm90aWZpZXIuZXJyb3IobWVzc2FnZS5kYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5kZWxldGVQb3N0ID0gZnVuY3Rpb24oKXtcbiAgICAgICRzY29wZS5wb3N0LiRkZWxldGUoZnVuY3Rpb24oKSB7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnUG9zdCBoYXMgYmVlbiBkZWxldGVkJyk7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcG9zdHMnKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZGVsZXRlQ29tbWVudCA9IGZ1bmN0aW9uKGNvbW1lbnQpe1xuICAgICAgdmFyIHNsdWcgPSAkc3RhdGVQYXJhbXMuc2x1ZztcbiAgICAgIENvbW1lbnRTZXJ2aWNlLmRlbGV0ZUNvbW1lbnQoY29tbWVudCwgc2x1ZylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAkc2NvcGUucG9zdC5jb21tZW50cy5wb3AoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24oKXtcblxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAkbG9jYXRpb24ucGF0aCgnL3Bvc3RzJyk7XG4gICAgfTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3Bvc3QubmV3JywgW10pLmNvbnRyb2xsZXIoJ05ld1Bvc3RDb250cm9sbGVyJywgWyckc2NvcGUnLCAnTm90aWZpZXJTZXJ2aWNlJywgJ1Bvc3RTZXJ2aWNlJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgbm90aWZpZXIsIFBvc3RTZXJ2aWNlLCAkbG9jYXRpb24pe1xuXG4gICRzY29wZS5wb3N0ID0gbmV3IFBvc3RTZXJ2aWNlKCk7XG5cbiAgJHNjb3BlLmNyZWF0ZU5ld1Bvc3QgPSBmdW5jdGlvbigpe1xuICAgICRzY29wZS5wb3N0LiRzYXZlKGZ1bmN0aW9uKCl7XG4gICAgICAgIG5vdGlmaWVyLm5vdGlmeSgnTmV3IFBvc3QgQ3JlYXRlZCcpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3Bvc3RzJyk7XG4gICAgfSk7XG4gIH1cblxuICAkc2NvcGUucG9zdC5naXN0cyA9IFtdO1xuICAkc2NvcGUuYWRkR2lzdCA9IGZ1bmN0aW9uKG5ld0dpc3Qpe1xuICAgICRzY29wZS5wb3N0Lmdpc3RzLnB1c2gobmV3R2lzdCk7XG4gIH1cblxuICAkc2NvcGUucmVtb3ZlR2lzdCA9IGZ1bmN0aW9uKG5ld0dpc3Qpe1xuICAgICRzY29wZS5wb3N0Lmdpc3RzLnBvcCgpO1xuICB9XG5cbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XG4gICAgJGxvY2F0aW9uLnBhdGgoJy9ibG9nJyk7XG4gIH1cblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3Bvc3QnLCBbJ3Bvc3QuZGV0YWlsJywgJ3Bvc3Quc2VydmljZScsICdwb3N0Lm5ldycsICdwb3N0LmVkaXQnLCAncG9zdC5jYWNoZScsICdwb3N0Lmxpc3QnLCAncG9zdC5jb21tZW50cycsICdwb3N0LmNvbW1lbnREaXJzJ10pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ3Bvc3Quc2VydmljZScsIFsnbmdSZXNvdXJjZSddKS5mYWN0b3J5KCdQb3N0U2VydmljZScsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKXtcblxuICB2YXIgUG9zdFJlc291cmNlID0gJHJlc291cmNlKCcvYXBpL3Bvc3RzLzpzbHVnJywge3NsdWc6ICdAc2x1Zyd9LCB7XG4gICAgdXBkYXRlIDogeyBtZXRob2Q6ICdQVVQnIH1cbiAgfSk7XG5cbiAgUG9zdFJlc291cmNlLmdldFBvc3QgPSBmdW5jdGlvbihzbHVnKXtcbiAgICByZXR1cm4gUG9zdFJlc291cmNlLmdldCh7c2x1Zzogc2x1Z30pLiRwcm9taXNlLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBQb3N0UmVzb3VyY2U7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdwb3N0LmRldGFpbCcsIFtdKS5jb250cm9sbGVyKCdQb3N0RGV0YWlsQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZVBhcmFtcycsICdDYWNoZWRQb3N0U2VydmljZScsICdNZXRhJywgJ0NvbW1lbnRTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIENhY2hlZFBvc3RTZXJ2aWNlLCBNZXRhLCBDb21tZW50U2VydmljZSl7XG5cbiAgLy8gUG9zdFNlcnZpY2UuZ2V0UG9zdCgkc3RhdGVQYXJhbXMuc2x1ZykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gIC8vICAgJHNjb3BlLnBvc3QgPSByZXNwb25zZTtcbiAgLy8gICBjb25zb2xlLmxvZygkc2NvcGUucG9zdCk7XG4gIC8vIH0pO1xuXG4gIENhY2hlZFBvc3RTZXJ2aWNlLnF1ZXJ5KCkuJHByb21pc2UudGhlbihmdW5jdGlvbihjb2xsZWN0aW9uKXtcbiAgICBjb2xsZWN0aW9uLmZvckVhY2goZnVuY3Rpb24ocG9zdCl7XG4gICAgICBpZihwb3N0LnNsdWcgPT09ICRzdGF0ZVBhcmFtcy5zbHVnKXtcbiAgICAgICAgJHNjb3BlLnBvc3QgPSBwb3N0O1xuICAgICAgICB2YXIgdGl0bGUgPSAkc2NvcGUucG9zdC50aXRsZSxcbiAgICAgICAgICAgIGRlc2MgPSAkc2NvcGUucG9zdC5leGNlcnB0O1xuICAgICAgICBNZXRhLnNldFRpdGxlKHRpdGxlKTtcbiAgICAgICAgTWV0YS5zZXREZXNjKGRlc2MpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICAkc2NvcGUuc3VibWl0Q29tbWVudCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNvbW1lbnQgPSB7XG4gICAgICAnY29udGVudCc6ICRzY29wZS5jb21tZW50LmNvbnRlbnQsXG4gICAgICAnZGF0ZSc6IERhdGUubm93KCksXG4gICAgICAnZmlyc3ROYW1lJzogJHNjb3BlLmNvbW1lbnQuZmlyc3ROYW1lLFxuICAgICAgJ2xhc3ROYW1lJzogJHNjb3BlLmNvbW1lbnQubGFzdE5hbWUsXG4gICAgfTtcbiAgICB2YXIgc2x1ZyA9ICRzdGF0ZVBhcmFtcy5zbHVnO1xuICAgIENvbW1lbnRTZXJ2aWNlLnBvc3RDb21tZW50KGNvbW1lbnQsIHNsdWcpXG4gICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAkc2NvcGUucG9zdC5jb21tZW50cy5wdXNoKGNvbW1lbnQpO1xuICAgICAgICAkc2NvcGUuY29tbWVudC5jb250ZW50PSBcIlwiO1xuICAgICAgICAkc2NvcGUuY29tbWVudC5maXJzdE5hbWU9IFwiXCI7XG4gICAgICAgICRzY29wZS5jb21tZW50Lmxhc3ROYW1lPSBcIlwiO1xuICAgICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgIH0pO1xuICB9O1xuXG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgncG9zdC5saXN0JywgW10pLmNvbnRyb2xsZXIoJ1Bvc3RMaXN0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ0NhY2hlZFBvc3RTZXJ2aWNlJywgJ0lkZW50aXR5U2VydmljZScsICckbG9jYXRpb24nLCAnTWV0YScsICBmdW5jdGlvbigkc2NvcGUsIENhY2hlZFBvc3RTZXJ2aWNlLCBpZGVudGl0eSwgJGxvY2F0aW9uLCBNZXRhKXtcblxuICBNZXRhLnNldFRpdGxlKCdQb3N0cycpO1xuXG4gICRzY29wZS5wb3N0cyA9IENhY2hlZFBvc3RTZXJ2aWNlLnF1ZXJ5KCk7XG5cbiAgJHNjb3BlLmlkZW50aXR5ID0gaWRlbnRpdHk7XG5cbiAgJHNjb3BlLnNvcnRPcHRpb25zPSBbXG4gICAge3ZhbHVlOiAncHVibGlzaGVkJywgdGV4dDogJ1B1Ymxpc2hlZCBEYXRlJ30sXG4gICAge3ZhbHVlOiAndGl0bGUnLCB0ZXh0OiAnU29ydCBieSBUaXRsZSd9XG4gIF1cblxuICAkc2NvcGUuc29ydE9yZGVyID0gJHNjb3BlLnNvcnRPcHRpb25zWzBdLnZhbHVlO1xufV0pO1xuIl19
